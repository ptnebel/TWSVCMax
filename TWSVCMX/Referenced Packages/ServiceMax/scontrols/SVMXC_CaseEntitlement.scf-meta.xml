<?xml version="1.0" encoding="UTF-8"?>
<Scontrol xmlns="http://soap.sforce.com/2006/04/metadata">
    <contentSource>HTML</contentSource>
    <encodingKey>UTF-8</encodingKey>
    <fileContent>dmFyIEluc3RQcm9kSWQgPSAiIjsNCnZhciByZXRVUkwgPSAiIjsNCnZhciBNc2dMaXN0ID0gbmV3IEFycmF5KCk7DQp2YXIgVG9wSWJJZCA9ICIiOw0KdmFyIEhlYWRlckRvbmUgPSBmYWxzZTsNCnZhciBPYmpUeXBlID0gIiI7DQp2YXIgQ3Vyck9iaklkID0gIiI7DQp2YXIgZW50cm93bnVtID0gMDsNCnZhciBFbnRDYXNlSWQgPSAiIjsNCnZhciBFbnRTVk9JZCA9ICIiOw0KdmFyIEVudEliSWQgPSAiIjsNCnZhciBFbnRQcm9kSWQgPSAiIjsNCnZhciBBY2N0SWQgPSAiIjsNCnZhciBNYXRjaEFjY291bnQgPSB0cnVlOw0KZnVuY3Rpb24gU1ZNWENfRU5fVmFsaWRhdGVQZXJtaXNzaW9ucygpDQp7DQp2YXIgU2hvd0VudCA9dHJ1ZTsNCnRyeXsNCiB2YXIgcmVzdWx0U2VydmljZU1heF9TZXR0aW5ncyA9IHNmb3JjZS5jb25uZWN0aW9uLmRlc2NyaWJlU09iamVjdCgiU1ZNWENfX1NlcnZpY2VNYXhfU2V0dGluZ3NfX2MiKTsgDQogdmFyIHJlc3VsdFByb2R1Y3QyID0gc2ZvcmNlLmNvbm5lY3Rpb24uZGVzY3JpYmVTT2JqZWN0KCJQcm9kdWN0MiIpOw0KIHZhciByZXN1bHRTVk1YQ19fSW5zdGFsbGVkX1Byb2R1Y3RfX2MgID0gc2ZvcmNlLmNvbm5lY3Rpb24uZGVzY3JpYmVTT2JqZWN0KCJTVk1YQ19fSW5zdGFsbGVkX1Byb2R1Y3RfX2MiKTsNCiB2YXIgcmVzdWx0Q2FzZSAgPSBzZm9yY2UuY29ubmVjdGlvbi5kZXNjcmliZVNPYmplY3QoIkNhc2UiKTsNCiB2YXIgcmVzdWx0U1ZNWENfX0VudGl0bGVtZW50X0hpc3RvcnlfX2MgPSBzZm9yY2UuY29ubmVjdGlvbi5kZXNjcmliZVNPYmplY3QoIlNWTVhDX19FbnRpdGxlbWVudF9IaXN0b3J5X19jIik7DQogdmFyIHJlc3VsdFNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X19jID0gc2ZvcmNlLmNvbm5lY3Rpb24uZGVzY3JpYmVTT2JqZWN0KCJTVk1YQ19fU2VydmljZV9Db250cmFjdF9fYyIpOw0KIHZhciByZXN1bHRTVk1YQ19fU2VydmljZV9Db250cmFjdF9TZXJ2aWNlc19fYyA9IHNmb3JjZS5jb25uZWN0aW9uLmRlc2NyaWJlU09iamVjdCgiU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfU2VydmljZXNfX2MiKTsNCiB2YXIgcmVzdWx0U1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfQ29udGFjdHNfX2MgPSBzZm9yY2UuY29ubmVjdGlvbi5kZXNjcmliZVNPYmplY3QoIlNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X0NvbnRhY3RzX19jIik7DQogdmFyIHJlc3VsdFNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X1NpdGVzX19jID0gc2ZvcmNlLmNvbm5lY3Rpb24uZGVzY3JpYmVTT2JqZWN0KCJTVk1YQ19fU2VydmljZV9Db250cmFjdF9TaXRlc19fYyIpOw0KIHZhciByZXN1bHRTVk1YQ19fV2FycmFudHlfX2MgPSBzZm9yY2UuY29ubmVjdGlvbi5kZXNjcmliZVNPYmplY3QoIlNWTVhDX19XYXJyYW50eV9fYyIpOw0KIHZhciByZXN1bHRTVk1YQ19fU2VydmljZV9Db250cmFjdF9Qcm9kdWN0c19fYyA9IHNmb3JjZS5jb25uZWN0aW9uLmRlc2NyaWJlU09iamVjdCgiU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfUHJvZHVjdHNfX2MiKTsNCiB2YXIgcmVzdWx0U1ZNWENfX1NlcnZpY2VfTGV2ZWxfX2MgPSBzZm9yY2UuY29ubmVjdGlvbi5kZXNjcmliZVNPYmplY3QoIlNWTVhDX19TZXJ2aWNlX0xldmVsX19jIik7DQogDQogCQ0KCQkvLyBDaGVjayBFbnRpdGxlbWVudCBCdXR0b24NCiBpZiAgKChyZXN1bHRQcm9kdWN0Mi5xdWVyeWFibGUgID09ICJmYWxzZSIpIHx8DQogCShyZXN1bHRTVk1YQ19fU2VydmljZV9Db250cmFjdF9fYy5xdWVyeWFibGUgPT0gImZhbHNlIikgfHwNCgkocmVzdWx0U1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfU2VydmljZXNfX2MucXVlcnlhYmxlID09ICJmYWxzZSIpIHx8DQoJKHJlc3VsdFNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X0NvbnRhY3RzX19jLnF1ZXJ5YWJsZSA9PSAiZmFsc2UiKSB8fA0KCShyZXN1bHRTVk1YQ19fU2VydmljZV9Db250cmFjdF9TaXRlc19fYy5xdWVyeWFibGUgPT0gImZhbHNlIikgfHwNCgkocmVzdWx0U1ZNWENfX1dhcnJhbnR5X19jLnF1ZXJ5YWJsZSA9PSAiZmFsc2UiKSB8fA0KCShyZXN1bHRTVk1YQ19fU2VydmljZV9Db250cmFjdF9Qcm9kdWN0c19fYy5xdWVyeWFibGUgPT0gImZhbHNlIikgfHwNCgkocmVzdWx0U1ZNWENfX1NlcnZpY2VfTGV2ZWxfX2MucXVlcnlhYmxlID09ICJmYWxzZSIpICkNCgl7DQoJZG9jdW1lbnQuZm9ybXNbJ2VudF9mb3JtJ10uTEFCMDAxLmRpc2FibGVkPXRydWU7DQoJfQ0KIGVsc2UNCgl7DQoJZG9jdW1lbnQuZm9ybXNbJ2VudF9mb3JtJ10uTEFCMDAxLmRpc2FibGVkPWZhbHNlOw0KCX0NCgkJLy8gU2F2ZSBFbnRpdGxlbWVudCBCdXR0b24NCiAgICBkb2N1bWVudC5mb3Jtc1snZW50X2Zvcm0nXS5MQUIwMDIuZGlzYWJsZWQgPSAoKHJlc3VsdENhc2UudXBkYXRlYWJsZSA9PSAiZmFsc2UiKSB8fCANCgkJCQkJCSAgICAgKHJlc3VsdFNWTVhDX19FbnRpdGxlbWVudF9IaXN0b3J5X19jLmNyZWF0ZWFibGUgPT0gImZhbHNlIil8fA0KCQkJCQkJICAgICAocmVzdWx0U1ZNWENfX0VudGl0bGVtZW50X0hpc3RvcnlfX2MudXBkYXRlYWJsZSA9PSAiZmFsc2UiKSkgPyB0cnVlIDogZmFsc2U7DQoJDQoJCS8vU2F2ZSBQcm9kdWN0IEJ1dHRvbgkNCglpZiAocmVzdWx0Q2FzZS51cGRhdGVhYmxlICA9PSAiZmFsc2UiKQ0KCXsNCglkb2N1bWVudC5mb3Jtc1snZW50X2Zvcm0nXS5MQUIwMDMuZGlzYWJsZWQ9dHJ1ZTsNCgl9DQoJZWxzZQ0KCXsNCglkb2N1bWVudC5mb3Jtc1snZW50X2Zvcm0nXS5MQUIwMDMuZGlzYWJsZWQ9ZmFsc2U7CQkNCgl9DQoJDQoJDQoJDQoJZG9jdW1lbnQuZm9ybXNbJ2VudF9mb3JtJ10uTEFCMDA0LmRpc2FibGVkID0gKHJlc3VsdFNWTVhDX19JbnN0YWxsZWRfUHJvZHVjdF9fYy5xdWVyeWFibGUgPT0gImZhbHNlIikgPyB0cnVlIDogZmFsc2U7DQoJDQoJaWYgIChyZXN1bHRTZXJ2aWNlTWF4X1NldHRpbmdzLnF1ZXJ5YWJsZSAgPT0gImZhbHNlIikNCgkgICAgew0KCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhwZF9lbnQnKS5kaXNhYmxlZCA9IHRydWU7DQoJICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmdXRfZW50JykuZGlzYWJsZWQgPSB0cnVlOw0KCSAgICB9DQoJDQoJaWYgIChyZXN1bHRQcm9kdWN0Mi5xdWVyeWFibGUgID09ICJmYWxzZSIpIHsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2R1Y3QnKS5kaXNhYmxlZCA9IHRydWU7IH0NCgkNCglpZiAgKHJlc3VsdFNWTVhDX19JbnN0YWxsZWRfUHJvZHVjdF9fYy5xdWVyeWFibGUgPT0gImZhbHNlIikgeyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VyaWFsJykuZGlzYWJsZWQgPSB0cnVlOyB9DQoNCgkJLy9TVk1YQ19FTl9TaG93RW50aXRsZW1lbnQNCglpZiAgKChyZXN1bHRTZXJ2aWNlTWF4X1NldHRpbmdzLnF1ZXJ5YWJsZSA9PSAiZmFsc2UiKSB8fCAgDQoJCShyZXN1bHRQcm9kdWN0Mi5xdWVyeWFibGUgID09ICJmYWxzZSIpIHx8DQoJCShyZXN1bHRTVk1YQ19fSW5zdGFsbGVkX1Byb2R1Y3RfX2MucXVlcnlhYmxlID09ICJmYWxzZSIpfHwNCgkJKHJlc3VsdENhc2UucXVlcnlhYmxlICA9PSAiZmFsc2UiKSB8fCANCgkJKHJlc3VsdFNWTVhDX19FbnRpdGxlbWVudF9IaXN0b3J5X19jLnF1ZXJ5YWJsZSA9PSAiZmFsc2UiKSkNCgl7DQoJCVNob3dFbnQgPWZhbHNlOwkNCgl9DQoJZWxzZQ0KCXsNCgkJU2hvd0VudCA9dHJ1ZTsJDQoJfQ0KCS8vYWxlcnQoJ1Nob3dFbnQgIDogJytTaG93RW50KTsNCiANCn1jYXRjaChlKXthbGVydChlKTt9DQpyZXR1cm4gU2hvd0VudDsNCn0NCi8vIE1haW4gZW50cnkgcG9pbnQgZm9yIGVudGl0bGVtZW50IGNhbGxlZCBvbiBwYWdlIGxvYWQNCi8vIFNldHVwIHRoZSBlbnRpdGxlbWVudCBzY3JlZW4NCmZ1bmN0aW9uIFNWTVhDX0VOX1Nob3dFbnRpdGxlbWVudChvYmppZCwgdWlkLCBvYmp0eXBlKQ0Kew0KICAgIFNWTVhDX0luaXRNZXNzYWdlTGlzdCgiRVZFUlNDMSIpOw0KICAgIFNWTVhDX0VOX1NldExhYmVscygpOw0KICAgIEN1cnJPYmpJZCA9IG9iamlkOw0KICAgIE9ialR5cGUgPSBvYmp0eXBlOw0KDQogICAgVXNlcklkID0gdWlkOw0KCS8vdmFyIHggPVNWTVhDX0VOX1ZhbGlkYXRlUGVybWlzc2lvbnMoKTsNCi8vCWlmIChTVk1YQ19FTl9WYWxpZGF0ZVBlcm1pc3Npb25zKCk9PXRydWUpDQogIC8vIHsNCiAgICBTVk1YQ19FTl9TZXRFbnRpdGxlbWVudEZpbHRlcnMoKTsNCiAgICBTVk1YQ19FTl9TZXRMb29rdXBUeXBlcygpOw0KICAgIFNWTVhDX0VOX1BvcHVsYXRlRXhpc3RpbmdEYXRhKG9ianR5cGUsIG9iamlkKTsNCgkvL30NCn0NCi8qPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8NCi8vIFNldCB0aGUgZmllbGQgbGFiZWxzIGZyb20gQ2FzZSBvYmplY3QgZGVmaW5pdGlvbiBieSBtYXRjaGluZyBsYWJlbCdzIG5hbWUgYXR0cmlidXRlIHRvIFNGREMgZmllbGQgbmFtZQ0KZnVuY3Rpb24gU1ZNWENfRU5fU2V0TGFiZWxzKCkNCnsNCiAgICB2YXIgbGFiZWxzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2xhYmVsJyk7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsYWJlbHMubGVuZ3RoOyBpKyspDQoJew0KCXZhciBmID0gbGFiZWxzW2ldOw0KCWlmIChNc2dMaXN0W2YubmFtZV0pDQoJICAgIGYuaW5uZXJUZXh0ID0gTXNnTGlzdFtmLm5hbWVdOw0KCX0NCiAgICB2YXIgZWxlbXMgPSBkb2N1bWVudC5mb3Jtc1snZW50X2Zvcm0nXS5lbGVtZW50czsNCiAgICBmb3IgKHZhciBqID0gMDsgaiA8IGVsZW1zLmxlbmd0aDsgaisrKQ0KCXsNCgl2YXIgZiA9IGVsZW1zW2pdOw0KCWlmICgoZi50eXBlID09ICdidXR0b24nIHx8IGYudHlwZSA9PSAnY2hlY2tib3gnKSAmJiBNc2dMaXN0W2YubmFtZV0pDQoJICAgIGYudmFsdWUgPSBNc2dMaXN0W2YubmFtZV07DQoJfQ0KICAgIHJldHVybiB0cnVlOw0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KLy8gVXNlIHRoZSBvcmctd2lkZSBkZWZhdWx0cyBmb3IgZW50aXRsZW1lbnQgZmlsdGVycyAoZnV0dXJlLCBleHBpcmVkKQ0KZnVuY3Rpb24gU1ZNWENfRU5fU2V0RW50aXRsZW1lbnRGaWx0ZXJzKCkNCnsNCiAgICB2YXIgc29xbDEgPSAiU0VMRUNUIFNWTVhDX19TaG93X0V4cGlyZWRfRW50aXRsZW1lbnRzX19jLCBTVk1YQ19fU2hvd19GdXR1cmVfRW50aXRsZW1lbnRzX19jLCAiICsNCiAgICAJCSJTVk1YQ19fQWxsb3dfRW50aXRsZW1lbnRfRmlsdGVyc19fYywgU1ZNWENfX01hdGNoX0FjY291bnRfSW5fRW50aXRsZW1lbnRfX2MgRlJPTSBTVk1YQ19fU2VydmljZU1heF9TZXR0aW5nc19fYyI7DQogICAgLy92YXIgc29xbDEgPSAiU0VMRUNUIFNob3dfRXhwaXJlZF9FbnRpdGxlbWVudHNfX2MsIFNob3dfRnV0dXJlX0VudGl0bGVtZW50c19fYywgIiArDQogICAgLy8JCSJBbGxvd19FbnRpdGxlbWVudF9GaWx0ZXJzX19jLCBNYXRjaF9BY2NvdW50X0luX0VudGl0bGVtZW50X19jIEZST00gU1ZNWENfX1NlcnZpY2VNYXhfU2V0dGluZ3NfX2MiOw0KICAgIHZhciBxcjEgPSBzZm9yY2UuY29ubmVjdGlvbi5xdWVyeShzb3FsMSk7DQogICAgaWYgKHFyMS5zaXplID4gMCkNCgl7DQoJdmFyIHJlYzEgPSBxcjEuZ2V0QXJyYXkoInJlY29yZHMiKVswXTsNCg0KCWlmIChyZWMxLlNWTVhDX19NYXRjaF9BY2NvdW50X0luX0VudGl0bGVtZW50X19jICYmIHJlYzEuU1ZNWENfX01hdGNoX0FjY291bnRfSW5fRW50aXRsZW1lbnRfX2MgPT0gImZhbHNlIikNCgkgICAgTWF0Y2hBY2NvdW50ID0gZmFsc2U7DQoNCglpZiAocmVjMS5TVk1YQ19fU2hvd19FeHBpcmVkX0VudGl0bGVtZW50c19fYyA9PSAidHJ1ZSIpDQoJICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleHBkX2VudCcpLmNoZWNrZWQgPSB0cnVlOw0KCWVsc2UNCgkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4cGRfZW50JykuY2hlY2tlZCA9IGZhbHNlOw0KDQoJaWYgKHJlYzEuU1ZNWENfX1Nob3dfRnV0dXJlX0VudGl0bGVtZW50c19fYyA9PSAidHJ1ZSIpDQoJICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmdXRfZW50JykuY2hlY2tlZCA9IHRydWU7DQoJZWxzZQ0KCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZnV0X2VudCcpLmNoZWNrZWQgPSBmYWxzZTsNCg0KCWlmIChyZWMxLlNWTVhDX19BbGxvd19FbnRpdGxlbWVudF9GaWx0ZXJzX19jID09ICJmYWxzZSIpDQoJICAgIHsNCgkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4cGRfZW50JykuZGlzYWJsZWQgPSB0cnVlOw0KCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZnV0X2VudCcpLmRpc2FibGVkID0gdHJ1ZTsNCgkgICAgfQ0KCX0NCiAgICBlbHNlDQoJew0KCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleHBkX2VudCcpLmNoZWNrZWQgPSBmYWxzZTsNCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZnV0X2VudCcpLmNoZWNrZWQgPSBmYWxzZTsNCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhwZF9lbnQnKS5kaXNhYmxlZCA9IHRydWU7DQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Z1dF9lbnQnKS5kaXNhYmxlZCA9IHRydWU7DQoJfQ0KICAgIHJldHVybiB0cnVlOw0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KLy8gV2UgdXNlIFNGREMncyBzdGFuZGFyZCBsb29rdXAgcG9wdXAgd2hpY2ggcmVxdWlyZXMgdGhlIDMtZGlnaXQgb2JqZWN0IGNvZGUgKHByZWZpeCkNCi8vIFRoZSBvYmplY3QgcHJlZml4IG1heSB3YXJ5IGluIGVhY2ggU0ZEQyBvcmcgLSBpdCBpcyBwb3B1bGF0ZWQgaW4gaGlkZGVuIGZpZWxkcyBvbiB0aGUgZm9ybQ0KLy8gZm9yIHRoZSBsb29rdXAgdG8gd29yayBwcm9wZXJseQ0KZnVuY3Rpb24gU1ZNWENfRU5fU2V0TG9va3VwVHlwZXMoKQ0Kew0KICAgIHZhciBwcm9kb2JqID0gc2ZvcmNlLmNvbm5lY3Rpb24uZGVzY3JpYmVTT2JqZWN0KCJQcm9kdWN0MiIpOw0KICAgIHZhciBpYm9iaiA9IHNmb3JjZS5jb25uZWN0aW9uLmRlc2NyaWJlU09iamVjdCgiU1ZNWENfX0luc3RhbGxlZF9Qcm9kdWN0X19jIik7DQoNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicHJvZHVjdF9sa3RwIikudmFsdWUgPSBwcm9kb2JqLmtleVByZWZpeDsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2VyaWFsX2xrdHAiKS52YWx1ZSA9IGlib2JqLmtleVByZWZpeDsNCn0NCi8qPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8NCi8vIFNob3cgZXhpc3RpbmcgZGF0YSBvbiB0aGUgZW50aXRsZW1lbnQgZm9ybQ0KZnVuY3Rpb24gU1ZNWENfRU5fUG9wdWxhdGVFeGlzdGluZ0RhdGEob2JqdHlwZSwgb2JqaWQpDQp7DQogICAgaWYgKG9ianR5cGUgPT0gJ0NBU0UnKQ0KCXsNCglFbnRDYXNlSWQgPSBvYmppZDsNCgl2YXIgc29xbDEgPSAiU0VMRUNUIEFjY291bnRJZCwgU1ZNWENfX1Byb2R1Y3RfX2MsIFNWTVhDX19Qcm9kdWN0X19yLk5hbWUsICIgKw0KCQkgICAgIlNWTVhDX19Db21wb25lbnRfX2MsIFNWTVhDX19Db21wb25lbnRfX3IuU1ZNWENfX1NlcmlhbF9Mb3RfTnVtYmVyX19jLCBTVk1YQ19fQ29tcG9uZW50X19yLlNWTVhDX19Qcm9kdWN0X19jLCAiICsNCgkJICAgICJTVk1YQ19fVG9wX0xldmVsX19jLCBTVk1YQ19fVG9wX0xldmVsX19yLlNWTVhDX19TZXJpYWxfTG90X051bWJlcl9fYywgIiArDQoJCSAgICAiU1ZNWENfX1RvcF9MZXZlbF9fci5TVk1YQ19fUHJvZHVjdF9fYyBGUk9NIENhc2UgV0hFUkUgSWQgPSAnIiArIG9iamlkICsgIiciOw0KCXZhciBxcjEgPSBzZm9yY2UuY29ubmVjdGlvbi5xdWVyeShzb3FsMSk7DQoJdmFyIGNhc2VyZWMgPSBxcjEuZ2V0QXJyYXkoInJlY29yZHMiKVswXTsNCglBY2N0SWQgPSBjYXNlcmVjLkFjY291bnRJZDsNCglpZihjYXNlcmVjLlNWTVhDX19Qcm9kdWN0X19yKQ0KCSAgICB7DQoJICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwcm9kdWN0IikudmFsdWUgPSBjYXNlcmVjLlNWTVhDX19Qcm9kdWN0X19yLk5hbWU7DQoJICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwcm9kdWN0X2xraWQiKS52YWx1ZSA9IGNhc2VyZWMuU1ZNWENfX1Byb2R1Y3RfX2M7DQoJICAgIH0NCglpZiAoY2FzZXJlYy5TVk1YQ19fQ29tcG9uZW50X19jICYmIGNhc2VyZWMuU1ZNWENfX0NvbXBvbmVudF9fYy5sZW5ndGggPiAwKQ0KCSAgICB7DQoJICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZXJpYWwiKS52YWx1ZSA9IGNhc2VyZWMuU1ZNWENfX0NvbXBvbmVudF9fci5TVk1YQ19fU2VyaWFsX0xvdF9OdW1iZXJfX2M7DQoJICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZXJpYWxfbGtpZCIpLnZhbHVlID0gY2FzZXJlYy5TVk1YQ19fQ29tcG9uZW50X19jOw0KCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaWJwcm9kaWQiKS52YWx1ZSA9IGNhc2VyZWMuU1ZNWENfX0NvbXBvbmVudF9fci5TVk1YQ19fUHJvZHVjdF9fYzsNCgkgICAgfQ0KCWlmIChjYXNlcmVjLlNWTVhDX19Ub3BfTGV2ZWxfX2MgJiYgY2FzZXJlYy5TVk1YQ19fVG9wX0xldmVsX19jLmxlbmd0aCA+IDApDQoJICAgIHsNCgkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRvcF9zZXJpYWwiKS52YWx1ZSA9IGNhc2VyZWMuU1ZNWENfX1RvcF9MZXZlbF9fci5TVk1YQ19fU2VyaWFsX0xvdF9OdW1iZXJfX2M7DQoJICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0b3Bfc2VyaWFsX2xraWQiKS52YWx1ZSA9IGNhc2VyZWMuU1ZNWENfX1RvcF9MZXZlbF9fYzsNCgkgICAgaWYgKGNhc2VyZWMuU1ZNWENfX1RvcF9MZXZlbF9fci5TVk1YQ19fUHJvZHVjdF9fYyAmJiBjYXNlcmVjLlNWTVhDX19Ub3BfTGV2ZWxfX3IuU1ZNWENfX1Byb2R1Y3RfX2MubGVuZ3RoID4gMCkNCgkJew0KCQl2YXIgc29xbDIgPSAiU0VMRUNUIElkLCBOYW1lIEZST00gUHJvZHVjdDIgV0hFUkUgSWQgPSAnIiArIGNhc2VyZWMuU1ZNWENfX1RvcF9MZXZlbF9fci5TVk1YQ19fUHJvZHVjdF9fYyArICInIjsNCgkJdmFyIHFyMiA9IHNmb3JjZS5jb25uZWN0aW9uLnF1ZXJ5KHNvcWwyKTsNCgkJaWYgKHFyMi5zaXplID4gMCkNCgkJICAgIHsNCgkJICAgIHZhciBwcmVjID0gcXIyLmdldEFycmF5KCJyZWNvcmRzIilbMF07DQoJCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidG9wX3Byb2R1Y3QiKS52YWx1ZSA9IHByZWMuTmFtZTsNCgkJICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0b3BfcHJvZHVjdF9sa2lkIikudmFsdWUgPSBwcmVjLklkOw0KCQkgICAgfQ0KCQl9DQoJICAgIH0NCgl9DQogICAgZWxzZQkJLy8gVGhlIHBhcmVudCBlbnRpdGxlZCBvYmplY3QgaXMgYSBTZXJ2aWNlIE9yZGVyDQoJew0KICAgIAlFbnRTVk9JZCA9IG9iamlkOw0KCXZhciBzb3FsMiA9ICJTRUxFQ1QgU1ZNWFBfX0NvbXBhbnlfX2MsIFNWTVhQX19Db21wb25lbnRfX2MsIFNWTVhQX19Db21wb25lbnRfX3IuU1ZNWENfX1Byb2R1Y3RfX2MsICIgKw0KCQkgICAgIlNWTVhQX19Db21wb25lbnRfX3IuU1ZNWENfX1NlcmlhbF9Mb3RfTnVtYmVyX19jLCBTVk1YUF9fVG9wX0xldmVsX19jLCAiICsNCgkJICAgICJTVk1YUF9fVG9wX0xldmVsX19yLlNWTVhDX19TZXJpYWxfTG90X051bWJlcl9fYywgU1ZNWFBfX1RvcF9MZXZlbF9fci5TVk1YQ19fUHJvZHVjdF9fYyAiICsNCgkJICAgICJGUk9NIFNWTVhDX19TZXJ2aWNlX09yZGVyX19jIFdIRVJFIElkID0gJyIgKyBvYmppZCArICInIjsNCgl2YXIgcXIyID0gc2ZvcmNlLmNvbm5lY3Rpb24ucXVlcnkoc29xbDIpOw0KCXZhciBzdm9yZWMgPSBxcjIuZ2V0QXJyYXkoInJlY29yZHMiKVswXTsNCglBY2N0SWQgPSBzdm9yZWMuU1ZNWFBfX0NvbXBhbnlfX2M7DQoNCglpZiAoc3ZvcmVjLlNWTVhQX19Db21wb25lbnRfX2MgJiYgc3ZvcmVjLlNWTVhQX19Db21wb25lbnRfX2MubGVuZ3RoID4gMCkNCgkgICAgew0KCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2VyaWFsIikudmFsdWUgPSBzdm9yZWMuU1ZNWFBfX0NvbXBvbmVudF9fci5TVk1YQ19fU2VyaWFsX0xvdF9OdW1iZXJfX2M7DQoJICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZXJpYWxfbGtpZCIpLnZhbHVlID0gc3ZvcmVjLlNWTVhQX19Db21wb25lbnRfX2M7DQoNCgkgICAgaWYgKHN2b3JlYy5TVk1YUF9fQ29tcG9uZW50X19yLlNWTVhDX19Qcm9kdWN0X19jICYmIHN2b3JlYy5TVk1YUF9fQ29tcG9uZW50X19yLlNWTVhDX19Qcm9kdWN0X19jLmxlbmd0aCA+IDApDQoJCXsNCgkJdmFyIHNvcWxwMSA9ICJTRUxFQ1QgSWQsIE5hbWUgRlJPTSBQcm9kdWN0MiBXSEVSRSBJZCA9ICciICsgc3ZvcmVjLlNWTVhQX19Db21wb25lbnRfX3IuU1ZNWENfX1Byb2R1Y3RfX2MgKyAiJyI7DQoJCXZhciBxcnAxID0gc2ZvcmNlLmNvbm5lY3Rpb24ucXVlcnkoc29xbHAxKTsNCgkJaWYgKHFycDEuc2l6ZSA+IDApDQoJCSAgICB7DQoJCSAgICB2YXIgcHJlYzEgPSBxcnAxLmdldEFycmF5KCJyZWNvcmRzIilbMF07DQoJCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicHJvZHVjdCIpLnZhbHVlID0gcHJlYzEuTmFtZTsNCgkJICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpYnByb2RpZCIpLnZhbHVlID0gcHJlYzEuSWQ7DQoJCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicHJvZHVjdF9sa2lkIikudmFsdWUgPSBwcmVjMS5JZDsNCgkJICAgIH0NCgkJfQ0KCSAgICB9DQoJaWYgKHN2b3JlYy5TVk1YUF9fVG9wX0xldmVsX19jICYmIHN2b3JlYy5TVk1YUF9fVG9wX0xldmVsX19jLmxlbmd0aCA+IDApDQoJICAgIHsNCgkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRvcF9zZXJpYWwiKS52YWx1ZSA9IHN2b3JlYy5TVk1YUF9fVG9wX0xldmVsX19yLlNWTVhDX19TZXJpYWxfTG90X051bWJlcl9fYzsNCgkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRvcF9zZXJpYWxfbGtpZCIpLnZhbHVlID0gc3ZvcmVjLlNWTVhQX19Ub3BfTGV2ZWxfX2M7DQoNCgkgICAgaWYgKHN2b3JlYy5TVk1YUF9fVG9wX0xldmVsX19yLlNWTVhDX19Qcm9kdWN0X19jICYmIHN2b3JlYy5TVk1YUF9fVG9wX0xldmVsX19yLlNWTVhDX19Qcm9kdWN0X19jLmxlbmd0aCA+IDApDQoJCXsNCgkJdmFyIHNvcWxwMiA9ICJTRUxFQ1QgSWQsIE5hbWUgRlJPTSBQcm9kdWN0MiBXSEVSRSBJZCA9ICciICsgc3ZvcmVjLlNWTVhQX19Ub3BfTGV2ZWxfX3IuU1ZNWENfX1Byb2R1Y3RfX2MgKyAiJyI7DQoJCXZhciBxcnAyID0gc2ZvcmNlLmNvbm5lY3Rpb24ucXVlcnkoc29xbHAyKTsNCgkJaWYgKHFycDIuc2l6ZSA+IDApDQoJCSAgICB7DQoJCSAgICB2YXIgcHJlYzIgPSBxcnAyLmdldEFycmF5KCJyZWNvcmRzIilbMF07DQoJCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidG9wX3Byb2R1Y3QiKS52YWx1ZSA9IHByZWMyLk5hbWU7DQoJCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidG9wX3Byb2R1Y3RfbGtpZCIpLnZhbHVlID0gcHJlYzIuSWQ7DQoJCSAgICB9DQoJCX0NCgkgICAgfQ0KCX0NCg0KICAgIAkJLy8gQ2hlY2sgaWYgdGhlIGNhc2UvU1ZPIGlzIGVudGl0bGVkIGFscmVhZHkuDQoJCS8vIERpc3BsYXkgZW50aXRsZW1lbnQgaW5mb3JtYXRpb24NCiAgICB2YXIgc29xbDMgPSAiU0VMRUNUIFNWTVhDX19EYXRlX29mX2VudGl0bGVtZW50X19jLCBTVk1YQ19fU3RhcnRfRGF0ZV9fYywgU1ZNWENfX0VuZF9EYXRlX19jLCAiICsNCgkJIlNWTVhDX19FbnRpdGxlbWVudF9Ob3Rlc19fYywgU1ZNWENfX1dhcnJhbnR5X19jLCBTVk1YQ19fV2FycmFudHlfX3IuTmFtZSwgIiArDQoJCSJTVk1YQ19fU2VydmljZV9Db250cmFjdF9fYywgU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX3IuTmFtZSAiICsNCgkJIkZST00gU1ZNWENfX0VudGl0bGVtZW50X0hpc3RvcnlfX2MgV0hFUkUgU1ZNWENfX0luYWN0aXZlX0RhdGVfX2MgPSBudWxsIEFORCAiOw0KICAgIGlmIChvYmp0eXBlID09ICdDQVNFJykNCiAgICAJc29xbDMgKz0gIlNWTVhDX19DYXNlX19jID0gJyIgKyBFbnRDYXNlSWQgKyAiJyI7DQogICAgZWxzZQ0KICAgIAlzb3FsMyArPSAiU1ZNWFBfX1NlcnZpY2VfT3JkZXJfX2MgPSAnIiArIEVudFNWT0lkICsgIiciOw0KICAgIHZhciBxcjMgPSBzZm9yY2UuY29ubmVjdGlvbi5xdWVyeShzb3FsMyk7DQogICAgaWYgKHFyMy5zaXplID4gMCkNCiAgICAJew0KCXZhciBlbnRyZWMgPSBxcjMuZ2V0QXJyYXkoInJlY29yZHMiKVswXTsNCg0KCWlmIChlbnRyZWMuU1ZNWENfX0VudGl0bGVtZW50X25vdGVzX19jKQ0KCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50X25vdGVzIikudmFsdWUgPSBlbnRyZWMuU1ZNWENfX0VudGl0bGVtZW50X25vdGVzX19jOw0KDQoJdmFyIGVudF9kYXRlID0gZW50cmVjLlNWTVhDX19EYXRlX29mX2VudGl0bGVtZW50X19jOw0KCXZhciBkYyA9IGVudF9kYXRlLnNwbGl0KCctJywgMyk7DQoJdmFyIGQgPSBuZXcgRGF0ZShkY1swXSwgZGNbMV0gLSAxLCBkY1syXSk7DQoJdmFyIGRmbXQgPSBwYXJlbnQuVXNlckNvbnRleHQuZGF0ZUZvcm1hdDsNCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50X2RhdGUiKS5pbm5lckhUTUwgPSBEYXRlVXRpbC5mb3JtYXREYXRlKGQsIGRmbXQpOw0KCWlmIChlbnRyZWMuU1ZNWENfX1dhcnJhbnR5X19jKQ0KCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50X3dhcnIiKS5pbm5lckhUTUwgPSBlbnRyZWMuU1ZNWENfX1dhcnJhbnR5X19yLk5hbWU7DQoJaWYgKGVudHJlYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fYykNCgkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudF9zYyIpLmlubmVySFRNTCA9IGVudHJlYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fci5OYW1lOw0KDQoJdmFyIGVudF9zdGFydF9kYXRlID0gZW50cmVjLlNWTVhDX19TdGFydF9EYXRlX19jOw0KCWRjID0gZW50X3N0YXJ0X2RhdGUuc3BsaXQoJy0nLCAzKTsNCglkID0gbmV3IERhdGUoZGNbMF0sIGRjWzFdIC0gMSwgZGNbMl0pOw0KCWRmbXQgPSBwYXJlbnQuVXNlckNvbnRleHQuZGF0ZUZvcm1hdDsNCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50X3N0YXJ0X2RhdGUiKS5pbm5lckhUTUwgPSBEYXRlVXRpbC5mb3JtYXREYXRlKGQsIGRmbXQpOw0KDQoJdmFyIGVudF9lbmRfZGF0ZSA9IGVudHJlYy5TVk1YQ19fRW5kX0RhdGVfX2M7DQoJZGMgPSBlbnRfZW5kX2RhdGUuc3BsaXQoJy0nLCAzKTsNCglkID0gbmV3IERhdGUoZGNbMF0sIGRjWzFdIC0gMSwgZGNbMl0pOw0KCWRmbXQgPSBwYXJlbnQuVXNlckNvbnRleHQuZGF0ZUZvcm1hdDsNCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50X2VuZF9kYXRlIikuaW5uZXJIVE1MID0gRGF0ZVV0aWwuZm9ybWF0RGF0ZShkLCBkZm10KTsNCg0KCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRpbmZvIikuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7IA0KCX0NCiAgICBlbHNlDQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VudGluZm8nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyANCg0KICAgIHJldHVybiB0cnVlOw0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KLy8gUHJvY2VzcyB0aGUgZXZlbnQgb2YgZXhpdGluZyBzZXJpYWwgbnVtYmVyDQovLyBQb3B1bGF0ZSBwcm9kdWN0IG5hbWUgJiBJZA0KZnVuY3Rpb24gU1ZNWENfRU5fRXhpdFNlcmlhbCgpDQp7DQogICAgZm91bmQgPSB0cnVlOw0KICAgIHZhciBsa2lkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNlcmlhbF9sa2lkIikudmFsdWU7DQogICAgaWYobGtpZC5sZW5ndGggPiAwICYmIGxraWQgIT0gRW50SWJJZCkNCiAgICAJew0KCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0b3BfcHJvZHVjdCIpLnZhbHVlID0gIiI7DQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRvcF9wcm9kdWN0X2xraWQiKS52YWx1ZSA9ICIiOw0KCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0b3Bfc2VyaWFsIikudmFsdWUgPSAiIjsNCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidG9wX3NlcmlhbF9sa2lkIikudmFsdWUgPSAiIjsNCg0KCXZhciBzb3FsMSA9ICJTRUxFQ1QgU1ZNWENfX1Byb2R1Y3RfX2MsIFNWTVhDX19Qcm9kdWN0X19yLk5hbWUsIFNWTVhDX19Ub3BfTGV2ZWxfX2MsICIgKw0KCQkgICAgIlNWTVhDX19Ub3BfTGV2ZWxfX3IuU1ZNWENfX1NlcmlhbF9Mb3RfTnVtYmVyX19jLCBTVk1YQ19fVG9wX0xldmVsX19yLlNWTVhDX19Qcm9kdWN0X19jICIgKw0KCQkgICAgIkZST00gU1ZNWENfX0luc3RhbGxlZF9Qcm9kdWN0X19jIFdIRVJFIElkID0gJyIgKyBsa2lkICsgIiciOw0KCXZhciBxcjEgPSBzZm9yY2UuY29ubmVjdGlvbi5xdWVyeShzb3FsMSk7DQoJaWYgKHFyMSAmJiBxcjEuc2l6ZSA+IDApDQoJICAgIHsNCgkgICAgdmFyIHJlYzEgPSBxcjEuZ2V0QXJyYXkoInJlY29yZHMiKVswXTsNCgkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByb2R1Y3QiKS52YWx1ZSA9IHJlYzEuU1ZNWENfX1Byb2R1Y3RfX3IuTmFtZTsNCgkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByb2R1Y3RfbGtpZCIpLnZhbHVlID0gcmVjMS5TVk1YQ19fUHJvZHVjdF9fYzsNCgkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlicHJvZGlkIikudmFsdWUgPSByZWMxLlNWTVhDX19Qcm9kdWN0X19jOw0KCSAgICBpZiAocmVjMS5TVk1YQ19fVG9wX0xldmVsX19jKQ0KCQl7DQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0b3Bfc2VyaWFsX2xraWQiKS52YWx1ZSA9IHJlYzEuU1ZNWENfX1RvcF9MZXZlbF9fYzsNCgkJaWYgKHJlYzEuU1ZNWENfX1RvcF9MZXZlbF9fci5TVk1YQ19fU2VyaWFsX0xvdF9OdW1iZXJfX2MpDQoJCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidG9wX3NlcmlhbCIpLnZhbHVlID0gcmVjMS5TVk1YQ19fVG9wX0xldmVsX19yLlNWTVhDX19TZXJpYWxfTG90X051bWJlcl9fYzsNCgkJfQ0KDQoJICAgIGlmIChyZWMxLlNWTVhDX19Ub3BfTGV2ZWxfX2MgJiYgcmVjMS5TVk1YQ19fVG9wX0xldmVsX19yLlNWTVhDX19Qcm9kdWN0X19jKQ0KCSAgICAJew0KCQl2YXIgc29xbDIgPSAiU0VMRUNUIE5hbWUgRlJPTSBQcm9kdWN0MiBXSEVSRSBJZCA9ICciICsgcmVjMS5TVk1YQ19fVG9wX0xldmVsX19yLlNWTVhDX19Qcm9kdWN0X19jICsgIiciOw0KCQl2YXIgcXIyID0gc2ZvcmNlLmNvbm5lY3Rpb24ucXVlcnkoc29xbDIpOw0KCQlpZiAocXIyICYmIHFyMi5zaXplID4gMCkNCgkJICAgIHsNCgkJICAgIHZhciByZWMyID0gcXIyLmdldEFycmF5KCJyZWNvcmRzIilbMF07DQoJCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidG9wX3Byb2R1Y3QiKS52YWx1ZSA9IHJlYzIuTmFtZTsNCgkJICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0b3BfcHJvZHVjdF9sa2lkIikudmFsdWUgPSByZWMxLlNWTVhDX19Ub3BfTGV2ZWxfX3IuU1ZNWENfX1Byb2R1Y3RfX2M7DQoJCSAgICB9DQoJCX0NCgkgICAgfQ0KCWVsc2UNCgkgICAgZm91bmQgPSBmYWxzZTsNCgl9DQogICAgZWxzZSBpZiAobGtpZC5sZW5ndGggPT0gMCkNCgl7DQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRvcF9wcm9kdWN0IikudmFsdWUgPSAiIjsNCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidG9wX3NlcmlhbCIpLnZhbHVlID0gIiI7DQoJfQ0KDQogICAgaWYoIWZvdW5kKQ0KICAgIAl7DQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByb2R1Y3QiKS52YWx1ZSA9ICIiOw0KCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwcm9kdWN0X2xraWQiKS52YWx1ZSA9ICIiOw0KCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpYnByb2RpZCIpLnZhbHVlID0gIiI7DQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNlcmlhbF9sYWJlbCIpLmhyZWYgPSAiIyI7DQoJfQ0KICAgIGVsc2UNCgl7DQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNlcmlhbF9sYWJlbCIpLmhyZWYgPSAiLyIgKyBsa2lkOw0KCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZXJpYWxfbGFiZWwiKS50YXJnZXQgPSAiX2JsYW5rIjsNCgl9DQogICAgRW50SWJJZCA9IGxraWQ7DQp9DQovKj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovDQovLyBQcm9jZXNzIHRoZSBldmVudCBvZiBleGl0aW5nIHByb2R1Y3QNCi8vIENsZWFyIHNlcmlhbCBudW1iZXIgaWYgaXQgZG9lcyBub3QgYmVsb25nIHRvIHRoZSBzYW1lIHByb2R1Y3QNCmZ1bmN0aW9uIFNWTVhDX0VOX0V4aXRQcm9kdWN0KCkNCnsNCiAgICBtYXRjaGVkID0gZmFsc2U7DQoNCiAgICB2YXIgbGtpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwcm9kdWN0X2xraWQiKS52YWx1ZTsNCiAgICB2YXIgaWJwcm9kaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaWJwcm9kaWQiKS52YWx1ZTsNCiAgICBpZiAobGtpZC5sZW5ndGggPiAwICYmIGlicHJvZGlkLmxlbmd0aCA+IDAgJiYgbGtpZCA9PSBpYnByb2RpZCkNCiAgICAJbWF0Y2hlZCA9IHRydWU7DQoNCiAgICBpZiAoIW1hdGNoZWQpDQogICAgCXsNCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2VyaWFsIikudmFsdWUgPSAiIjsNCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2VyaWFsX2xraWQiKS52YWx1ZSA9ICIiOw0KCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpYnByb2RpZCIpLnZhbHVlID0gIiI7DQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRvcF9wcm9kdWN0IikudmFsdWUgPSAiIjsNCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidG9wX3NlcmlhbCIpLnZhbHVlID0gIiI7DQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByb2R1Y3RfbGFiZWwiKS5ocmVmID0gIiMiOw0KCX0NCiAgICBlbHNlDQoJew0KCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwcm9kdWN0X2xhYmVsIikuaHJlZiA9ICIvIiArIGxraWQ7DQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByb2R1Y3RfbGFiZWwiKS50YXJnZXQgPSAiX2JsYW5rIjsNCgl9DQp9DQovKj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovDQovLyBDaGVjayBlbnRpdGxlbWVudCBhZnRlciBhIGRlbGF5IG9mIDMgc2Vjb25kcw0KZnVuY3Rpb24gU1ZNWENfRU5fQ2hlY2tFbnRpdGxlbWVudERlbGF5KCkNCnsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZW53YWl0bXNnJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7IA0KICAgIHNldFRpbWVvdXQoIlNWTVhDX0VOX0NoZWNrRW50aXRsZW1lbnQoKSIsIDEwMDApOw0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KLy8gV3JhcHBlciB0byBjaGVjayBlbnRpdGxlbWVudC4gUGVyZm9ybSB0aGUgNiBzdGVwcyBiZWxvdyBmb3IgY29tcG9uZW50IGZpcnN0IGFuZCB0b3AtbGV2ZWwgSUIgbmV4dA0KLy8gMS4gQ2hlY2sgc2VydmljZSBjb250cmFjdHMgd2l0aCBhIGJyb2FkIGNvdmVyYWdlDQovLyAyLiBDaGVjayB3YXJyYW50eSBmb3IgSUINCi8vIDMuIENoZWNrIHNlcnZpY2UgY29udHJhY3RzIGZvciBJQg0KLy8gNC4gQ2hlY2sgc2VydmljZSBjb250cmFjdHMgZm9yIHByb2R1Y3QNCi8vIDUuIENoZWNrIHNlcnZpY2UgY29udHJhY3RzIGZvciBwcm9kdWN0IGZhbWlseQ0KLy8gNi4gQ2hlY2sgc2VydmljZSBjb250cmFjdHMgZm9yIHByb2R1Y3QgbGluZQ0KZnVuY3Rpb24gU1ZNWENfRU5fQ2hlY2tFbnRpdGxlbWVudCgpDQp7DQoJDQoJdmFyIEliSWQgPSIiOw0KCXZhciBJYk5hbWUgPSIiOw0KCXZhciBUb3BJYklkPSIiOw0KCXZhciBUb3BJYk5hbWUgPSIiOw0KCWVudHJvd251bSA9IDA7DQoJdHJ5ew0KICAgIHZhciB0Ym9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaXN0X3Rib2R5Jyk7DQogICAgY2xlYXJfdGFibGUodGJvZHkpOw0KCX1jYXRjaChlKXt9DQoNCiAgICBQcm9kSWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZHVjdF9sa2lkJykudmFsdWU7DQogICAgUHJvZE5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZHVjdCcpLnZhbHVlOw0KCQ0KCWlmKHRyaW0oZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlcmlhbCcpLnZhbHVlKSAhPSIiKQ0KCXsNCgkJSWJJZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZXJpYWxfbGtpZCcpLnZhbHVlOw0KCQlJYk5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VyaWFsJykudmFsdWU7DQoJCVRvcEliSWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9wX3NlcmlhbF9sa2lkJykudmFsdWU7DQoJICAgIFRvcEliTmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b3Bfc2VyaWFsJykudmFsdWU7DQoJfQ0KCWVsc2UNCgl7DQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZXJpYWxfbGtpZCcpLnZhbHVlPSIiOw0KCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9wX3NlcmlhbF9sa2lkJykudmFsdWU9IiI7DQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZXJpYWwnKS52YWx1ZT0iIjsNCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvcF9zZXJpYWwnKS52YWx1ZT0iIjsNCg0KCX0NCiAgICBUb3BQcm9kSWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9wX3Byb2R1Y3RfbGtpZCcpLnZhbHVlOw0KICAgIFRvcFByb2ROYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvcF9wcm9kdWN0JykudmFsdWU7DQogICANCg0KICAgIGlmIChQcm9kSWQubGVuZ3RoIDw9IDAgJiYgSWJJZC5sZW5ndGggPD0gMCkNCiAgICAJew0KCWFsZXJ0KFNWTVhDX0dldE1lc3NhZ2UoIk1TRzAwMyIpKTsNCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZW53YWl0bXNnJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgDQoJcmV0dXJuIGZhbHNlOw0KCX0NCg0KICAgIEhlYWRlckRvbmUgPSBmYWxzZTsNCg0KICAgIFNWTVhDX0VOX0dldEJyb2FkU2VydmljZUNvbnRyYWN0cyhBY2N0SWQpOw0KDQogICAgaWYgKEliSWQubGVuZ3RoID4gMCkNCiAgICAJew0KCVNWTVhDX0VOX0dldFdhcnJhbnR5UmVjb3JkcyhJYklkKTsNCglTVk1YQ19FTl9HZXRTZXJ2aWNlQ29udHJhY3QoQWNjdElkLCBJYklkLCBJYk5hbWUsICJJQiIpOw0KCX0NCiAgICBpZiAoUHJvZElkLmxlbmd0aCA+IDApDQogICAgCXsNCglTVk1YQ19FTl9HZXRTZXJ2aWNlQ29udHJhY3QoQWNjdElkLCBQcm9kSWQsIFByb2ROYW1lLCAiUFJPRCIpOw0KDQoJdmFyIHFyMSA9IHNmb3JjZS5jb25uZWN0aW9uLnF1ZXJ5KCJTRUxFQ1QgRmFtaWx5LCBTVk1YQ19fUHJvZHVjdF9MaW5lX19jIEZST00gUHJvZHVjdDIgV0hFUkUgSWQgPSAnIiArIFByb2RJZCArICInIik7DQoJdmFyIHJlYzEgPSBxcjEuZ2V0QXJyYXkoInJlY29yZHMiKVswXTsNCglpZiAocmVjMS5GYW1pbHkgJiYgcmVjMS5GYW1pbHkubGVuZ3RoID4gMCkNCgkgICAgU1ZNWENfRU5fR2V0U2VydmljZUNvbnRyYWN0KEFjY3RJZCwgcmVjMS5GYW1pbHksIHJlYzEuRmFtaWx5LCAiRkFNSUxZIik7DQoNCglpZiAocmVjMS5TVk1YQ19fUHJvZHVjdF9MaW5lX19jICYmIHJlYzEuU1ZNWENfX1Byb2R1Y3RfTGluZV9fYy5sZW5ndGggPiAwKQ0KCSAgICBTVk1YQ19FTl9HZXRTZXJ2aWNlQ29udHJhY3QoQWNjdElkLCByZWMxLlNWTVhDX19Qcm9kdWN0X0xpbmVfX2MsIHJlYzEuU1ZNWENfX1Byb2R1Y3RfTGluZV9fYywgIkxJTkUiKTsNCgl9DQoNCiAgICBpZiAoVG9wSWJJZC5sZW5ndGggPiAwKQ0KICAgIAl7DQoJU1ZNWENfRU5fR2V0V2FycmFudHlSZWNvcmRzKFRvcEliSWQpOw0KCVNWTVhDX0VOX0dldFNlcnZpY2VDb250cmFjdChBY2N0SWQsIFRvcEliSWQsIFRvcEliTmFtZSwgIklCIik7DQoJfQ0KICAgIGlmIChUb3BQcm9kSWQubGVuZ3RoID4gMCkNCiAgICAJew0KCVNWTVhDX0VOX0dldFNlcnZpY2VDb250cmFjdChBY2N0SWQsIFRvcFByb2RJZCwgVG9wUHJvZE5hbWUsICJQUk9EIik7DQoJdmFyIHFyMiA9IHNmb3JjZS5jb25uZWN0aW9uLnF1ZXJ5KCJTRUxFQ1QgRmFtaWx5LCBTVk1YQ19fUHJvZHVjdF9MaW5lX19jIEZST00gUHJvZHVjdDIgV0hFUkUgSWQgPSAnIiArIFRvcFByb2RJZCArICInIik7DQoJdmFyIHJlYzIgPSBxcjIuZ2V0QXJyYXkoInJlY29yZHMiKVswXTsNCglpZiAocmVjMi5GYW1pbHkgJiYgcmVjMi5GYW1pbHkubGVuZ3RoID4gMCkNCgkgICAgU1ZNWENfRU5fR2V0U2VydmljZUNvbnRyYWN0KEFjY3RJZCwgcmVjMi5GYW1pbHksIHJlYzIuRmFtaWx5LCAiRkFNSUxZIik7DQoNCglpZiAocmVjMi5TVk1YQ19fUHJvZHVjdF9MaW5lX19jICYmIHJlYzIuU1ZNWENfX1Byb2R1Y3RfTGluZV9fYy5sZW5ndGggPiAwKQ0KCSAgICBTVk1YQ19FTl9HZXRTZXJ2aWNlQ29udHJhY3QoQWNjdElkLCByZWMyLlNWTVhDX19Qcm9kdWN0X0xpbmVfX2MsIHJlYzIuU1ZNWENfX1Byb2R1Y3RfTGluZV9fYywgIkxJTkUiKTsNCgl9DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vud2FpdG1zZycpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IA0KICAgIGlmIChlbnRyb3dudW0gPD0gMCkNCiAgICAJew0KCWFsZXJ0KFNWTVhDX0dldE1lc3NhZ2UoIk1TRzAwOSIpKTsNCglyZXR1cm4gZmFsc2U7DQoJfQ0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KLy8gRHJhdyBlbnRpdGxlbWVudCBoZWFkZXIgDQpmdW5jdGlvbiBTVk1YQ19FTl9EcmF3SGVhZGVyKCkNCnsNCiAgICBpZiAoSGVhZGVyRG9uZSkgcmV0dXJuOw0KCXRyeXsNCiAgICB2YXIgdGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGlzdF90Ym9keScpOw0KICAgIGNsZWFyX3RhYmxlKHRib2R5KTsNCgl9Y2F0Y2goZSl7fQ0KDQogICAgdmFyIHRyID0gbWFrZVJvdyh7J2NsYXNzJzonaGVhZGVyUm93J30pOw0KICAgIHRib2R5LmFwcGVuZENoaWxkKHRyKTsNCiAgICB2YXIgY29sMSA9IFNWTVhDX0dldE1lc3NhZ2UoIkxBQjAxNiIpOwkvLyBTZWxlY3QNCiAgICB2YXIgY29sMiA9IFNWTVhDX0dldE1lc3NhZ2UoIkxBQjAxNyIpOwkvLyBXYXJyYW50eS9TZXJ2aWNlIENvbnRyYWN0DQogICAgdmFyIGNvbDMgPSBTVk1YQ19HZXRNZXNzYWdlKCJMQUIwMTgiKTsJLy8gQ292ZXJhZ2UgRGV0YWlscw0KICAgIHZhciBjb2w0ID0gU1ZNWENfR2V0TWVzc2FnZSgiTEFCMDE5Iik7CS8vIFNlcnZpY2UgTGV2ZWwNCiAgICB2YXIgY29sNSA9IFNWTVhDX0dldE1lc3NhZ2UoIkxBQjAyMCIpOwkvLyBSZW5ld2FsIE51bWJlcg0KICAgIHZhciBjb2w2ID0gU1ZNWENfR2V0TWVzc2FnZSgiTEFCMDIxIik7CS8vIFJlbmV3YWwgRGF0ZQ0KICAgIHZhciBjb2w3ID0gU1ZNWENfR2V0TWVzc2FnZSgiTEFCMDIyIik7CS8vIFN0YXJ0IERhdGUNCiAgICB2YXIgY29sOCA9IFNWTVhDX0dldE1lc3NhZ2UoIkxBQjAyMyIpOwkvLyBFbmQgRGF0ZQ0KCQ0KDQogICAgY3JlYXRlVGFnKHRyLCJ0aCIseydzY29wZSc6J2NvbCcsJ2FsaWduJzonY2VudGVyJ30pLmlubmVySFRNTCA9ICI8YSBocmVmPVwiI1wiIHRpdGxlPVwiXCI+IiArIGNvbDEgKyAiPC9hPiI7DQogICAgY3JlYXRlVGFnKHRyLCJ0aCIseydzY29wZSc6J2NvbCd9KS5pbm5lckhUTUwgPSAiPGEgaHJlZj1cIiNcIiB0aXRsZT1cIlwiPiIgKyBjb2wyICsgIjwvYT4iOw0KICAgIGNyZWF0ZVRhZyh0ciwidGgiLHsnc2NvcGUnOidjb2wnfSkuaW5uZXJIVE1MID0gIjxhIGhyZWY9XCIjXCIgdGl0bGU9XCJcIj4iICsgY29sMyArICI8L2E+IjsNCiAgICBjcmVhdGVUYWcodHIsInRoIix7J3Njb3BlJzonY29sJ30pLmlubmVySFRNTCA9ICI8YSBocmVmPVwiI1wiIHRpdGxlPVwiXCI+IiArIGNvbDQgKyAiPC9hPiI7DQogICAgY3JlYXRlVGFnKHRyLCJ0aCIseydzY29wZSc6J2NvbCd9KS5pbm5lckhUTUwgPSAiPGEgaHJlZj1cIiNcIiB0aXRsZT1cIlwiPiIgKyBjb2w1ICsgIjwvYT4iOw0KICAgIGNyZWF0ZVRhZyh0ciwidGgiLHsnc2NvcGUnOidjb2wnfSkuaW5uZXJIVE1MID0gIjxhIGhyZWY9XCIjXCIgdGl0bGU9XCJcIj4iICsgY29sNiArICI8L2E+IjsNCiAgICBjcmVhdGVUYWcodHIsInRoIix7J3Njb3BlJzonY29sJ30pLmlubmVySFRNTCA9ICI8YSBocmVmPVwiI1wiIHRpdGxlPVwiXCI+IiArIGNvbDcgKyAiPC9hPiI7DQogICAgY3JlYXRlVGFnKHRyLCJ0aCIseydzY29wZSc6J2NvbCd9KS5pbm5lckhUTUwgPSAiPGEgaHJlZj1cIiNcIiB0aXRsZT1cIlwiPiIgKyBjb2w4ICsgIjwvYT4iOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhZGRsc2NpbmZvIikuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgDQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFkZGx3YXJyaW5mbyIpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IA0KICAgIEhlYWRlckRvbmUgPSB0cnVlOw0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KLy8gR2V0IGFjdGl2ZSB3YXJyYW50eSwgaWYgYXZhaWxhYmxlLCBmb3IgdGhlIGdpdmVuIElCDQpmdW5jdGlvbiBTVk1YQ19FTl9HZXRXYXJyYW50eVJlY29yZHMoaWJfaWQpDQp7DQogICAgdmFyIGJhc2Vzb3FsID0gIlNFTEVDVCBJZCwgU1ZNWENfX1NlcnZpY2VfVGVtcGxhdGVfX2MsIFNWTVhDX19TZXJ2aWNlX1RlbXBsYXRlX19yLk5hbWUsICIgKw0KICAgIAkJIlNWTVhDX19TdGFydF9EYXRlX19jLCBTVk1YQ19fRW5kX0RhdGVfX2MsIFNWTVhDX19FeGNsdXNpb25zX19jLCAiICsNCgkJIlNWTVhDX19JbnZvaWNlX1JlcXVpcmVkX19jLCBTVk1YQ19fTG9hbmVyX1Byb3ZpZGVkX19jLCBTVk1YQ19fT25zaXRlX1JlcGFpcl9fYywgIiArDQoJCSJTVk1YQ19fUk1BX1JlcXVpcmVkX19jLCBTVk1YQ19fU2hpcG1lbnRfQWxsb3dlZF9fYywgU1ZNWENfX1RyYW5zZmVyYWJsZV9fYywgIiArIA0KCQkiU1ZNWENfX1dhbGtfaW5fQWxsb3dlZF9fYyBGUk9NIFNWTVhDX19XYXJyYW50eV9fYyAiICsNCgkJIldIRVJFIFNWTVhDX19JbnN0YWxsZWRfUHJvZHVjdF9fYyA9ICciICsgaWJfaWQgKyAiJyAiOw0KDQogICAgdmFyIHNvcWwxID0gYmFzZXNvcWwgKyAiQU5EIFNWTVhDX19TdGFydF9EYXRlX19jIDw9IFRPREFZIEFORCBTVk1YQ19fRW5kX0RhdGVfX2MgPj0gVE9EQVkiOw0KICAgIHZhciBxcjEgPSBzZm9yY2UuY29ubmVjdGlvbi5xdWVyeShzb3FsMSk7DQogICAgdmFyIHdhcnJfcmVjcyA9IG5ldyBzZm9yY2UuUXVlcnlSZXN1bHRJdGVyYXRvcihxcjEpOw0KICAgIHdoaWxlKHdhcnJfcmVjcy5oYXNOZXh0KCkpDQoJew0KCXZhciB3cmVjID0gd2Fycl9yZWNzLm5leHQoKTsNCg0KCVNWTVhDX0VOX0RyYXdSZXN1bHRSb3coJ1dhcnJhbnR5Jywgd3JlYy5JZCwNCgkJCXdyZWMuU1ZNWENfX1NlcnZpY2VfVGVtcGxhdGVfX2MgPyB3cmVjLlNWTVhDX19TZXJ2aWNlX1RlbXBsYXRlX19yLk5hbWUgOiAiVW5rbm93biIsDQoJCQl3cmVjLlNWTVhDX19FeGNsdXNpb25zX19jID8gd3JlYy5TVk1YQ19fRXhjbHVzaW9uc19fYyA6ICIiLA0KCQkJJycsICcnLCAnJywgDQoJCQl3cmVjLlNWTVhDX19TdGFydF9EYXRlX19jLA0KCQkJd3JlYy5TVk1YQ19fRW5kX0RhdGVfX2MsICcnLCAnJywgJycsICcnLCAnJywgd3JlYywgJ0FjdGl2ZScpOw0KCX0NCg0KICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhwZF9lbnQnKS5jaGVja2VkKQkvLyBJbmNsdWRlIGV4cGlyZWQgd2FycmFudGllcyBhbHNvPw0KICAgICAgICB7DQoJdmFyIHNvcWwyID0gYmFzZXNvcWwgKyAiQU5EIFNWTVhDX19FbmRfRGF0ZV9fYyA8IFRPREFZIjsNCgl2YXIgcXIyID0gc2ZvcmNlLmNvbm5lY3Rpb24ucXVlcnkoc29xbDIpOw0KCXdhcnJfcmVjcyA9IG5ldyBzZm9yY2UuUXVlcnlSZXN1bHRJdGVyYXRvcihxcjIpOw0KCXdoaWxlKHdhcnJfcmVjcy5oYXNOZXh0KCkpDQoJICAgIHsNCgkgICAgdmFyIHdyZWMgPSB3YXJyX3JlY3MubmV4dCgpOw0KDQoJICAgIFNWTVhDX0VOX0RyYXdSZXN1bHRSb3coJ1dhcnJhbnR5Jywgd3JlYy5JZCwNCgkJCSAgICB3cmVjLlNWTVhDX19TZXJ2aWNlX1RlbXBsYXRlX19jID8gd3JlYy5TVk1YQ19fU2VydmljZV9UZW1wbGF0ZV9fci5OYW1lIDogIlVua25vd24iLA0KCQkJICAgIHdyZWMuU1ZNWENfX0V4Y2x1c2lvbnNfX2MgPyB3cmVjLlNWTVhDX19FeGNsdXNpb25zX19jIDogIiIsDQoJCQkgICAgJycsICcnLCAnJywgDQoJCQkgICAgd3JlYy5TVk1YQ19fU3RhcnRfRGF0ZV9fYywNCgkJCSAgICB3cmVjLlNWTVhDX19FbmRfRGF0ZV9fYywgJycsICcnLCAnJywgJycsICcnLCB3cmVjLCAnRXhwaXJlZCcpOw0KCSAgICB9DQoJfQ0KDQogICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmdXRfZW50JykuY2hlY2tlZCkJLy8gSW5jbHVkZSBmdXR1cmUgKHlldC10by1iZS1hY3RpdmUpIHdhcnJhbnRpZXMgYWxzbz8NCiAgICAgICAgew0KCXZhciBzb3FsMyA9IGJhc2Vzb3FsICsgIkFORCBTVk1YQ19fU3RhcnRfRGF0ZV9fYyA+IFRPREFZIjsNCgl2YXIgcXIzID0gc2ZvcmNlLmNvbm5lY3Rpb24ucXVlcnkoc29xbDMpOw0KCXdhcnJfcmVjcyA9IG5ldyBzZm9yY2UuUXVlcnlSZXN1bHRJdGVyYXRvcihxcjMpOw0KCXdoaWxlKHdhcnJfcmVjcy5oYXNOZXh0KCkpDQoJICAgIHsNCgkgICAgdmFyIHdyZWMgPSB3YXJyX3JlY3MubmV4dCgpOw0KDQoJICAgIFNWTVhDX0VOX0RyYXdSZXN1bHRSb3coJ1dhcnJhbnR5Jywgd3JlYy5JZCwNCgkJCSAgICB3cmVjLlNWTVhDX19TZXJ2aWNlX1RlbXBsYXRlX19jID8gd3JlYy5TVk1YQ19fU2VydmljZV9UZW1wbGF0ZV9fci5OYW1lIDogIlVua25vd24iLA0KCQkJICAgIHdyZWMuU1ZNWENfX0V4Y2x1c2lvbnNfX2MgPyB3cmVjLlNWTVhDX19FeGNsdXNpb25zX19jIDogIiIsDQoJCQkgICAgJycsICcnLCAnJywgDQoJCQkgICAgd3JlYy5TVk1YQ19fU3RhcnRfRGF0ZV9fYywNCgkJCSAgICB3cmVjLlNWTVhDX19FbmRfRGF0ZV9fYywgJycsICcnLCAnJywgJycsICcnLCB3cmVjLCAnRnV0dXJlJyk7DQoJICAgIH0NCgl9DQogICAgcmV0dXJuIHRydWU7DQp9DQovKj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovDQovLyBMb29rIGZvciBhbnkgYWN0aXZlIHNlcnZpY2UgY29udHJhY3RzIGZvciB0aGUgY29tcGFueSB0aGF0IGNvdmVycyBhbGwgcHJvZHVjdHMNCmZ1bmN0aW9uIFNWTVhDX0VOX0dldEJyb2FkU2VydmljZUNvbnRyYWN0cyhhY2N0X2lkKQ0Kew0KICAgIHZhciBiYXNlc29xbCA9ICJTRUxFQ1QgSWQsIE5hbWUsIFNWTVhDX19TdGFydF9EYXRlX19jLCBTVk1YQ19fRW5kX0RhdGVfX2MsICIgKw0KICAgIAkJIlNWTVhDX19SZW5ld2FsX0RhdGVfX2MsIFNWTVhDX19SZW5ld2FsX051bWJlcl9fYywgIiArDQoJCSJTVk1YQ19fU2VydmljZV9Db250cmFjdF9Ob3Rlc19fYywgU1ZNWENfX1NlcnZpY2VfTGV2ZWxfX2MsICIgKw0KCQkiU1ZNWENfX1NlcnZpY2VfTGV2ZWxfX3IuTmFtZSwgU1ZNWENfX1NlcnZpY2VfTGV2ZWxfX3IuU1ZNWENfX0Rlc2NyaXB0aW9uX19jICIgKw0KCQkiRlJPTSBTVk1YQ19fU2VydmljZV9Db250cmFjdF9fYyAiICsNCgkJIldIRVJFIFNWTVhDX19BY3RpdmVfX2MgPSB0cnVlIEFORCBTVk1YQ19fQ29tcGFueV9fYyA9ICciICsgYWNjdF9pZCArICInIiArDQoJCSJBTkQgU1ZNWENfX0FsbF9Qcm9kdWN0c19Db3ZlcmVkX19jID0gdHJ1ZSAiOw0KDQogICAgdmFyIHNvcWwxID0gYmFzZXNvcWwgKyAiQU5EIFNWTVhDX19TdGFydF9EYXRlX19jIDw9IFRPREFZIEFORCBTVk1YQ19fRW5kX0RhdGVfX2MgPj0gVE9EQVkiOw0KICAgIHZhciBxcjEgPSBzZm9yY2UuY29ubmVjdGlvbi5xdWVyeShzb3FsMSk7DQogICAgdmFyIHNjcmVjcyA9IG5ldyBzZm9yY2UuUXVlcnlSZXN1bHRJdGVyYXRvcihxcjEpOw0KICAgIHdoaWxlKHNjcmVjcy5oYXNOZXh0KCkpDQoJew0KCXZhciBzYyA9IHNjcmVjcy5uZXh0KCk7DQoNCgl2YXIgQ292QnlUaXRsZSA9IFNWTVhDX0dldE1lc3NhZ2UoIkxBQjAyNCIpOw0KCUNvdkJ5VGl0bGUgKz0gIjogIiArIHNjLk5hbWU7DQoNCglpZiAoc2MuU1ZNWENfX1NlcnZpY2VfTGV2ZWxfX2MgJiYgc2MuU1ZNWENfX1NlcnZpY2VfTGV2ZWxfX2MubGVuZ3RoID4gMCkNCgkgICAgew0KCSAgICB2YXIgU2VydmljZUxldmVsID0gc2MuU1ZNWENfX1NlcnZpY2VfTGV2ZWxfX3IuTmFtZTsNCgkgICAgdmFyIFNlcnZpY2VMZXZlbERlc2MgPSBzYy5TVk1YQ19fU2VydmljZV9MZXZlbF9fci5TVk1YQ19fRGVzY3JpcHRpb25fX2M7DQoJICAgIH0NCgllbHNlDQoJICAgIHsNCgkgICAgdmFyIFNlcnZpY2VMZXZlbCA9ICcnOw0KCSAgICB2YXIgU2VydmljZUxldmVsRGVzYyA9ICcnOw0KCSAgICB9DQoNCgl2YXIgU3ZjTGlzdCA9IFNWTVhDX0VOX0dldFNDU2VydmljZXNMaXN0KHNjLklkKTsNCg0KCXZhciBDb250TGlzdCA9IFNWTVhDX0VOX0dldFNDQ29udGFjdHNMaXN0KHNjLklkKTsNCg0KCXZhciBTaXRlTGlzdCA9IFNWTVhDX0VOX0dldFNDU2l0ZXNMaXN0KHNjLklkKTsNCg0KCVNWTVhDX0VOX0RyYXdSZXN1bHRSb3coJ1NlcnZpY2UgQ29udHJhY3QnLCBzYy5JZCwgc2MuTmFtZSwNCgkJCUNvdkJ5VGl0bGUsDQoJCQlTZXJ2aWNlTGV2ZWwsDQoJCQlzYy5TVk1YQ19fUmVuZXdhbF9OdW1iZXJfX2MsIA0KCQkJc2MuU1ZNWENfX1JlbmV3YWxfRGF0ZV9fYywgDQoJCQlzYy5TVk1YQ19fU3RhcnRfRGF0ZV9fYywNCgkJCXNjLlNWTVhDX19FbmRfRGF0ZV9fYywNCgkJCVNlcnZpY2VMZXZlbERlc2MsDQoJCQlzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9Ob3Rlc19fYywNCgkJCVN2Y0xpc3QsIENvbnRMaXN0LCBTaXRlTGlzdCwgc2MsICdBY3RpdmUnKTsNCgl9DQoNCiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4cGRfZW50JykuY2hlY2tlZCkJLy8gSW5jbHVkZSBleHBpcmVkIHNlcnZpY2UgY29udHJhY3RzIGFsc28/DQogICAgICAgIHsNCgl2YXIgc29xbDIgPSBiYXNlc29xbCArICJBTkQgU1ZNWENfX0VuZF9EYXRlX19jIDwgVE9EQVkiOw0KCXZhciBxcjIgPSBzZm9yY2UuY29ubmVjdGlvbi5xdWVyeShzb3FsMik7DQoJc2NyZWNzID0gbmV3IHNmb3JjZS5RdWVyeVJlc3VsdEl0ZXJhdG9yKHFyMik7DQoJd2hpbGUoc2NyZWNzLmhhc05leHQoKSkNCgkgICAgew0KCSAgICB2YXIgc2MgPSBzY3JlY3MubmV4dCgpOw0KDQoJICAgIHZhciBDb3ZCeVRpdGxlID0gU1ZNWENfR2V0TWVzc2FnZSgiTEFCMDI0Iik7DQoJICAgIENvdkJ5VGl0bGUgKz0gIjogIiArIHNjLk5hbWU7DQoNCgkgICAgaWYgKHNjLlNWTVhDX19TZXJ2aWNlX0xldmVsX19jICYmIHNjLlNWTVhDX19TZXJ2aWNlX0xldmVsX19jLmxlbmd0aCA+IDApDQoJCXsNCgkJdmFyIFNlcnZpY2VMZXZlbCA9IHNjLlNWTVhDX19TZXJ2aWNlX0xldmVsX19yLk5hbWU7DQoJCXZhciBTZXJ2aWNlTGV2ZWxEZXNjID0gc2MuU1ZNWENfX1NlcnZpY2VfTGV2ZWxfX3IuU1ZNWENfX0Rlc2NyaXB0aW9uX19jOw0KCQl9DQoJICAgIGVsc2UNCgkJew0KCQl2YXIgU2VydmljZUxldmVsID0gJyc7DQoJCXZhciBTZXJ2aWNlTGV2ZWxEZXNjID0gJyc7DQoJCX0NCg0KCSAgICB2YXIgU3ZjTGlzdCA9IFNWTVhDX0VOX0dldFNDU2VydmljZXNMaXN0KHNjLklkKTsNCg0KCSAgICB2YXIgQ29udExpc3QgPSBTVk1YQ19FTl9HZXRTQ0NvbnRhY3RzTGlzdChzYy5JZCk7DQoNCgkgICAgdmFyIFNpdGVMaXN0ID0gU1ZNWENfRU5fR2V0U0NTaXRlc0xpc3Qoc2MuSWQpOw0KDQoJICAgIFNWTVhDX0VOX0RyYXdSZXN1bHRSb3coJ1NlcnZpY2UgQ29udHJhY3QnLCBzYy5JZCwgc2MuTmFtZSwNCgkJCSAgICBDb3ZCeVRpdGxlLA0KCQkJICAgIFNlcnZpY2VMZXZlbCwNCgkJCSAgICBzYy5TVk1YQ19fUmVuZXdhbF9OdW1iZXJfX2MsIA0KCQkJICAgIHNjLlNWTVhDX19SZW5ld2FsX0RhdGVfX2MsIA0KCQkJICAgIHNjLlNWTVhDX19TdGFydF9EYXRlX19jLA0KCQkJICAgIHNjLlNWTVhDX19FbmRfRGF0ZV9fYywNCgkJCSAgICBTZXJ2aWNlTGV2ZWxEZXNjLA0KCQkJICAgIHNjLlNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X05vdGVzX19jLA0KCQkJICAgIFN2Y0xpc3QsIENvbnRMaXN0LCBTaXRlTGlzdCwgc2MsICdFeHBpcmVkJyk7DQoJICAgIH0NCgl9DQoNCiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Z1dF9lbnQnKS5jaGVja2VkKQkvLyBJbmNsdWRlIGZ1dHVyZSAoeWV0LXRvLWJlLWFjdGl2ZSkgc2VydmljZSBjb250cmFjdHMgYWxzbz8NCiAgICAgICAgew0KCXZhciBzb3FsMyA9IGJhc2Vzb3FsICsgIkFORCBTVk1YQ19fU3RhcnRfRGF0ZV9fYyA+IFRPREFZIjsNCgl2YXIgcXIzID0gc2ZvcmNlLmNvbm5lY3Rpb24ucXVlcnkoc29xbDMpOw0KCXNjcmVjcyA9IG5ldyBzZm9yY2UuUXVlcnlSZXN1bHRJdGVyYXRvcihxcjMpOw0KCXdoaWxlKHNjcmVjcy5oYXNOZXh0KCkpDQoJICAgIHsNCgkgICAgdmFyIHNjID0gc2NyZWNzLm5leHQoKTsNCg0KCSAgICB2YXIgQ292QnlUaXRsZSA9IFNWTVhDX0dldE1lc3NhZ2UoIkxBQjAyNCIpOw0KCSAgICBDb3ZCeVRpdGxlICs9ICI6ICIgKyBzYy5OYW1lOw0KDQoJICAgIGlmIChzYy5TVk1YQ19fU2VydmljZV9MZXZlbF9fYyAmJiBzYy5TVk1YQ19fU2VydmljZV9MZXZlbF9fYy5sZW5ndGggPiAwKQ0KCQl7DQoJCXZhciBTZXJ2aWNlTGV2ZWwgPSBzYy5TVk1YQ19fU2VydmljZV9MZXZlbF9fci5OYW1lOw0KCQl2YXIgU2VydmljZUxldmVsRGVzYyA9IHNjLlNWTVhDX19TZXJ2aWNlX0xldmVsX19yLlNWTVhDX19EZXNjcmlwdGlvbl9fYzsNCgkJfQ0KCSAgICBlbHNlDQoJCXsNCgkJdmFyIFNlcnZpY2VMZXZlbCA9ICcnOw0KCQl2YXIgU2VydmljZUxldmVsRGVzYyA9ICcnOw0KCQl9DQoNCgkgICAgdmFyIFN2Y0xpc3QgPSBTVk1YQ19FTl9HZXRTQ1NlcnZpY2VzTGlzdChzYy5JZCk7DQoNCgkgICAgdmFyIENvbnRMaXN0ID0gU1ZNWENfRU5fR2V0U0NDb250YWN0c0xpc3Qoc2MuSWQpOw0KDQoJICAgIHZhciBTaXRlTGlzdCA9IFNWTVhDX0VOX0dldFNDU2l0ZXNMaXN0KHNjLklkKTsNCg0KCSAgICBTVk1YQ19FTl9EcmF3UmVzdWx0Um93KCdTZXJ2aWNlIENvbnRyYWN0Jywgc2MuSWQsIHNjLk5hbWUsDQoJCQkgICAgQ292QnlUaXRsZSwNCgkJCSAgICBTZXJ2aWNlTGV2ZWwsDQoJCQkgICAgc2MuU1ZNWENfX1JlbmV3YWxfTnVtYmVyX19jLCANCgkJCSAgICBzYy5TVk1YQ19fUmVuZXdhbF9EYXRlX19jLCANCgkJCSAgICBzYy5TVk1YQ19fU3RhcnRfRGF0ZV9fYywNCgkJCSAgICBzYy5TVk1YQ19fRW5kX0RhdGVfX2MsDQoJCQkgICAgU2VydmljZUxldmVsRGVzYywNCgkJCSAgICBzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9Ob3Rlc19fYywNCgkJCSAgICBTdmNMaXN0LCBDb250TGlzdCwgU2l0ZUxpc3QsIHNjLCAnRnV0dXJlJyk7DQoJICAgIH0NCgl9DQoNCiAgICByZXR1cm4gdHJ1ZTsNCn0NCi8qPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8NCi8vIEdldCBhY3RpdmUgc2VydmljZSBjb250cmFjdCBjb3ZlcmFnZSwgaWYgYXZhaWxhYmxlLCBmb3IgdGhlIGdpdmVuIG9iamVjdCAoSUIsIHByb2R1Y3QsIGZhbWlseSBvciBsaW5lKQ0KZnVuY3Rpb24gU1ZNWENfRU5fR2V0U2VydmljZUNvbnRyYWN0KGFjY3RfaWQsIG9ial9pZCwgb2JqX25hbWUsIG9ial90eXBlKQ0Kew0KICAgIHZhciBiYXNlc29xbCA9ICJTRUxFQ1QgU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX2MsIFNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X19yLk5hbWUsICIgKw0KICAgIAkJIlNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X19yLlNWTVhDX19TdGFydF9EYXRlX19jLCBTVk1YQ19fU2VydmljZV9Db250cmFjdF9fci5TVk1YQ19fRW5kX0RhdGVfX2MsICIgKw0KICAgIAkJIlNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X19yLlNWTVhDX19SZW5ld2FsX0RhdGVfX2MsIFNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X19yLlNWTVhDX19SZW5ld2FsX051bWJlcl9fYywgIiArDQoJCSJTVk1YQ19fU2VydmljZV9Db250cmFjdF9fci5TVk1YQ19fU2VydmljZV9Db250cmFjdF9Ob3Rlc19fYywgU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX3IuU1ZNWENfX1NlcnZpY2VfTGV2ZWxfX2MgIiArDQoJCSJGUk9NIFNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X1Byb2R1Y3RzX19jICIgKw0KCQkiV0hFUkUgU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX3IuU1ZNWENfX0FjdGl2ZV9fYyA9IHRydWUgIjsNCg0KICAgIGlmIChvYmpfdHlwZSAhPSAiSUIiIHx8IE1hdGNoQWNjb3VudCA9PSB0cnVlKQ0KCWJhc2Vzb3FsICs9ICJBTkQgU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX3IuU1ZNWENfX0NvbXBhbnlfX2MgPSAnIiArIGFjY3RfaWQgKyAiJyAiOw0KDQogICAgc3dpdGNoKG9ial90eXBlKQ0KICAgICAgICB7DQoJY2FzZSAiSUIiOg0KCSAgICBiYXNlc29xbCArPSAiQU5EIFNWTVhDX19JbnN0YWxsZWRfUHJvZHVjdF9fYyA9ICciICsgb2JqX2lkICsgIiciOw0KCSAgICBicmVhazsNCgljYXNlICJQUk9EIjoNCgkgICAgYmFzZXNvcWwgKz0gIkFORCBTVk1YQ19fUHJvZHVjdF9fYyA9ICciICsgb2JqX2lkICsgIiciOw0KCSAgICBicmVhazsNCgljYXNlICJGQU1JTFkiOg0KCSAgICBiYXNlc29xbCArPSAiQU5EIFNWTVhDX19Qcm9kdWN0X0ZhbWlseV9fYyA9ICciICsgb2JqX2lkICsgIiciOw0KCSAgICBicmVhazsNCgljYXNlICJMSU5FIjoNCgkgICAgYmFzZXNvcWwgKz0gIkFORCBTVk1YQ19fUHJvZHVjdF9MaW5lX19jID0gJyIgKyBvYmpfaWQgKyAiJyI7DQoJICAgIGJyZWFrOw0KCX0NCg0KICAgIHZhciBDb3ZCeVRpdGxlID0gU1ZNWENfR2V0TWVzc2FnZSgiTEFCMDI0Iik7DQogICAgQ292QnlUaXRsZSArPSAiOiAiICsgb2JqX25hbWU7DQoNCiAgICB2YXIgc29xbDEgPSBiYXNlc29xbCArICIgQU5EIFNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X19yLlNWTVhDX19TdGFydF9EYXRlX19jIDw9IFRPREFZICIgKw0KCQkJICAgICJBTkQgU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX3IuU1ZNWENfX0VuZF9EYXRlX19jID49IFRPREFZICI7DQogICAgdmFyIHFyMSA9IHNmb3JjZS5jb25uZWN0aW9uLnF1ZXJ5KHNvcWwxKTsNCiAgICB2YXIgc2NyZWNzID0gbmV3IHNmb3JjZS5RdWVyeVJlc3VsdEl0ZXJhdG9yKHFyMSk7DQogICAgd2hpbGUoc2NyZWNzLmhhc05leHQoKSkNCgl7DQoJdmFyIHNjID0gc2NyZWNzLm5leHQoKTsNCg0KCWlmIChzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fci5TVk1YQ19fU2VydmljZV9MZXZlbF9fYyAmJiBzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fci5TVk1YQ19fU2VydmljZV9MZXZlbF9fYy5sZW5ndGggPiAwKQ0KCSAgICB7DQoJICAgIHZhciBxciA9IHNmb3JjZS5jb25uZWN0aW9uLnF1ZXJ5KCJTRUxFQ1QgTmFtZSwgU1ZNWENfX0Rlc2NyaXB0aW9uX19jIEZST00gU1ZNWENfX1NlcnZpY2VfTGV2ZWxfX2MgV0hFUkUgSWQgPSAnIiArDQoJCQkJCQlzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fci5TVk1YQ19fU2VydmljZV9MZXZlbF9fYyArICInIik7DQoJICAgIHZhciByZWMgPSBxci5nZXRBcnJheSgicmVjb3JkcyIpWzBdOw0KCSAgICB2YXIgU2VydmljZUxldmVsID0gcmVjLk5hbWU7DQoJICAgIHZhciBTZXJ2aWNlTGV2ZWxEZXNjID0gcmVjLlNWTVhDX19EZXNjcmlwdGlvbl9fYzsNCgkgICAgfQ0KCWVsc2UNCgkgICAgew0KCSAgICB2YXIgU2VydmljZUxldmVsID0gJyc7DQoJICAgIHZhciBTZXJ2aWNlTGV2ZWxEZXNjID0gJyc7DQoJICAgIH0NCg0KCXZhciBTdmNMaXN0ID0gU1ZNWENfRU5fR2V0U0NTZXJ2aWNlc0xpc3Qoc2MuU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX2MpOw0KDQoJdmFyIENvbnRMaXN0ID0gU1ZNWENfRU5fR2V0U0NDb250YWN0c0xpc3Qoc2MuU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX2MpOw0KDQoJdmFyIFNpdGVMaXN0ID0gU1ZNWENfRU5fR2V0U0NTaXRlc0xpc3Qoc2MuU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX2MpOw0KDQoJU1ZNWENfRU5fRHJhd1Jlc3VsdFJvdygnU2VydmljZSBDb250cmFjdCcsIHNjLlNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X19jLA0KCQkJc2MuU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX2MgPyBzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fci5OYW1lIDogIlVua25vd24iLA0KCQkJQ292QnlUaXRsZSwNCgkJCVNlcnZpY2VMZXZlbCwNCgkJCXNjLlNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X19yLlNWTVhDX19SZW5ld2FsX051bWJlcl9fYywgDQoJCQlzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fci5TVk1YQ19fUmVuZXdhbF9EYXRlX19jLCANCgkJCXNjLlNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X19yLlNWTVhDX19TdGFydF9EYXRlX19jLA0KCQkJc2MuU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX3IuU1ZNWENfX0VuZF9EYXRlX19jLA0KCQkJU2VydmljZUxldmVsRGVzYywNCgkJCXNjLlNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X19yLlNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X05vdGVzX19jLA0KCQkJU3ZjTGlzdCwgQ29udExpc3QsIFNpdGVMaXN0LCBzYywgJ0FjdGl2ZScpOw0KCX0NCg0KICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhwZF9lbnQnKS5jaGVja2VkKQkvLyBJbmNsdWRlIGV4cGlyZWQgc2VydmljZSBjb250cmFjdHMgYWxzbz8NCiAgICAgICAgew0KCXZhciBzb3FsMiA9IGJhc2Vzb3FsICsgIiBBTkQgU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX3IuU1ZNWENfX0VuZF9EYXRlX19jIDwgVE9EQVkgIjsNCgl2YXIgcXIyID0gc2ZvcmNlLmNvbm5lY3Rpb24ucXVlcnkoc29xbDIpOw0KCXNjcmVjcyA9IG5ldyBzZm9yY2UuUXVlcnlSZXN1bHRJdGVyYXRvcihxcjIpOw0KCXdoaWxlKHNjcmVjcy5oYXNOZXh0KCkpDQoJICAgIHsNCgkgICAgdmFyIHNjID0gc2NyZWNzLm5leHQoKTsNCg0KCSAgICBpZiAoc2MuU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX3IuU1ZNWENfX1NlcnZpY2VfTGV2ZWxfX2MgJiYgc2MuU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX3IuU1ZNWENfX1NlcnZpY2VfTGV2ZWxfX2MubGVuZ3RoID4gMCkNCgkJew0KCQl2YXIgcXIgPSBzZm9yY2UuY29ubmVjdGlvbi5xdWVyeSgiU0VMRUNUIE5hbWUsIFNWTVhDX19EZXNjcmlwdGlvbl9fYyBGUk9NIFNWTVhDX19TZXJ2aWNlX0xldmVsX19jIFdIRVJFIElkID0gJyIgKw0KCQkJCQkJICAgIHNjLlNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X19yLlNWTVhDX19TZXJ2aWNlX0xldmVsX19jICsgIiciKTsNCgkJdmFyIHJlYyA9IHFyLmdldEFycmF5KCJyZWNvcmRzIilbMF07DQoJCXZhciBTZXJ2aWNlTGV2ZWwgPSByZWMuTmFtZTsNCgkJdmFyIFNlcnZpY2VMZXZlbERlc2MgPSByZWMuU1ZNWENfX0Rlc2NyaXB0aW9uX19jOw0KCQl9DQoJICAgIGVsc2UNCgkJew0KCQl2YXIgU2VydmljZUxldmVsID0gJyc7DQoJCXZhciBTZXJ2aWNlTGV2ZWxEZXNjID0gJyc7DQoJCX0NCg0KCSAgICB2YXIgU3ZjTGlzdCA9IFNWTVhDX0VOX0dldFNDU2VydmljZXNMaXN0KHNjLlNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X19jKTsNCg0KCSAgICB2YXIgQ29udExpc3QgPSBTVk1YQ19FTl9HZXRTQ0NvbnRhY3RzTGlzdChzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fYyk7DQoNCgkgICAgdmFyIFNpdGVMaXN0ID0gU1ZNWENfRU5fR2V0U0NTaXRlc0xpc3Qoc2MuU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX2MpOw0KDQoJICAgIFNWTVhDX0VOX0RyYXdSZXN1bHRSb3coJ1NlcnZpY2UgQ29udHJhY3QnLCBzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fYywNCgkJCSAgICBzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fYyA/IHNjLlNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X19yLk5hbWUgOiAiVW5rbm93biIsDQoJCQkgICAgQ292QnlUaXRsZSwNCgkJCSAgICBTZXJ2aWNlTGV2ZWwsDQoJCQkgICAgc2MuU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX3IuU1ZNWENfX1JlbmV3YWxfTnVtYmVyX19jLCANCgkJCSAgICBzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fci5TVk1YQ19fUmVuZXdhbF9EYXRlX19jLCANCgkJCSAgICBzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fci5TVk1YQ19fU3RhcnRfRGF0ZV9fYywNCgkJCSAgICBzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fci5TVk1YQ19fRW5kX0RhdGVfX2MsDQoJCQkgICAgU2VydmljZUxldmVsRGVzYywNCgkJCSAgICBzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fci5TVk1YQ19fU2VydmljZV9Db250cmFjdF9Ob3Rlc19fYywNCgkJCSAgICBTdmNMaXN0LCBDb250TGlzdCwgU2l0ZUxpc3QsIHNjLCAnRXhwaXJlZCcpOw0KCSAgICB9DQoJfQ0KDQogICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmdXRfZW50JykuY2hlY2tlZCkJLy8gSW5jbHVkZSBmdXR1cmUgKHlldC10by1iZS1hY3RpdmUpIHNlcnZpY2UgY29udHJhY3RzIGFsc28/DQogICAgICAgIHsNCgl2YXIgc29xbDMgPSBiYXNlc29xbCArICIgQU5EIFNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X19yLlNWTVhDX19TdGFydF9EYXRlX19jID4gVE9EQVkgIjsNCgl2YXIgcXIzID0gc2ZvcmNlLmNvbm5lY3Rpb24ucXVlcnkoc29xbDMpOw0KCXNjcmVjcyA9IG5ldyBzZm9yY2UuUXVlcnlSZXN1bHRJdGVyYXRvcihxcjMpOw0KCXdoaWxlKHNjcmVjcy5oYXNOZXh0KCkpDQoJICAgIHsNCgkgICAgdmFyIHNjID0gc2NyZWNzLm5leHQoKTsNCg0KCSAgICBpZiAoc2MuU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX3IuU1ZNWENfX1NlcnZpY2VfTGV2ZWxfX2MgJiYgc2MuU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX3IuU1ZNWENfX1NlcnZpY2VfTGV2ZWxfX2MubGVuZ3RoID4gMCkNCgkJew0KCQl2YXIgcXIgPSBzZm9yY2UuY29ubmVjdGlvbi5xdWVyeSgiU0VMRUNUIE5hbWUsIFNWTVhDX19EZXNjcmlwdGlvbl9fYyBGUk9NIFNWTVhDX19TZXJ2aWNlX0xldmVsX19jIFdIRVJFIElkID0gJyIgKw0KCQkJCQkJICAgIHNjLlNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X19yLlNWTVhDX19TZXJ2aWNlX0xldmVsX19jICsgIiciKTsNCgkJdmFyIHJlYyA9IHFyLmdldEFycmF5KCJyZWNvcmRzIilbMF07DQoJCXZhciBTZXJ2aWNlTGV2ZWwgPSByZWMuTmFtZTsNCgkJdmFyIFNlcnZpY2VMZXZlbERlc2MgPSByZWMuU1ZNWENfX0Rlc2NyaXB0aW9uX19jOw0KCQl9DQoJICAgIGVsc2UNCgkJew0KCQl2YXIgU2VydmljZUxldmVsID0gJyc7DQoJCXZhciBTZXJ2aWNlTGV2ZWxEZXNjID0gJyc7DQoJCX0NCg0KCSAgICB2YXIgU3ZjTGlzdCA9IFNWTVhDX0VOX0dldFNDU2VydmljZXNMaXN0KHNjLlNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X19jKTsNCg0KCSAgICB2YXIgQ29udExpc3QgPSBTVk1YQ19FTl9HZXRTQ0NvbnRhY3RzTGlzdChzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fYyk7DQoNCgkgICAgdmFyIFNpdGVMaXN0ID0gU1ZNWENfRU5fR2V0U0NTaXRlc0xpc3Qoc2MuU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX2MpOw0KDQoJICAgIFNWTVhDX0VOX0RyYXdSZXN1bHRSb3coJ1NlcnZpY2UgQ29udHJhY3QnLCBzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fYywNCgkJCSAgICBzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fYyA/IHNjLlNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X19yLk5hbWUgOiAiVW5rbm93biIsDQoJCQkgICAgQ292QnlUaXRsZSwNCgkJCSAgICBTZXJ2aWNlTGV2ZWwsDQoJCQkgICAgc2MuU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX3IuU1ZNWENfX1JlbmV3YWxfTnVtYmVyX19jLCANCgkJCSAgICBzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fci5TVk1YQ19fUmVuZXdhbF9EYXRlX19jLCANCgkJCSAgICBzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fci5TVk1YQ19fU3RhcnRfRGF0ZV9fYywNCgkJCSAgICBzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fci5TVk1YQ19fRW5kX0RhdGVfX2MsDQoJCQkgICAgU2VydmljZUxldmVsRGVzYywNCgkJCSAgICBzYy5TVk1YQ19fU2VydmljZV9Db250cmFjdF9fci5TVk1YQ19fU2VydmljZV9Db250cmFjdF9Ob3Rlc19fYywNCgkJCSAgICBTdmNMaXN0LCBDb250TGlzdCwgU2l0ZUxpc3QsIHNjLCAnRnV0dXJlJyk7DQoJICAgIH0NCgl9DQogICAgcmV0dXJuIHRydWU7DQp9DQovKj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovDQovLyBHZXQgbmV3bGluZS1zZXBhcmF0ZWQgbGlzdCBvZiBzZXJ2aWNlcyBjb3ZlcmVkIGJ5IHNlcnZpY2UgY29udHJhY3QNCmZ1bmN0aW9uIFNWTVhDX0VOX0dldFNDU2VydmljZXNMaXN0KHNjaWQpDQp7DQogICAgdmFyIFN2Y0xpc3QgPSAiIjsNCg0KICAgIHZhciBzb3FsID0gIlNFTEVDVCBTVk1YQ19fU2VydmljZV9fci5OYW1lIEZST00gU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfU2VydmljZXNfX2MgIiArDQoJCSJXSEVSRSBTVk1YQ19fU2VydmljZV9Db250cmFjdF9fYyA9ICciICsgc2NpZCArICInIjsNCiAgICB2YXIgcXIgPSBzZm9yY2UuY29ubmVjdGlvbi5xdWVyeShzb3FsKTsNCg0KICAgIHZhciBzdmNyZWNzID0gbmV3IHNmb3JjZS5RdWVyeVJlc3VsdEl0ZXJhdG9yKHFyKTsNCiAgICB3aGlsZShzdmNyZWNzLmhhc05leHQoKSkNCgl7DQoJdmFyIHN2Y3JlYyA9IHN2Y3JlY3MubmV4dCgpOw0KDQoJaWYgKHN2Y3JlYy5TVk1YQ19fU2VydmljZV9fciAmJiBzdmNyZWMuU1ZNWENfX1NlcnZpY2VfX3IuTmFtZSkNCgkgICAgew0KCSAgICBpZiAoU3ZjTGlzdC5sZW5ndGggPiAwKSB7IFN2Y0xpc3QgKz0gIjxicj4iOyB9DQoJICAgIFN2Y0xpc3QgKz0gc3ZjcmVjLlNWTVhDX19TZXJ2aWNlX19yLk5hbWU7DQoJICAgIH0NCgl9DQoNCiAgICByZXR1cm4gU3ZjTGlzdDsNCn0NCi8qPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8NCi8vIEdldCBuZXdsaW5lLXNlcGFyYXRlZCBsaXN0IG9mIGNvbnRhY3RzIGNvdmVyZWQgYnkgc2VydmljZSBjb250cmFjdA0KZnVuY3Rpb24gU1ZNWENfRU5fR2V0U0NDb250YWN0c0xpc3Qoc2NpZCkNCnsNCiAgICB2YXIgQ29udExpc3QgPSAiIjsNCg0KICAgIHZhciBzb3FsID0gIlNFTEVDVCBTVk1YQ19fQ29udGFjdF9fci5BY2NvdW50Lk5hbWUsIFNWTVhDX19Db250YWN0X19yLk5hbWUgRlJPTSBTVk1YQ19fU2VydmljZV9Db250cmFjdF9Db250YWN0c19fYyAiICsNCgkJIldIRVJFIFNWTVhDX19TZXJ2aWNlX0NvbnRyYWN0X19jID0gJyIgKyBzY2lkICsgIiciOw0KICAgIHZhciBxciA9IHNmb3JjZS5jb25uZWN0aW9uLnF1ZXJ5KHNvcWwpOw0KDQogICAgdmFyIGNvbnRyZWNzID0gbmV3IHNmb3JjZS5RdWVyeVJlc3VsdEl0ZXJhdG9yKHFyKTsNCiAgICB3aGlsZShjb250cmVjcy5oYXNOZXh0KCkpDQoJew0KCXZhciBjb250cmVjID0gY29udHJlY3MubmV4dCgpOw0KCQlpZiAoY29udHJlYy5TVk1YQ19fQ29udGFjdF9fciAmJiBjb250cmVjLlNWTVhDX19Db250YWN0X19yLk5hbWUpDQoJICAgIHsNCgkJICAgIGlmIChDb250TGlzdC5sZW5ndGggPiAwKSB7IENvbnRMaXN0ICs9ICI8YnI+IjsgfQ0KCQkJaWYoY29udHJlYy5TVk1YQ19fQ29udGFjdF9fci5BY2NvdW50ICE9IG51bGwpDQoJCQl7DQoJCQkJQ29udExpc3QgKz0gY29udHJlYy5TVk1YQ19fQ29udGFjdF9fci5OYW1lICsgIiAtICIgKyBjb250cmVjLlNWTVhDX19Db250YWN0X19yLkFjY291bnQuTmFtZTsNCgkJCX0NCgkgICAgfQ0KCX0NCg0KICAgIHJldHVybiBDb250TGlzdDsNCn0NCi8qPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8NCi8vIEdldCBuZXdsaW5lLXNlcGFyYXRlZCBsaXN0IG9mIHNpdGVzIGNvdmVyZWQgYnkgc2VydmljZSBjb250cmFjdA0KZnVuY3Rpb24gU1ZNWENfRU5fR2V0U0NTaXRlc0xpc3Qoc2NpZCkNCnsNCiAgICB2YXIgU2l0ZUxpc3QgPSAiIjsNCg0KICAgIHZhciBzb3FsID0gIlNFTEVDVCBTVk1YQ19fU2l0ZV9fci5OYW1lIEZST00gU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfU2l0ZXNfX2MgIiArDQoJICAgICAgICJXSEVSRSBTVk1YQ19fU2VydmljZV9Db250cmFjdF9fYyA9ICciICsgc2NpZCArICInIjsNCiAgICB2YXIgcXIgPSBzZm9yY2UuY29ubmVjdGlvbi5xdWVyeShzb3FsKTsNCg0KICAgIHZhciBzaXRlcmVjcyA9IG5ldyBzZm9yY2UuUXVlcnlSZXN1bHRJdGVyYXRvcihxcik7DQogICAgd2hpbGUoc2l0ZXJlY3MuaGFzTmV4dCgpKQ0KCXsNCgl2YXIgc2l0ZXJlYyA9IHNpdGVyZWNzLm5leHQoKTsNCg0KCWlmIChzaXRlcmVjLlNWTVhDX19TaXRlX19yICYmIHNpdGVyZWMuU1ZNWENfX1NpdGVfX3IuTmFtZSkNCgkgICAgew0KCSAgICBpZiAoU2l0ZUxpc3QubGVuZ3RoID4gMCkgeyBTaXRlTGlzdCArPSAiPGJyPiI7IH0NCgkgICAgU2l0ZUxpc3QgKz0gc2l0ZXJlYy5TVk1YQ19fU2l0ZV9fci5OYW1lOw0KCSAgICB9DQoJfQ0KDQogICAgcmV0dXJuIFNpdGVMaXN0Ow0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KLy8gRHJhdyB0aGUgZW50aXRsZW1lbnQgcm93DQpmdW5jdGlvbiBTVk1YQ19FTl9EcmF3UmVzdWx0Um93KG9ial90eXBlLCBvYmpfaWQsIG9ial9uYW1lLCBvYmpfZGV0YWlscywgc3ZjX2xldmVsLCByZW5ld2FsX251bSwgcmVuZXdhbF9kYXRlLCBzdGFydF9kYXRlLCBlbmRfZGF0ZSwgc2xkLCBzY24sIHN2Y19saXN0LCBjb250X2xpc3QsIHNpdGVfbGlzdCwgb2JqcmVjLCB2YWxpZGl0eSkNCnsNCiAgICBTVk1YQ19FTl9EcmF3SGVhZGVyKCk7DQogICAgdmFyIHRib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpc3RfdGJvZHknKTsNCiAgICB2YXIgdHIgPSBtYWtlUm93KG1ha2VBdHRycyhlbnRyb3dudW0sdGJvZHkpKTsNCiAgICB0Ym9keS5hcHBlbmRDaGlsZCh0cik7DQogICAgdHIuc29iamVjdCA9IG9ianJlYzsNCg0KDQoJICAgIC8vIENvbCAxLiBSYWRpbyBidXR0b24NCiAgICBjcmVhdGVUYWcodHIsInRkIixbXSkuaW5uZXJIVE1MID0NCgkiPGlucHV0IHR5cGU9XCJyYWRpb1wiIG9uQ2xpY2s9XCJTVk1YQ19FTl9TaG93QWRkRGV0YWlscyh0aGlzKTtcIiBuYW1lPVwicmFkaW9cIiB2YWx1ZT1cIiIgKyBvYmpfaWQgKyAiXCI+PC9pbnB1dD4iOw0KDQogICAgaWYgKG9ial90eXBlID09ICdXYXJyYW50eScpIHsgdmFyIG9ial9sYWJlbCA9IFNWTVhDX0dldE1lc3NhZ2UoIkxBQjAxNCIpOyB9DQogICAgZWxzZSB7IHZhciBvYmpfbGFiZWwgPSBTVk1YQ19HZXRNZXNzYWdlKCJMQUIwMTUiKTsgfQ0KCQ0KDQogICAgaWYgKCFvYmpfbmFtZSkgeyBvYmpfbmFtZSA9IG9ial9sYWJlbCArICI6ICIgKyAnVW5rbm93bic7IH0NCiAgICBlbHNlIHsgb2JqX25hbWUgPSBvYmpfbGFiZWwgKyAiOiAiICsgb2JqX25hbWU7IH0NCg0KICAgIHN3aXRjaCh2YWxpZGl0eSkNCiAgICAgICAgew0KCWNhc2UgIkFjdGl2ZSI6DQoJICAgIGNvbHN0ID0gInN0eWxlPVwiY29sb3I6ZGFya2dyZWVuXCIiOw0KCSAgICBicmVhazsNCgljYXNlICJFeHBpcmVkIjoNCgkgICAgY29sc3QgPSAic3R5bGU9XCJjb2xvcjpyZWRcIiI7DQoJICAgIGJyZWFrOw0KCWNhc2UgIkZ1dHVyZSI6DQoJICAgIGNvbHN0ID0gInN0eWxlPVwiY29sb3I6Ymx1ZVwiIjsNCgkgICAgYnJlYWs7DQogICAgICAgIH0NCg0KCSAgICAvLyBDb2wgMi4gVGVtcGxhdGUgTmFtZQ0KICAgIGNyZWF0ZVRhZyh0ciwidGQiLFtdKS5pbm5lckhUTUwgPSAiPGEgIiArIGNvbHN0ICsgIiB0YXJnZXQ9X2JsYW5rIGlkPVwiIiArIG9ial9pZCArICJuYW1lXCIgaHJlZj1cIi8iICsgb2JqX2lkICsgIlwiPiIgKyBvYmpfbmFtZSArICI8L2E+IjsNCg0KICAgIGlmICghb2JqX2RldGFpbHMpIHsgb2JqX2RldGFpbHMgPSAnJzsgfQ0KDQoJICAgIC8vIENvbCAzLiBEZXRhaWxzDQogICAgY3JlYXRlVGFnKHRyLCJ0ZCIsW10pLmlubmVySFRNTCA9ICI8YSB0YXJnZXQ9X2JsYW5rIGlkPVwiIiArIG9ial9pZCArICJkZXRsXCIgaHJlZj1cIi8iICsgb2JqX2lkICsgIlwiPiIgKyBvYmpfZGV0YWlscyArICI8L2E+IjsNCg0KCSAgICAvLyBDb2wgNC4gU2VydmljZSBMZXZlbA0KICAgIGNyZWF0ZVRhZyh0ciwidGQiLFtdKS5pbm5lckhUTUwgPSAiPGEgdGFyZ2V0PV9ibGFuayBpZD1cIiIgKyBvYmpfaWQgKyAic3ZjbFwiIGhyZWY9XCIvIiArIG9ial9pZCArICJcIj4iICsgc3ZjX2xldmVsICsgIjwvYT4iOw0KDQogICAgaWYgKCFyZW5ld2FsX251bSkgeyByZW5ld2FsX251bSA9ICcnOyB9DQoNCgkgICAgLy8gQ29sIDUuIFJlbmV3YWwgTnVtYmVyDQogICAgY3JlYXRlVGFnKHRyLCJ0ZCIsW10pLmlubmVySFRNTCA9ICI8YSB0YXJnZXQ9X2JsYW5rIGlkPVwiIiArIG9ial9pZCArICJyZW5uXCIgaHJlZj1cIi8iICsgb2JqX2lkICsgIlwiPiIgKyByZW5ld2FsX251bSArICI8L2E+IjsNCg0KCSAgICAvLyBDb2wgNi4gUmVuZXdhbCBEYXRlDQogICAgaWYgKHJlbmV3YWxfZGF0ZSAmJiByZW5ld2FsX2RhdGUubGVuZ3RoID4gMCkNCgl7DQoJdmFyIGRjID0gcmVuZXdhbF9kYXRlLnNwbGl0KCctJywgMyk7DQoJdmFyIGQgPSBuZXcgRGF0ZShkY1swXSwgZGNbMV0gLSAxLCBkY1syXSk7DQoJdmFyIGRmbXQgPSBwYXJlbnQuVXNlckNvbnRleHQuZGF0ZUZvcm1hdDsNCgl2YXIgUmVuZXdhbERhdGUgPSBEYXRlVXRpbC5mb3JtYXREYXRlKGQsIGRmbXQpOw0KCX0NCiAgICBlbHNlDQoJdmFyIFJlbmV3YWxEYXRlID0gJyc7DQogICAgY3JlYXRlVGFnKHRyLCJ0ZCIsW10pLmlubmVySFRNTCA9ICI8YSB0YXJnZXQ9X2JsYW5rIGlkPVwiIiArIG9ial9pZCArICJyZW5kXCIgaHJlZj1cIi8iICsgb2JqX2lkICsgIlwiPiIgKyBSZW5ld2FsRGF0ZSArICI8L2E+IjsNCg0KCSAgICAvLyBDb2wgNy4gU3RhcnQgZGF0ZQ0KICAgIGRjID0gc3RhcnRfZGF0ZS5zcGxpdCgnLScsIDMpOw0KICAgIGQgPSBuZXcgRGF0ZShkY1swXSwgZGNbMV0gLSAxLCBkY1syXSk7DQogICAgZGZtdCA9IHBhcmVudC5Vc2VyQ29udGV4dC5kYXRlRm9ybWF0Ow0KICAgIHZhciBTdGFydERhdGUgPSBEYXRlVXRpbC5mb3JtYXREYXRlKGQsIGRmbXQpOw0KICAgIGNyZWF0ZVRhZyh0ciwidGQiLFtdKS5pbm5lckhUTUwgPSAiPGEgdGFyZ2V0PV9ibGFuayBpZD1cIiIgKyBvYmpfaWQgKyAic3RhcnRcIiBocmVmPVwiLyIgKyBvYmpfaWQgKyAiXCI+IiArIFN0YXJ0RGF0ZSArICI8L2E+IjsNCg0KCSAgICAvLyBDb2wgOC4gRW5kIGRhdGUNCiAgICBkYyA9IGVuZF9kYXRlLnNwbGl0KCctJywgMyk7DQogICAgZCA9IG5ldyBEYXRlKGRjWzBdLCBkY1sxXSAtIDEsIGRjWzJdKTsNCiAgICBkZm10ID0gcGFyZW50LlVzZXJDb250ZXh0LmRhdGVGb3JtYXQ7DQogICAgdmFyIEVuZERhdGUgPSBEYXRlVXRpbC5mb3JtYXREYXRlKGQsIGRmbXQpOw0KICAgIGNyZWF0ZVRhZyh0ciwidGQiLFtdKS5pbm5lckhUTUwgPSAiPGEgdGFyZ2V0PV9ibGFuayBpZD1cIiIgKyBvYmpfaWQgKyAiZW5kXCIgaHJlZj1cIi8iICsgb2JqX2lkICsgIlwiPiIgKyBFbmREYXRlICsgIjwvYT4iOw0KDQogICAgaWYgKHNjbikJCS8vIFNlcnZpY2UgY29udHJhY3Qgbm90ZXMNCgljcmVhdGVUYWcodHIsInRkIixbXSkuaW5uZXJIVE1MID0gIjxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgaWQ9XCIiICsgb2JqX2lkICsgInNjblwiIHZhbHVlPVwiIiArIHNjbiArICJcIj48L2lucHV0PiI7DQogICAgZWxzZQ0KCWNyZWF0ZVRhZyh0ciwidGQiLFtdKS5pbm5lckhUTUwgPSAiPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBpZD1cIiIgKyBvYmpfaWQgKyAic2NuXCIgdmFsdWU9XCIiICsgJycgKyAiXCI+PC9pbnB1dD4iOw0KDQogICAgaWYgKHNsZCkJCS8vIFNlcnZpY2UgbGV2ZWwgZGVzY3JpcHRpb24NCgljcmVhdGVUYWcodHIsInRkIixbXSkuaW5uZXJIVE1MID0gIjxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgaWQ9XCIiICsgb2JqX2lkICsgInNsZFwiIHZhbHVlPVwiIiArIHNsZCArICJcIj48L2lucHV0PiI7DQogICAgZWxzZQ0KCWNyZWF0ZVRhZyh0ciwidGQiLFtdKS5pbm5lckhUTUwgPSAiPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBpZD1cIiIgKyBvYmpfaWQgKyAic2xkXCIgdmFsdWU9XCIiICsgJycgKyAiXCI+PC9pbnB1dD4iOw0KDQogICAgCQkJLy8gSGlkZGVuIFN0YXJ0IGRhdGUgaW4gU0ZEQyBmb3JtYXQNCiAgICBjcmVhdGVUYWcodHIsInRkIixbXSkuaW5uZXJIVE1MID0gIjxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgaWQ9XCIiICsgb2JqX2lkICsgInN0YXJ0ZGF0ZVwiIHZhbHVlPVwiIiArIHN0YXJ0X2RhdGUgKyAiXCI+PC9pbnB1dD4iOw0KDQogICAgCQkJLy8gSGlkZGVuIEVuZCBkYXRlIGluIFNGREMgZm9ybWF0DQogICAgY3JlYXRlVGFnKHRyLCJ0ZCIsW10pLmlubmVySFRNTCA9ICI8aW5wdXQgdHlwZT1cImhpZGRlblwiIGlkPVwiIiArIG9ial9pZCArICJlbmRkYXRlXCIgdmFsdWU9XCIiICsgZW5kX2RhdGUgKyAiXCI+PC9pbnB1dD4iOw0KDQogICAgCQkJLy8gSGlkZGVuIG9iamVjdCB0eXBlDQogICAgY3JlYXRlVGFnKHRyLCJ0ZCIsW10pLmlubmVySFRNTCA9ICI8aW5wdXQgdHlwZT1cImhpZGRlblwiIGlkPVwiIiArIG9ial9pZCArICJvYmp0eXBlXCIgdmFsdWU9XCIiICsgb2JqX3R5cGUgKyAiXCI+PC9pbnB1dD4iOw0KIA0KDQogICAgCQkJLy8gSGlkZGVuIFNlcnZpY2VzIGxpc3QNCiAgICBjcmVhdGVUYWcodHIsInRkIixbXSkuaW5uZXJIVE1MID0gIjxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgaWQ9XCIiICsgb2JqX2lkICsgInN2Y19saXN0XCIgdmFsdWU9XCIiICsgc3ZjX2xpc3QgKyAiXCI+PC9pbnB1dD4iOw0KDQogICAgCQkJLy8gSGlkZGVuIENvbnRhY3RzIGxpc3QNCiAgICBjcmVhdGVUYWcodHIsInRkIixbXSkuaW5uZXJIVE1MID0gIjxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgaWQ9XCIiICsgb2JqX2lkICsgImNvbnRfbGlzdFwiIHZhbHVlPVwiIiArIGNvbnRfbGlzdCArICJcIj48L2lucHV0PiI7DQoNCiAgICAJCQkvLyBIaWRkZW4gU2l0ZXMgbGlzdA0KICAgIGNyZWF0ZVRhZyh0ciwidGQiLFtdKS5pbm5lckhUTUwgPSAiPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBpZD1cIiIgKyBvYmpfaWQgKyAic2l0ZV9saXN0XCIgdmFsdWU9XCIiICsgc2l0ZV9saXN0ICsgIlwiPjwvaW5wdXQ+IjsNCg0KICAgIAkJCS8vIEhpZGRlbiBXYXJyYW50eSBmbGFncw0KICAgIGlmIChvYmpfdHlwZSA9PSAnV2FycmFudHknKQ0KICAgIAl7DQoJY3JlYXRlVGFnKHRyLCJ0ZCIsW10pLmlubmVySFRNTCA9DQoJCSAgICAiPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBpZD1cIiIgKyBvYmpfaWQgKyAiaW52X3JlcWRcIiB2YWx1ZT1cIiIgKyBvYmpyZWMuU1ZNWENfX0ludm9pY2VfUmVxdWlyZWRfX2MgKyAiXCI+PC9pbnB1dD4iOw0KCWNyZWF0ZVRhZyh0ciwidGQiLFtdKS5pbm5lckhUTUwgPQ0KCQkgICAgIjxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgaWQ9XCIiICsgb2JqX2lkICsgInNocF9hbHdkXCIgdmFsdWU9XCIiICsgb2JqcmVjLlNWTVhDX19TaGlwbWVudF9BbGxvd2VkX19jICsgIlwiPjwvaW5wdXQ+IjsNCgljcmVhdGVUYWcodHIsInRkIixbXSkuaW5uZXJIVE1MID0NCgkJICAgICI8aW5wdXQgdHlwZT1cImhpZGRlblwiIGlkPVwiIiArIG9ial9pZCArICJsb2FuX3Byb3ZcIiB2YWx1ZT1cIiIgKyBvYmpyZWMuU1ZNWENfX0xvYW5lcl9Qcm92aWRlZF9fYyArICJcIj48L2lucHV0PiI7DQoJY3JlYXRlVGFnKHRyLCJ0ZCIsW10pLmlubmVySFRNTCA9DQoJCSAgICAiPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBpZD1cIiIgKyBvYmpfaWQgKyAicm1hX3JlcWRcIiB2YWx1ZT1cIiIgKyBvYmpyZWMuU1ZNWENfX1JNQV9SZXF1aXJlZF9fYyArICJcIj48L2lucHV0PiI7DQoJY3JlYXRlVGFnKHRyLCJ0ZCIsW10pLmlubmVySFRNTCA9DQoJCSAgICAiPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBpZD1cIiIgKyBvYmpfaWQgKyAib25zX3JlcGFpclwiIHZhbHVlPVwiIiArIG9ianJlYy5TVk1YQ19fT25zaXRlX1JlcGFpcl9fYyArICJcIj48L2lucHV0PiI7DQoJY3JlYXRlVGFnKHRyLCJ0ZCIsW10pLmlubmVySFRNTCA9DQoJCSAgICAiPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBpZD1cIiIgKyBvYmpfaWQgKyAieGZlcmFibGVcIiB2YWx1ZT1cIiIgKyBvYmpyZWMuU1ZNWENfX1RyYW5zZmVyYWJsZV9fYyArICJcIj48L2lucHV0PiI7DQoJY3JlYXRlVGFnKHRyLCJ0ZCIsW10pLmlubmVySFRNTCA9DQoJCSAgICAiPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBpZD1cIiIgKyBvYmpfaWQgKyAid2Fsa2luX2Fsd2RcIiB2YWx1ZT1cIiIgKyBvYmpyZWMuU1ZNWENfX1dhbGtfaW5fQWxsb3dlZF9fYyArICJcIj48L2lucHV0PiI7DQoJaWYgKG9ianJlYy5TVk1YQ19fRXhjbHVzaW9uc19fYykNCgkgICAgY3JlYXRlVGFnKHRyLCJ0ZCIsW10pLmlubmVySFRNTCA9DQoJCQkiPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBpZD1cIiIgKyBvYmpfaWQgKyAid2Fycl9leGNsXCIgdmFsdWU9XCIiICsgb2JqcmVjLlNWTVhDX19FeGNsdXNpb25zX19jICsgIlwiPjwvaW5wdXQ+IjsNCgllbHNlDQoJICAgIGNyZWF0ZVRhZyh0ciwidGQiLFtdKS5pbm5lckhUTUwgPQ0KCQkJIjxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgaWQ9XCIiICsgb2JqX2lkICsgIndhcnJfZXhjbFwiIHZhbHVlPVwiIFwiPjwvaW5wdXQ+IjsNCgl9DQogICAgZW50cm93bnVtKz0xOw0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KZnVuY3Rpb24gU1ZNWENfRU5fU2hvd0FkZERldGFpbHMoY3RsKQ0Kew0KICAgIHZhciBvdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGN0bC52YWx1ZSArICJvYmp0eXBlIikudmFsdWU7DQoNCiAgICBpZiAob3QgPT0gJ1dhcnJhbnR5JykNCiAgICAJew0KCWlmKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGN0bC52YWx1ZSArICJpbnZfcmVxZCIpLnZhbHVlID09ICJ0cnVlIikNCgkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImludl9yZXFkIikuY2hlY2tlZCA9IHRydWU7DQoJZWxzZQ0KCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW52X3JlcWQiKS5jaGVja2VkID0gZmFsc2U7DQoNCglpZihkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjdGwudmFsdWUgKyAic2hwX2Fsd2QiKS52YWx1ZSA9PSAidHJ1ZSIpDQoJICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzaHBfYWx3ZCIpLmNoZWNrZWQgPSB0cnVlOw0KCWVsc2UNCgkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNocF9hbHdkIikuY2hlY2tlZCA9IGZhbHNlOw0KDQoJaWYoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY3RsLnZhbHVlICsgImxvYW5fcHJvdiIpLnZhbHVlID09ICJ0cnVlIikNCgkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxvYW5fcHJvdiIpLmNoZWNrZWQgPSB0cnVlOw0KCWVsc2UNCgkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxvYW5fcHJvdiIpLmNoZWNrZWQgPSBmYWxzZTsNCg0KCWlmKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGN0bC52YWx1ZSArICJybWFfcmVxZCIpLnZhbHVlID09ICJ0cnVlIikNCgkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJtYV9yZXFkIikuY2hlY2tlZCA9IHRydWU7DQoJZWxzZQ0KCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicm1hX3JlcWQiKS5jaGVja2VkID0gZmFsc2U7DQoNCglpZihkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjdGwudmFsdWUgKyAib25zX3JlcGFpciIpLnZhbHVlID09ICJ0cnVlIikNCgkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm9uc19yZXBhaXIiKS5jaGVja2VkID0gdHJ1ZTsNCgllbHNlDQoJICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJvbnNfcmVwYWlyIikuY2hlY2tlZCA9IGZhbHNlOw0KDQoJaWYoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY3RsLnZhbHVlICsgInhmZXJhYmxlIikudmFsdWUgPT0gInRydWUiKQ0KCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgieGZlcmFibGUiKS5jaGVja2VkID0gdHJ1ZTsNCgllbHNlDQoJICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ4ZmVyYWJsZSIpLmNoZWNrZWQgPSBmYWxzZTsNCg0KCWlmKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGN0bC52YWx1ZSArICJ3YWxraW5fYWx3ZCIpLnZhbHVlID09ICJ0cnVlIikNCgkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhbGtpbl9hbHdkIikuY2hlY2tlZCA9IHRydWU7DQoJZWxzZQ0KCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgid2Fsa2luX2Fsd2QiKS5jaGVja2VkID0gZmFsc2U7DQoNCglpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY3RsLnZhbHVlICsgIndhcnJfZXhjbCIpLnZhbHVlKQ0KCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgid2Fycl9leGNsIikuaW5uZXJIVE1MID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY3RsLnZhbHVlICsgIndhcnJfZXhjbCIpLnZhbHVlOyANCg0KCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhZGRsd2FycmluZm8iKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsgDQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFkZGxzY2luZm8iKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyANCgl9DQogICAgZWxzZQ0KICAgICAgICB7DQoJaWYoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY3RsLnZhbHVlICsgInNsZCIpKQ0KCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3ZjX2xldmVsX2Rlc2MiKS5pbm5lckhUTUwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjdGwudmFsdWUgKyAic2xkIikudmFsdWU7IA0KCWlmKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGN0bC52YWx1ZSArICJzY24iKSkNCgkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNjX25vdGVzIikuaW5uZXJIVE1MID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY3RsLnZhbHVlICsgInNjbiIpLnZhbHVlOyANCglpZihkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjdGwudmFsdWUgKyAic3ZjX2xpc3QiKSkNCgkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNjX3N2Y19saXN0IikuaW5uZXJIVE1MID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY3RsLnZhbHVlICsgInN2Y19saXN0IikudmFsdWU7IA0KCWlmKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGN0bC52YWx1ZSArICJjb250X2xpc3QiKSkNCgkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNjX2NvbnRfbGlzdCIpLmlubmVySFRNTCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGN0bC52YWx1ZSArICJjb250X2xpc3QiKS52YWx1ZTsgDQoJaWYoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY3RsLnZhbHVlICsgInNpdGVfbGlzdCIpKQ0KCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2Nfc2l0ZV9saXN0IikuaW5uZXJIVE1MID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY3RsLnZhbHVlICsgInNpdGVfbGlzdCIpLnZhbHVlOyANCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWRkbHNjaW5mbyIpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOyANCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWRkbHdhcnJpbmZvIikuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgDQoJfQ0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KZnVuY3Rpb24gU1ZNWENfRU5fU2F2ZUVudGl0bGVtZW50KCkNCnsNCiAgICBpZiAoZW50cm93bnVtIDw9IDApDQogICAgCXsNCglhbGVydChTVk1YQ19HZXRNZXNzYWdlKCJNU0cwMDciKSk7DQoJcmV0dXJuOw0KCX0NCg0KICAgIHZhciBzZWxlY3RlZCA9IGZhbHNlOw0KICAgIHZhciByYWRpb3MgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5TmFtZSgncmFkaW8nKTsNCiAgICBmb3IgKHZhciBqID0gMDsgaiA8IHJhZGlvcy5sZW5ndGg7IGorKykNCgl7DQoJdmFyIGN0bCA9IHJhZGlvc1tqXTsNCglpZiAoY3RsLmNoZWNrZWQpDQoJICAgIHsNCgkgICAgc2VsZWN0ZWQgPSB0cnVlOw0KCSAgICB2YXIgU2VsZWN0ZWRJZCA9IGN0bC52YWx1ZTsNCgkgICAgYnJlYWs7DQoJICAgIH0NCgl9DQogICAgaWYgKCFzZWxlY3RlZCkNCiAgICAJew0KCWFsZXJ0KFNWTVhDX0dldE1lc3NhZ2UoIk1TRzAwOCIpKTsNCglyZXR1cm4gZmFsc2U7DQoJfQ0KDQogICAgaWYgKCFTVk1YQ19FTl9TYXZlUHJvZHVjdChmYWxzZSkpIHsgcmV0dXJuIGZhbHNlOyB9DQoNCiAgICB2YXIgY3VycmRhdGUgPSBuZXcgRGF0ZSgpOw0KDQogICAgLy8gRGVhY3RpdmF0ZSBhbnkgZXhpc3RpbmcgZW50aXRsZW1lbnRzIGZvciB0aGUgY2FzZS9TVk8NCiAgICBpZiAoT2JqVHlwZSA9PSAnQ0FTRScpDQoJdmFyIHNvcWwxID0gIlNFTEVDVCBJZCBGUk9NIFNWTVhDX19FbnRpdGxlbWVudF9IaXN0b3J5X19jIFdIRVJFIFNWTVhDX19JbmFjdGl2ZV9EYXRlX19jID0gbnVsbCBBTkQgU1ZNWENfX0Nhc2VfX2MgPSAnIiArIEVudENhc2VJZCArICInIjsNCiAgICBlbHNlDQoJdmFyIHNvcWwxID0gIlNFTEVDVCBJZCBGUk9NIFNWTVhDX19FbnRpdGxlbWVudF9IaXN0b3J5X19jIFdIRVJFIFNWTVhDX19JbmFjdGl2ZV9EYXRlX19jID0gbnVsbCBBTkQgU1ZNWFBfX1NlcnZpY2VfT3JkZXJfX2MgPSAnIiArIEVudFNWT0lkICsgIiciOw0KICAgIHZhciBxcjEgPSBzZm9yY2UuY29ubmVjdGlvbi5xdWVyeShzb3FsMSk7DQogICAgaWYgKHFyMS5zaXplID4gMCkNCiAgICAJew0KCXZhciBlbnRoaXN0cmVjcyA9IG5ldyBzZm9yY2UuUXVlcnlSZXN1bHRJdGVyYXRvcihxcjEpOw0KCXdoaWxlKGVudGhpc3RyZWNzLmhhc05leHQoKSkNCgkgICAgew0KCSAgICB2YXIgZW50aGlzdHJlYyA9IGVudGhpc3RyZWNzLm5leHQoKTsNCgkgICAgdmFyIGVudHVwZCA9IG5ldyBzZm9yY2UuU09iamVjdCgiU1ZNWENfX0VudGl0bGVtZW50X0hpc3RvcnlfX2MiKTsNCgkgICAgZW50dXBkLklkID0gZW50aGlzdHJlYy5JZDsNCgkgICAgZW50dXBkLlNWTVhDX19JbmFjdGl2ZV9EYXRlX19jID0gU1ZNWENfQ29udmVydERhdGVUb1NGREMoY3VycmRhdGUpOw0KCSAgICB0cnkgew0KCQl2YXIgcmV0ID0gc2ZvcmNlLmNvbm5lY3Rpb24udXBkYXRlKFtlbnR1cGRdKTsNCgkJfQ0KCSAgICBjYXRjaCAoZSkNCgkJew0KCQlhbGVydChTVk1YQ19HZXRNZXNzYWdlKCJNU0cwMDEiKSArICJcbiIgKyBlKTsNCgkJcmV0dXJuIGZhbHNlOw0KCQl9DQoJICAgIH0NCgl9DQoNCiAgICB2YXIgZW50ID0gbmV3IHNmb3JjZS5TT2JqZWN0KCJTVk1YQ19fRW50aXRsZW1lbnRfSGlzdG9yeV9fYyIpOw0KICAgIGVudC5TVk1YQ19fRGF0ZV9vZl9lbnRpdGxlbWVudF9fYyA9IFNWTVhDX0NvbnZlcnREYXRlVG9TRkRDKGN1cnJkYXRlKTsNCiAgICBlbnQuU1ZNWENfX1N0YXJ0X0RhdGVfX2MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChTZWxlY3RlZElkICsgInN0YXJ0ZGF0ZSIpLnZhbHVlOw0KICAgIGVudC5TVk1YQ19fRW5kX0RhdGVfX2MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChTZWxlY3RlZElkICsgImVuZGRhdGUiKS52YWx1ZTsNCiAgICBlbnQuU1ZNWENfX0VudGl0bGVtZW50X25vdGVzX19jID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudF9ub3RlcyIpLnZhbHVlOw0KICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChTZWxlY3RlZElkICsgIm9ianR5cGUiKS52YWx1ZSA9PSAnV2FycmFudHknKQ0KCWVudC5TVk1YQ19fV2FycmFudHlfX2MgPSBTZWxlY3RlZElkOw0KICAgIGVsc2UNCgllbnQuU1ZNWENfX1NlcnZpY2VfQ29udHJhY3RfX2MgPSBTZWxlY3RlZElkOw0KICAgIGlmIChPYmpUeXBlID09ICdDQVNFJykNCgllbnQuU1ZNWENfX0Nhc2VfX2MgPSBFbnRDYXNlSWQ7DQogICAgZWxzZQ0KCWVudC5TVk1YUF9fU2VydmljZV9PcmRlcl9fYyA9IEVudFNWT0lkOw0KICAgIHRyeSB7DQoJdmFyIHJldCA9IHNmb3JjZS5jb25uZWN0aW9uLmNyZWF0ZShbZW50XSk7DQoJcGFyZW50LndpbmRvdy5sb2NhdGlvbiA9ICIvIiArIEN1cnJPYmpJZDsNCgl9DQogICAgY2F0Y2ggKGUpDQoJew0KCWFsZXJ0KFNWTVhDX0dldE1lc3NhZ2UoIk1TRzAwMSIpICsgIlxuIiArIGUpOw0KCXJldHVybiBmYWxzZTsNCgl9DQogICAgcmV0dXJuIHRydWU7DQp9DQovKj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovDQpmdW5jdGlvbiBTVk1YQ19FTl9TYXZlUHJvZHVjdChyZWZyZXNoKQ0Kew0KICAgIGlmICghU1ZNWENfRU5fVmFsaWRhdGVQcm9kKCkpIHsgcmV0dXJuIGZhbHNlOyB9DQoNCiAgICBQcm9kSWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZHVjdF9sa2lkJykudmFsdWU7DQogICAgSWJJZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZXJpYWxfbGtpZCcpLnZhbHVlOw0KICAgIFRvcEliSWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9wX3NlcmlhbF9sa2lkJykudmFsdWU7DQoNCiAgICBpZiAoT2JqVHlwZSA9PSAnQ0FTRScpDQoJew0KCXZhciBvYmogPSBuZXcgc2ZvcmNlLlNPYmplY3QoIkNhc2UiKTsNCglvYmouSWQgPSBFbnRDYXNlSWQ7DQoJb2JqLlNWTVhDX19Qcm9kdWN0X19jID0gUHJvZElkOw0KCWlmIChJYklkICYmIEliSWQubGVuZ3RoID4gMCkNCgkgICAgb2JqLlNWTVhDX19Db21wb25lbnRfX2MgPSBJYklkOw0KCWVsc2UNCgkgICAgb2JqLlNWTVhDX19Db21wb25lbnRfX2MgPSBudWxsOw0KCWlmIChUb3BJYklkICYmIFRvcEliSWQubGVuZ3RoID4gMCkNCgkgICAgb2JqLlNWTVhDX19Ub3BfTGV2ZWxfX2MgPSBUb3BJYklkOw0KCWVsc2UNCgkgICAgb2JqLlNWTVhDX19Ub3BfTGV2ZWxfX2MgPSBudWxsOw0KCX0NCiAgICBlbHNlDQoJew0KCXZhciBvYmogPSBuZXcgc2ZvcmNlLlNPYmplY3QoIlNWTVhQX19TZXJ2aWNlX09yZGVyX19jIik7DQoJb2JqLklkID0gRW50U1ZPSWQ7DQoJaWYgKEliSWQgJiYgSWJJZC5sZW5ndGggPiAwKQ0KCSAgICBvYmouU1ZNWFBfX0NvbXBvbmVudF9fYyA9IEliSWQ7DQoJZWxzZQ0KCSAgICBvYmouU1ZNWFBfX0NvbXBvbmVudF9fYyA9IG51bGw7DQoNCglpZiAoVG9wSWJJZCAmJiBUb3BJYklkLmxlbmd0aCA+IDApDQoJICAgIG9iai5TVk1YUF9fVG9wX0xldmVsX19jID0gVG9wSWJJZDsNCgllbHNlDQoJICAgIG9iai5TVk1YUF9fVG9wX0xldmVsX19jID0gbnVsbDsNCgl9DQogICAgdHJ5IHsNCgl2YXIgcmV0ID0gc2ZvcmNlLmNvbm5lY3Rpb24udXBkYXRlKFtvYmpdKTsNCglpZiAocmVmcmVzaCkNCgkgICAgcGFyZW50LndpbmRvdy5sb2NhdGlvbiA9ICIvIiArIEN1cnJPYmpJZDsNCiAgICAJfQ0KICAgIGNhdGNoIChlKQ0KICAgIAl7DQoJYWxlcnQoU1ZNWENfR2V0TWVzc2FnZSgiTVNHMDAxIikgKyAiXG4iICsgZSk7DQoJcmV0dXJuIGZhbHNlOw0KCX0NCiAgICByZXR1cm4gdHJ1ZTsNCn0NCi8qPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8NCmZ1bmN0aW9uIFNWTVhDX0VOX1ZhbGlkYXRlUHJvZCgpDQp7DQogICAgUHJvZElkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2R1Y3RfbGtpZCcpLnZhbHVlOw0KICAgIEliSWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VyaWFsX2xraWQnKS52YWx1ZTsNCg0KICAgIGlmIChQcm9kSWQubGVuZ3RoIDw9IDAgJiYgSWJJZC5sZW5ndGggPD0gMCkNCiAgICAJew0KCWFsZXJ0KFNWTVhDX0dldE1lc3NhZ2UoIk1TRzAwNCIpKTsNCglyZXR1cm4gZmFsc2U7DQoJfQ0KICAgIGlmICghU1ZNWENfSXNWYWxpZExvb2t1cCgicHJvZHVjdCIpKQ0KICAgIAl7DQoJYWxlcnQoU1ZNWENfR2V0TWVzc2FnZSgiTVNHMDA1IikpOw0KCXJldHVybiBmYWxzZTsNCgl9DQogICAgaWYgKCFTVk1YQ19Jc1ZhbGlkTG9va3VwKCJzZXJpYWwiKSkNCiAgICAJew0KCWFsZXJ0KFNWTVhDX0dldE1lc3NhZ2UoIk1TRzAwNiIpKTsNCglyZXR1cm4gZmFsc2U7DQoJfQ0KICAgIHJldHVybiB0cnVlOw0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KLy8gTGF1bmNoIElCIGNvbmZpZ3VyYXRpb24gYWZ0ZXIgYSBkZWxheSBvZiAzIHNlY29uZHMNCmZ1bmN0aW9uIFNWTVhDX0VOX0xhdW5jaElCQ29uZmlnRGVsYXkoKQ0Kew0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpYndhaXRtc2cnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsgDQogICAgc2V0VGltZW91dCgiU1ZNWENfRU5fTGF1bmNoSUJDb25maWcoKSIsIDMwMDApOw0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KZnVuY3Rpb24gU1ZNWENfRU5fTGF1bmNoSUJDb25maWcoKQ0Kew0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpYnRyZWUiKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgIHZhciBpYmlkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlcmlhbF9sa2lkJykudmFsdWU7DQogICAgaWYgKGliaWQgJiYgaWJpZC5sZW5ndGggPiAwKQ0KCXsNCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZG9tUm9vdCIpLmlubmVySFRNTCA9ICIiOw0KCVNWTVhDX0VOX1Nob3dJQkNvbmZpZ3VyYXRpb24oaWJpZCk7DQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlidHJlZSIpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KCX0NCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWJ3YWl0bXNnJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgDQp9DQovKj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovDQpmdW5jdGlvbiBTVk1YQ19FTl9TaG93SUJDb25maWdTZWN0aW9uKCkNCnsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZG9tUm9vdCIpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KZnVuY3Rpb24gU1ZNWENfRU5fSGlkZUlCQ29uZmlnU2VjdGlvbigpDQp7DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRvbVJvb3QiKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KZnVuY3Rpb24gU1ZNWENfQXNzaWduVG9TRkRDKGZuYW1lKQ0Kew0KICAgIHZhciBmdmFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZm5hbWUpLnZhbHVlOw0KICAgIGlmIChmdmFsICYmIGZ2YWwubGVuZ3RoID4gMCkNCiAgICAJcmV0dXJuIGZ2YWw7DQogICAgZWxzZQ0KICAgIAlyZXR1cm4gbnVsbDsNCn0NCi8qPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8NCmZ1bmN0aW9uIFNWTVhDX0VOX1Nob3dJQkNvbmZpZ3VyYXRpb24oaWJpZCkNCnsNCiAgICB2YXIgSGFzUGFyZW50ID0gdHJ1ZTsNCg0KICAgIGlmICghaWJpZCkgeyByZXR1cm47IH0NCg0KICAgIEluc3RQcm9kSWQgPSBpYmlkOw0KDQogICAgeGJEZXRlY3RCcm93c2VyKCk7DQoNCiAgICB3aGlsZShIYXNQYXJlbnQpDQogICAgCXsNCgl2YXIgc29xbDEgPSAiU0VMRUNUIElkLCBTVk1YQ19fUHJvZHVjdF9fci5OYW1lLCBTVk1YQ19fU2VyaWFsX0xvdF9OdW1iZXJfX2MsIFNWTVhDX19QYXJlbnRfX2MsICIgKw0KCQkgICAgIlNWTVhDX19TdGF0dXNfX2MsIFNWTVhDX19EYXRlX1NoaXBwZWRfX2MsIFNWTVhDX19EYXRlX0luc3RhbGxlZF9fYywgIiArDQoJCSAgICAiU1ZNWENfX1NpdGVfX2MsIFNWTVhDX19TaXRlX19yLk5hbWUsIFNWTVhDX19TaXRlX19yLlNWTVhDX19DaXR5X19jLCAiICsNCgkJICAgICJTVk1YQ19fU2l0ZV9fci5TVk1YQ19fQ291bnRyeV9fYywgU1ZNWENfX0NpdHlfX2MsIFNWTVhDX19Db3VudHJ5X19jICIgKw0KCQkgICAgIkZST00gU1ZNWENfX0luc3RhbGxlZF9Qcm9kdWN0X19jIFdIRVJFIElkID0gJyIgKyBpYmlkICsgIiciOw0KCXZhciBxcjEgPSBzZm9yY2UuY29ubmVjdGlvbi5xdWVyeShzb3FsMSk7DQoJaWYgKHFyMS5zaXplIDw9IDApDQoJICAgIHsNCgkgICAgYWxlcnQoU1ZNWENfR2V0TWVzc2FnZSgiTVNHMDAyIikpOw0KCSAgICByZXR1cm4gZmFsc2U7DQoJICAgIH0NCglpYnJlYyA9IHFyMS5nZXRBcnJheSgicmVjb3JkcyIpWzBdOw0KCWlmIChpYnJlYy5TVk1YQ19fUGFyZW50X19jICYmIGlicmVjLlNWTVhDX19QYXJlbnRfX2MubGVuZ3RoID4gMCkNCgkgICAgaWJpZCA9IGlicmVjLlNWTVhDX19QYXJlbnRfX2M7DQoJZWxzZQ0KCSAgICBIYXNQYXJlbnQgPSBmYWxzZTsNCgl9DQoNCiAgICB2YXIgdHJlZURhdGEgPSBpYnJlYy5TVk1YQ19fUHJvZHVjdF9fci5OYW1lOw0KDQogICAgaWYgKGlicmVjLlNWTVhDX19TZXJpYWxfTG90X051bWJlcl9fYyAmJiBpYnJlYy5TVk1YQ19fU2VyaWFsX0xvdF9OdW1iZXJfX2MubGVuZ3RoID4gMCkgdHJlZURhdGEgKz0gIiwgIiArIGlicmVjLlNWTVhDX19TZXJpYWxfTG90X051bWJlcl9fYzsNCiAgICBpZiAoaWJyZWMuU1ZNWENfX1N0YXR1c19fYyAmJiBpYnJlYy5TVk1YQ19fU3RhdHVzX19jLmxlbmd0aCA+IDApIHRyZWVEYXRhICs9ICIsICIgKyBpYnJlYy5TVk1YQ19fU3RhdHVzX19jOw0KDQogICAgaWYgKGlicmVjLlNWTVhDX19TaXRlX19yKQ0KCXsNCglpZiAoaWJyZWMuU1ZNWENfX1NpdGVfX3IuU1ZNWENfX0NpdHlfX2MpIHRyZWVEYXRhICs9ICIsICIgKyBpYnJlYy5TVk1YQ19fU2l0ZV9fci5TVk1YQ19fQ2l0eV9fYzsNCglpZiAoaWJyZWMuU1ZNWENfX1NpdGVfX3IuU1ZNWENfX0NvdW50cnlfX2MpIHRyZWVEYXRhICs9ICIsICIgKyBpYnJlYy5TVk1YQ19fU2l0ZV9fci5TVk1YQ19fQ291bnRyeV9fYzsNCgl9DQogICAgZWxzZQ0KCXsNCglpZiAoaWJyZWMuU1ZNWENfX0NpdHlfX2MpIHRyZWVEYXRhICs9ICIsICIgKyBpYnJlYy5TVk1YQ19fQ2l0eV9fYzsNCglpZiAoaWJyZWMuU1ZNWENfX0NvdW50cnlfX2MpIHRyZWVEYXRhICs9ICIsICIgKyBpYnJlYy5TVk1YQ19fQ291bnRyeV9fYzsNCgl9DQoNCiAgICBmb2xkZXJzVHJlZSA9IGdGbGQoIjxiPiIgKyB0cmVlRGF0YSArICI8L2I+IiwgIiIpOw0KICAgIGZvbGRlcnNUcmVlLnRyZWVJRCA9ICJJQlRyZWUiIDsNCg0KICAgIAkgICAgLy8gR2V0IGNoaWxkcmVuIGZvciB0aGUgdG9wLWxldmVsIG5vZGUNCiAgICBTVk1YQ19FTl9HZXRJQkNoaWxkcmVuKGlicmVjLklkLCBmb2xkZXJzVHJlZSk7DQoNCiAgICBpbml0aWFsaXplRG9jdW1lbnQoKTsJLy8gVGhpcyBpcyB0aGUgZnVuY3Rpb24gdGhhdCByZW5kZXJzIHRoZSB0cmVlIG9uIHRoZSBIVE1MIGRpdg0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8NCmZ1bmN0aW9uIFNWTVhDX0VOX0dldElCQ2hpbGRyZW4oaWJpZCwgcGFyZW50Tm9kZSkNCnsNCiAgICB2YXIgc29xbDIgPSAiU0VMRUNUIElkLCBTVk1YQ19fUHJvZHVjdF9fci5OYW1lLCBTVk1YQ19fU2VyaWFsX0xvdF9OdW1iZXJfX2MsICIgKw0KCQkiU1ZNWENfX1N0YXR1c19fYywgU1ZNWENfX0RhdGVfU2hpcHBlZF9fYywgU1ZNWENfX0RhdGVfSW5zdGFsbGVkX19jLCAiICsNCgkJIlNWTVhDX19TaXRlX19jLCBTVk1YQ19fU2l0ZV9fci5OYW1lLCBTVk1YQ19fU2l0ZV9fci5TVk1YQ19fQ2l0eV9fYywgIiArDQoJCSJTVk1YQ19fU2l0ZV9fci5TVk1YQ19fQ291bnRyeV9fYywgU1ZNWENfX0NpdHlfX2MsIFNWTVhDX19Db3VudHJ5X19jICIgKw0KCQkiRlJPTSBTVk1YQ19fSW5zdGFsbGVkX1Byb2R1Y3RfX2MgV0hFUkUgU1ZNWENfX1BhcmVudF9fYyA9ICciICsgaWJpZCArICInIjsNCiAgICB2YXIgcXIyID0gc2ZvcmNlLmNvbm5lY3Rpb24ucXVlcnkoc29xbDIpOw0KDQogICAgaWYgKHFyMi5zaXplIDw9IDApIHsgcmV0dXJuOyB9DQoNCiAgICB2YXIgaWJyZWNzID0gbmV3IHNmb3JjZS5RdWVyeVJlc3VsdEl0ZXJhdG9yKHFyMik7DQoNCiAgICB3aGlsZSAoaWJyZWNzLmhhc05leHQoKSkNCiAgICAJew0KCXZhciBpYnJlYyA9IGlicmVjcy5uZXh0KCk7DQoNCgl2YXIgdHJlZURhdGEgPSBpYnJlYy5TVk1YQ19fUHJvZHVjdF9fci5OYW1lOw0KDQoJaWYgKGlicmVjLlNWTVhDX19TZXJpYWxfTG90X051bWJlcl9fYyAmJiBpYnJlYy5TVk1YQ19fU2VyaWFsX0xvdF9OdW1iZXJfX2MubGVuZ3RoID4gMCkgdHJlZURhdGEgKz0gIiwgIiArIGlicmVjLlNWTVhDX19TZXJpYWxfTG90X051bWJlcl9fYzsNCglpZiAoaWJyZWMuU1ZNWENfX1N0YXR1c19fYyAmJiBpYnJlYy5TVk1YQ19fU3RhdHVzX19jLmxlbmd0aCA+IDApIHRyZWVEYXRhICs9ICIsICIgKyBpYnJlYy5TVk1YQ19fU3RhdHVzX19jOw0KDQoJaWYgKGlicmVjLlNWTVhDX19TaXRlX19yKQ0KCSAgICB7DQoJICAgIGlmIChpYnJlYy5TVk1YQ19fU2l0ZV9fci5TVk1YQ19fQ2l0eV9fYykgdHJlZURhdGEgKz0gIiwgIiArIGlicmVjLlNWTVhDX19TaXRlX19yLlNWTVhDX19DaXR5X19jOw0KCSAgICBpZiAoaWJyZWMuU1ZNWENfX1NpdGVfX3IuU1ZNWENfX0NvdW50cnlfX2MpIHRyZWVEYXRhICs9ICIsICIgKyBpYnJlYy5TVk1YQ19fU2l0ZV9fci5TVk1YQ19fQ291bnRyeV9fYzsNCgkgICAgfQ0KCWVsc2UNCgkgICAgew0KCSAgICBpZiAoaWJyZWMuU1ZNWENfX0NpdHlfX2MpIHRyZWVEYXRhICs9ICIsICIgKyBpYnJlYy5TVk1YQ19fQ2l0eV9fYzsNCgkgICAgaWYgKGlicmVjLlNWTVhDX19Db3VudHJ5X19jKSB0cmVlRGF0YSArPSAiLCAiICsgaWJyZWMuU1ZNWENfX0NvdW50cnlfX2M7DQoJICAgIH0NCg0KCXZhciB0cmVlQ2hpbGQgPSBpbnNGbGQocGFyZW50Tm9kZSwgZ0ZsZCh0cmVlRGF0YSwgIi8iICsgaWJyZWMuSWQpKTsNCg0KCVNWTVhDX0VOX0dldElCQ2hpbGRyZW4oaWJyZWMuSWQsIHRyZWVDaGlsZCk7DQoJfQ0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8NCi8qKioqKioqKioqKioqPDw8PDw8PDw8PDw8IEdFTkVSSUMgVVRJTElUSUVTID4+Pj4+Pj4+Pj4+Pj4+Pj4+ICoqKioqKioqKioqKioqKioqLw0KLy8gR2V0IHRoZSByZXRVUkwgcGFyYW1ldGVyIGZyb20gdGhlIHdpbmRvdyBVUkwNCi8vIEl0IGlzIHJlcXVpcmVkIGluIHNhdmUgb3IgY2FuY2VsIGV2ZW50cw0KZnVuY3Rpb24gU1ZNWENfR2V0UmV0dXJuVVJMKCkNCnsNCiAgICB2YXIgdGhlQXJnTmFtZSA9ICdyZXRVUkwnOw0KICAgIHZhciBzQXJncyA9IHBhcmVudC53aW5kb3cubG9jYXRpb24uc2VhcmNoLnNsaWNlKDEpLnNwbGl0KCcmJyk7DQogICAgciA9ICcnOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc0FyZ3MubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgaWYgKHNBcmdzW2ldLnNsaWNlKDAsc0FyZ3NbaV0uaW5kZXhPZignPScpKSA9PSB0aGVBcmdOYW1lKSB7DQogICAgICAgICAgICByID0gc0FyZ3NbaV0uc2xpY2Uoc0FyZ3NbaV0uaW5kZXhPZignPScpKzEpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0VVJMID0gci5sZW5ndGggPiAwID8gdW5lc2NhcGUocikuc3BsaXQoJywnKSA6ICcnOw0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KLy8gQXNzaWduIGEgZ2l2ZW4gdGV4dCB2YWx1ZSB0byBhIGZvcm0gZmllbGQNCmZ1bmN0aW9uIFNWTVhDX0Fzc2lnbkZvcm1WYWx1ZShjdGxuYW1lLCBmcm9tdmFsKQ0Kew0KICAgIGlmKGZyb212YWwpIHsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY3RsbmFtZSkudmFsdWUgPSBmcm9tdmFsOyB9DQogICAgZWxzZSB7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGN0bG5hbWUpLnZhbHVlID0gIiI7IH0NCn0NCi8qPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8NCi8vIEFzc2lnbiBhIGdpdmVuIGRhdGUgdmFsdWUgdG8gYSBmb3JtIGZpZWxkIGFmdGVyIGNvbnZlcnRpbmcgaXQgdG8gdGhlIHVzZXIncyBsb2NhbGUgZm9ybWF0DQpmdW5jdGlvbiBTVk1YQ19Bc3NpZ25Gb3JtRGF0ZShjdGxuYW1lLCBmcm9tZGF0ZSkNCnsNCiAgICBpZiAoZnJvbWRhdGUpDQogICAgICAgIHsNCgl2YXIgZGMgPSBmcm9tZGF0ZS5zcGxpdCgnLScsIDMpOw0KCXZhciBkID0gbmV3IERhdGUoZGNbMF0sIGRjWzFdIC0gMSwgZGNbMl0pOw0KCXZhciBkZm10ID0gcGFyZW50LlVzZXJDb250ZXh0LmRhdGVGb3JtYXQ7DQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY3RsbmFtZSkudmFsdWUgPSBEYXRlVXRpbC5mb3JtYXREYXRlKGQsIGRmbXQpOw0KCX0NCiAgICBlbHNlDQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY3RsbmFtZSkudmFsdWUgPSAiIjsNCn0NCi8qPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8NCi8vIENvbnZlcnQgYSBkYXRlIGZyb20gdXNlcidzIGxvY2FsIGZvcm1hdCB0byBTRkRDJ3MgZm9ybWF0IChZWVlZLU1NLUREKQ0KZnVuY3Rpb24gU1ZNWENfQ29udmVydFRvU0ZEQ0RhdGVGb3JtYXQoY3RsbmFtZSkNCnsNCiAgICB2YXIgZHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjdGxuYW1lKS52YWx1ZTsNCiAgICBpZiAoZHQubGVuZ3RoIDw9IDApIHJldHVybiBudWxsOw0KDQogICAgdmFyIGQgPSBTVk1YQ19HZXREYXRlRnJvbUZvcm1hdChkdCwgcGFyZW50LlVzZXJDb250ZXh0LmRhdGVGb3JtYXQpOw0KDQogICAgdmFyIG1vbiA9IHBhcnNlSW50KGQuZ2V0TW9udGgoKSkgKyAxOw0KICAgIGlmIChtb24gPCAxMCkgeyBtb24gPSAiMCIgKyBtb247IH0NCg0KICAgIHZhciBkYXkgPSBwYXJzZUludChkLmdldERhdGUoKSk7DQogICAgaWYgKGRheSA8IDEwKSB7IGRheSA9ICIwIiArIGRheTsgfQ0KDQogICAgdmFyIGR0cyA9IGQuZ2V0RnVsbFllYXIoKSArICItIiArIG1vbiArICItIiArIGRheTsNCg0KICAgIHJldHVybiBkdHM7DQp9DQovKj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovDQovLyBDb252ZXJ0IGEgRGF0ZSB2YXJpYWJsZSB0byBTRkRDIGRhdGUgZm9ybWF0DQpmdW5jdGlvbiBTVk1YQ19Db252ZXJ0RGF0ZVRvU0ZEQyhkYXRldmFsKQ0Kew0KICAgIHZhciBtb24gPSBwYXJzZUludChkYXRldmFsLmdldE1vbnRoKCkpICsgMTsNCiAgICBpZiAobW9uIDwgMTApIHsgbW9uID0gIjAiICsgbW9uOyB9DQoNCiAgICB2YXIgZGF5ID0gcGFyc2VJbnQoZGF0ZXZhbC5nZXREYXRlKCkpOw0KICAgIGlmIChkYXkgPCAxMCkgeyBkYXkgPSAiMCIgKyBkYXk7IH0NCg0KICAgIHZhciBkdHMgPSBkYXRldmFsLmdldEZ1bGxZZWFyKCkgKyAiLSIgKyBtb24gKyAiLSIgKyBkYXk7DQoNCiAgICByZXR1cm4gZHRzOw0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KLy8gVGhpcyBmdW5jdGlvbiBpcyBhIGhhY2sgZnJvbSBTRkRDIGxpYnJhcnkuIEl0IHJldHVybnMgYSBqYXZhc2NyaXB0IERhdGUgdmFyaWFibGUNCi8vIGZvciBhIGRhdGUgdmFsdWUgaW4gdGhlIGdpdmVuIGZvcm1hdC4gVGhlIFNGREMgcm91dGluZSByZXR1cm5zIHRoZSB0aW1lIHBhcnQgd2hpY2ggd2UgZG9uJ3Qgd2FudC4NCmZ1bmN0aW9uIFNWTVhDX0dldERhdGVGcm9tRm9ybWF0KHZhbCxmb3JtYXQpDQp7DQoJdmFsPXZhbCsiIjsNCglmb3JtYXQ9Zm9ybWF0KyIiOw0KCXZhciBpX3ZhbD0wOw0KCXZhciBpX2Zvcm1hdD0wOw0KCXZhciBjPSIiOw0KCXZhciB0b2tlbj0iIjsNCgl2YXIgdG9rZW4yPSIiOw0KCXZhciB4LHk7DQoJdmFyIG5vdz1uZXcgRGF0ZSgpOw0KCXZhciB5ZWFyPW5vdy5nZXRZZWFyKCk7DQoJdmFyIG1vbnRoPW5vdy5nZXRNb250aCgpKzE7DQoJdmFyIGRhdGU9MTsNCgl2YXIgaGg9bm93LmdldEhvdXJzKCk7DQoJdmFyIG1tPW5vdy5nZXRNaW51dGVzKCk7DQoJdmFyIHNzPW5vdy5nZXRTZWNvbmRzKCk7DQoJdmFyIGFtcG09IiI7DQoJDQoJd2hpbGUgKGlfZm9ybWF0IDwgZm9ybWF0Lmxlbmd0aCkgew0KCQkvLyBHZXQgbmV4dCB0b2tlbiBmcm9tIGZvcm1hdCBzdHJpbmcNCgkJYz1mb3JtYXQuY2hhckF0KGlfZm9ybWF0KTsNCgkJdG9rZW49IiI7DQoJCXdoaWxlICgoZm9ybWF0LmNoYXJBdChpX2Zvcm1hdCk9PWMpICYmIChpX2Zvcm1hdCA8IGZvcm1hdC5sZW5ndGgpKSB7DQoJCQl0b2tlbiArPSBmb3JtYXQuY2hhckF0KGlfZm9ybWF0KyspOw0KCQkJfQ0KCQkvLyBFeHRyYWN0IGNvbnRlbnRzIG9mIHZhbHVlIGJhc2VkIG9uIGZvcm1hdCB0b2tlbg0KCQlpZiAodG9rZW49PSJ5eXl5IiB8fCB0b2tlbj09Inl5IiB8fCB0b2tlbj09InkiKSB7DQoJCQlpZiAodG9rZW49PSJ5eXl5IikgeyB4PTI7eT00OyB9IC8vIHg9Mix5PTQgdG8gYmUgY29uc2lzdGVudCB3aXRoIGphdmEuDQoJCQlpZiAodG9rZW49PSJ5eSIpICAgeyB4PTI7eT0yOyB9DQoJCQlpZiAodG9rZW49PSJ5IikgICAgeyB4PTI7eT00OyB9DQoJCQl5ZWFyPURhdGVVdGlsLl9nZXRJbnQodmFsLGlfdmFsLHgseSk7DQoJCQlpZiAoeWVhcj09bnVsbCkgeyByZXR1cm4gMDsgfQ0KCQkJaV92YWwgKz0geWVhci5sZW5ndGg7DQoJCQlpZiAoeWVhci5sZW5ndGg9PTIpIHsNCgkJCQlpZiAoeWVhciA+IDcwKSB7IHllYXI9MTkwMCsoeWVhci0wKTsgfQ0KCQkJCWVsc2UgeyB5ZWFyPTIwMDArKHllYXItMCk7IH0NCgkJCQl9DQoJCQl9DQoJCWVsc2UgaWYgKHRva2VuPT0iTU1NInx8dG9rZW49PSJOTk4iKXsNCgkJCW1vbnRoPTA7DQoJCQlmb3IgKHZhciBpPTA7IGk8RGF0ZVV0aWwuTU9OVEhfTkFNRVMubGVuZ3RoOyBpKyspIHsNCgkJCQl2YXIgbW9udGhfbmFtZT1EYXRlVXRpbC5NT05USF9OQU1FU1tpXTsNCgkJCQlpZiAodmFsLnN1YnN0cmluZyhpX3ZhbCxpX3ZhbCttb250aF9uYW1lLmxlbmd0aCkudG9Mb3dlckNhc2UoKT09bW9udGhfbmFtZS50b0xvd2VyQ2FzZSgpKSB7DQoJCQkJCWlmICh0b2tlbj09Ik1NTSJ8fCh0b2tlbj09Ik5OTiImJmk+MTEpKSB7DQoJCQkJCQltb250aD1pKzE7DQoJCQkJCQlpZiAobW9udGg+MTIpIHsgbW9udGggLT0gMTI7IH0NCgkJCQkJCWlfdmFsICs9IG1vbnRoX25hbWUubGVuZ3RoOw0KCQkJCQkJYnJlYWs7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9DQoJCQlpZiAoKG1vbnRoIDwgMSl8fChtb250aD4xMikpe3JldHVybiAwO30NCgkJCX0NCgkJZWxzZSBpZiAodG9rZW49PSJFRSJ8fHRva2VuPT0iRSIpew0KCQkJZm9yICh2YXIgaT0wOyBpPERhdGVVdGlsLkRBWV9OQU1FUy5sZW5ndGg7IGkrKykgew0KCQkJCXZhciBkYXlfbmFtZT1EYXRlVXRpbC5EQVlfTkFNRVNbaV07DQoJCQkJaWYgKHZhbC5zdWJzdHJpbmcoaV92YWwsaV92YWwrZGF5X25hbWUubGVuZ3RoKS50b0xvd2VyQ2FzZSgpPT1kYXlfbmFtZS50b0xvd2VyQ2FzZSgpKSB7DQoJCQkJCWlfdmFsICs9IGRheV9uYW1lLmxlbmd0aDsNCgkJCQkJYnJlYWs7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCWVsc2UgaWYgKHRva2VuPT0iTU0ifHx0b2tlbj09Ik0iKSB7DQoJCQltb250aD1EYXRlVXRpbC5fZ2V0SW50KHZhbCxpX3ZhbCwxLDIpOyAvLyBBbHdheXMgdXNlIG1pbiBsZW4gMSB0byBiZSBsZW5pZW50Lg0KCQkJaWYobW9udGg9PW51bGx8fChtb250aDwxKXx8KG1vbnRoPjEyKSl7cmV0dXJuIDA7fQ0KCQkJaV92YWwrPW1vbnRoLmxlbmd0aDt9DQoJCWVsc2UgaWYgKHRva2VuPT0iZGQifHx0b2tlbj09ImQiKSB7DQoJCQlkYXRlPURhdGVVdGlsLl9nZXRJbnQodmFsLGlfdmFsLDEsMik7IC8vIEFsd2F5cyB1c2UgbWluIGxlbiAxIHRvIGJlIGxlbmllbnQuDQoJCQlpZihkYXRlPT1udWxsfHwoZGF0ZTwxKXx8KGRhdGU+MzEpKXtyZXR1cm4gMDt9DQoJCQlpX3ZhbCs9ZGF0ZS5sZW5ndGg7fQ0KCQllbHNlIGlmICh0b2tlbj09ImhoInx8dG9rZW49PSJoIikgew0KCQkJaGg9RGF0ZVV0aWwuX2dldEludCh2YWwsaV92YWwsdG9rZW4ubGVuZ3RoLDIpOw0KCQkJaWYoaGg9PW51bGx8fChoaDwxKXx8KGhoPjEyKSl7cmV0dXJuIDA7fQ0KCQkJaV92YWwrPWhoLmxlbmd0aDt9DQoJCWVsc2UgaWYgKHRva2VuPT0iSEgifHx0b2tlbj09IkgiKSB7DQoJCQloaD1EYXRlVXRpbC5fZ2V0SW50KHZhbCxpX3ZhbCx0b2tlbi5sZW5ndGgsMik7DQoJCQlpZihoaD09bnVsbHx8KGhoPDApfHwoaGg+MjMpKXtyZXR1cm4gMDt9DQoJCQlpX3ZhbCs9aGgubGVuZ3RoO30NCgkJZWxzZSBpZiAodG9rZW49PSJLSyJ8fHRva2VuPT0iSyIpIHsNCgkJCWhoPURhdGVVdGlsLl9nZXRJbnQodmFsLGlfdmFsLHRva2VuLmxlbmd0aCwyKTsNCgkJCWlmKGhoPT1udWxsfHwoaGg8MCl8fChoaD4xMSkpe3JldHVybiAwO30NCgkJCWlfdmFsKz1oaC5sZW5ndGg7fQ0KCQllbHNlIGlmICh0b2tlbj09ImtrInx8dG9rZW49PSJrIikgew0KCQkJaGg9RGF0ZVV0aWwuX2dldEludCh2YWwsaV92YWwsdG9rZW4ubGVuZ3RoLDIpOw0KCQkJaWYoaGg9PW51bGx8fChoaDwxKXx8KGhoPjI0KSl7cmV0dXJuIDA7fQ0KCQkJaV92YWwrPWhoLmxlbmd0aDtoaC0tO30NCgkJZWxzZSBpZiAodG9rZW49PSJtbSJ8fHRva2VuPT0ibSIpIHsNCgkJCW1tPURhdGVVdGlsLl9nZXRJbnQodmFsLGlfdmFsLHRva2VuLmxlbmd0aCwyKTsNCgkJCWlmKG1tPT1udWxsfHwobW08MCl8fChtbT41OSkpe3JldHVybiAwO30NCgkJCWlfdmFsKz1tbS5sZW5ndGg7fQ0KCQllbHNlIGlmICh0b2tlbj09InNzInx8dG9rZW49PSJzIikgew0KCQkJc3M9RGF0ZVV0aWwuX2dldEludCh2YWwsaV92YWwsdG9rZW4ubGVuZ3RoLDIpOw0KCQkJaWYoc3M9PW51bGx8fChzczwwKXx8KHNzPjU5KSl7cmV0dXJuIDA7fQ0KCQkJaV92YWwrPXNzLmxlbmd0aDt9DQoJCWVsc2UgaWYgKHRva2VuPT0iYSIpIHsNCgkJICAgIHZhciBhbSA9IERhdGVVdGlsLmdldEFNU3ltYm9sKCk7DQoJCSAgICB2YXIgcG0gPSBEYXRlVXRpbC5nZXRQTVN5bWJvbCgpOw0KCQkgICAgdmFyIHN0cmEgPSB2YWwuc3Vic3RyaW5nKGlfdmFsLCBpX3ZhbCArIGFtLmxlbmd0aCk7DQoJCSAgICB2YXIgc3RycCA9IHZhbC5zdWJzdHJpbmcoaV92YWwsIGlfdmFsICsgcG0ubGVuZ3RoKTsNCgkJCWlmIChzdHJhID09IGFtIHx8IHN0cmEudG9VcHBlckNhc2UoKSA9PSBhbSkgew0KCQkJICAgIGFtcG0gPSBhbTsNCgkJCX0gZWxzZSBpZiAoc3RycCA9PSBwbSB8fCBzdHJwLnRvVXBwZXJDYXNlKCkgPT0gcG0pIHsNCgkJCSAgICBhbXBtID0gcG07DQoJCQl9IGVsc2Ugew0KCQkJICAgIHJldHVybiAwOw0KCQkgICAgfQ0KICAgICAgICAgICAgICAgIGlfdmFsICs9IGFtcG0ubGVuZ3RoOw0KCQl9DQoJCWVsc2Ugew0KCQkJaWYgKHZhbC5zdWJzdHJpbmcoaV92YWwsaV92YWwrdG9rZW4ubGVuZ3RoKSE9dG9rZW4pIHtyZXR1cm4gMDt9DQoJCQllbHNlIHtpX3ZhbCs9dG9rZW4ubGVuZ3RoO30NCgkJCX0NCgkJfQ0KCS8vIElmIHRoZXJlIGFyZSBhbnkgdHJhaWxpbmcgY2hhcmFjdGVycyBsZWZ0IGluIHRoZSB2YWx1ZSwgaXQgZG9lc24ndCBtYXRjaA0KCWlmIChpX3ZhbCAhPSB2YWwubGVuZ3RoKSB7IHJldHVybiAwOyB9DQoJLy8gSXMgZGF0ZSB2YWxpZCBmb3IgbW9udGg/DQoJaWYgKG1vbnRoPT0yKSB7DQoJCS8vIENoZWNrIGZvciBsZWFwIHllYXINCgkJaWYgKCAoICh5ZWFyJTQ9PTApJiYoeWVhciUxMDAgIT0gMCkgKSB8fCAoeWVhciU0MDA9PTApICkgeyAvLyBsZWFwIHllYXINCgkJCWlmIChkYXRlID4gMjkpeyByZXR1cm4gMDsgfQ0KCQkJfQ0KCQllbHNlIHsgaWYgKGRhdGUgPiAyOCkgeyByZXR1cm4gMDsgfSB9DQoJCX0NCglpZiAoKG1vbnRoPT00KXx8KG1vbnRoPT02KXx8KG1vbnRoPT05KXx8KG1vbnRoPT0xMSkpIHsNCgkJaWYgKGRhdGUgPiAzMCkgeyByZXR1cm4gMDsgfQ0KCQl9DQoJLy8gQ29ycmVjdCBob3VycyB2YWx1ZQ0KCWlmIChoaDwxMiAmJiBhbXBtID09IERhdGVVdGlsLmdldFBNU3ltYm9sKCkpIHsgaGg9aGgtMCsxMjsgfQ0KCWVsc2UgaWYgKGhoPjExICYmIGFtcG0gPT0gRGF0ZVV0aWwuZ2V0QU1TeW1ib2woKSkgeyBoaC09MTI7IH0NCgl2YXIgbmV3ZGF0ZT1uZXcgRGF0ZSh5ZWFyLG1vbnRoLTEsZGF0ZSxoaCxtbSxzcyk7DQoJcmV0dXJuIG5ld2RhdGU7DQp9DQovKj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovDQovLyBTaG93IGEgcG9wdXAgY2FsZW5kYXIgYWRqYWNlbnQgdG8gdGhlIGRhdGUgZmllbGQNCi8vIFRvbyBiYWQgd2UgY2FuJ3QgdXNlIHRoZSBzdGFuZGFyZCBkYXRlIHBvcHVwIFNGREMgdXNlcw0KZnVuY3Rpb24gU1ZNWENfU2hvd0NhbChjdGwpDQp7DQogICAgb3BlblBvcHVwKCcvaG9tZS9jYWxlbmRhci5qc3A/Zm9ybT1lbnRfZm9ybSYnICsgJ2ZpZWxkPScgKyBjdGwuaWQgKyAnJm1vPTAmY2FsbG9uY2hhbmdlPXRydWUnLA0KICAgIAknX2JsYW5rJywgMTg2LCAxNzAsDQoJJ3dpZHRoPTE4NixoZWlnaHQ9MTcwLHJlc2l6YWJsZT15ZXMsdG9vbGJhcj1ubyxzdGF0dXM9bm8sc2Nyb2xsYmFycz1ubyxtZW51YmFyPW5vLGRpcmVjdG9yaWVzPW5vLGxvY2F0aW9uPW5vLGRlcGVuZGFudD15ZXMnLA0KCXRydWUpOw0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KLy8gQ2hlY2sgaWYgdGhlIGdpdmVuIGZpZWxkIGlzIGJsYW5rDQpmdW5jdGlvbiBTVk1YQ19Jc0ZpZWxkQmxhbmsoZm5hbWUpDQp7DQogICAgdmFyIGN0bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZuYW1lKTsNCg0KICAgIGlmKChjdGwudHlwZSA9PSAidGV4dCIgfHwgY3RsLnR5cGUgPT0gImhpZGRlbiIpICYmICghY3RsLnZhbHVlIHx8IGN0bC52YWx1ZS5sZW5ndGggPT0gMCkpIHsgcmV0dXJuIHRydWU7IH0NCg0KICAgIGlmKGN0bC50eXBlID09ICJzZWxlY3Qtb25lIiAmJiBjdGwuc2VsZWN0ZWRJbmRleCA9PSAtMSkgeyByZXR1cm4gdHJ1ZTsgfQ0KDQogICAgcmV0dXJuIGZhbHNlOw0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KLy8gQ2hlY2sgaWYgdGhlIGdpdmVuIGxvb2t1cCBmaWVsZCBoYXMgYSB2YWxpZCB2YWx1ZSBsaW5rZWQgdG8gYW4gSUQNCmZ1bmN0aW9uIFNWTVhDX0lzVmFsaWRMb29rdXAoZm5hbWUpDQp7DQogICAgdmFyIGN0bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZuYW1lKTsNCiAgICB2YXIgaWRjdGwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChmbmFtZSArICJfbGtpZCIpOw0KDQogICAgaWYgKGN0bC52YWx1ZSAmJiBjdGwudmFsdWUubGVuZ3RoID4gMCAmJiBpZGN0bC52YWx1ZS5sZW5ndGggPT0gMCkgeyByZXR1cm4gZmFsc2U7IH0NCg0KICAgIHJldHVybiB0cnVlOw0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KLy8gQ2hlY2sgaWYgdGhlIGdpdmVuIGRhdGUgaXMgdmFsaWQgYXMgcGVyIHRoZSB1c2VyJ3MgbG9jYWxlDQpmdW5jdGlvbiBTVk1YQ19Jc1ZhbGlkRGF0ZShmbmFtZSkNCnsNCiAgICB2YXIgY3RsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZm5hbWUpOw0KICAgIHJldHVybihEYXRlVXRpbC5pc0RhdGUoY3RsLnZhbHVlLCBwYXJlbnQuVXNlckNvbnRleHQuZGF0ZUZvcm1hdCkpOw0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KLy8gQnVpbGQgYSBnbG9iYWwgaGFzaCB0YWJsZSBvZiBtZXNzYWdlIG51bWJlcnMgYW5kIG1lc3NhZ2VzLg0KLy8gVGhpcyBhcnJheSB3aWxsIGJlIHVzZWQgZm9yIGRpc3BsYXlpbmcgaW5mby93YXJuaW5nL2Vycm9yIG1lc3NhZ2VzIHRvIHRoZSB1c2VyLg0KZnVuY3Rpb24gU1ZNWENfSW5pdE1lc3NhZ2VMaXN0KHN1Ym1vZHVsZWlkKQ0Kew0KICAgIHZhciBmb3VuZCA9IGZhbHNlOw0KDQogICAgdmFyIExhbmdMaXN0ID0gbmV3IEFycmF5KCk7DQoNCiAgICAJCS8vIEhhc2ggKE1hcCkgb2YgU0ZEQyBsYW5ndWFnZSBJU08gY29kZSB0byBMYW5ndWFnZSBwaWNrbGlzdCBpbiBTZXJ2aWNlTWF4IHRhZ3Mgb2JqZWN0DQogICAgTGFuZ0xpc3RbImVuX1VTIl0gPSAiRW5nbGlzaCI7DQogICAgTGFuZ0xpc3RbImRlIl0gPSAiR2VybWFuIjsNCiAgICBMYW5nTGlzdFsiZXMiXSA9ICJTcGFuaXNoIjsNCiAgICBMYW5nTGlzdFsiZnIiXSA9ICJGcmVuY2giOw0KICAgIExhbmdMaXN0WyJpdCJdID0gIkl0YWxpYW4iOw0KICAgIExhbmdMaXN0WyJqYSJdID0gIkphcGFuZXNlIjsNCiAgICBMYW5nTGlzdFsic3YiXSA9ICJTd2VkaXNoIjsNCiAgICBMYW5nTGlzdFsia28iXSA9ICJLb3JlYW4iOw0KICAgIExhbmdMaXN0WyJ6aF9UVyJdID0gIkNoaW5lc2UgKFRyYWRpdGlvbmFsKSI7DQogICAgTGFuZ0xpc3RbInpoX0NOIl0gPSAiQ2hpbmVzZSAoU2ltcGxpZmllZCkiOw0KICAgIExhbmdMaXN0WyJwdF9CUiJdID0gIlBvcnR1Z3Vlc2UgKEJyYXppbGlhbikiOw0KICAgIExhbmdMaXN0WyJubF9OTCJdID0gIkR1dGNoIjsNCiAgICBMYW5nTGlzdFsiZGEiXSA9ICJEYW5pc2giOw0KICAgIExhbmdMaXN0WyJ0aCJdID0gIlRoYWkiOw0KICAgIExhbmdMaXN0WyJmaSJdID0gIkZpbm5pc2giOw0KICAgIExhbmdMaXN0WyJydSJdID0gIlJ1c3NpYW4iOw0KDQogICAgdmFyIFVzZXJMYW5nID0gc2ZvcmNlLmNvbm5lY3Rpb24uZ2V0VXNlckluZm8oKS51c2VyTGFuZ3VhZ2U7CS8vIElTTyBjb2RlIG9mIHRoZSB1c2VyJ3MgbGFuZ3VhZ2UNCg0KICAgIGlmICghTGFuZ0xpc3RbVXNlckxhbmddKSB7IFVzZXJMYW5nID0gIkVuZ2xpc2giOyB9CQkvLyBpZiB1c2VyJ3MgbGFuZ3VhZ2UgaXMgbm90IGZvdW5kLCBkZWZhdWx0IGl0IHRvIEVuZ2xpc2gNCiAgICBlbHNlIHsgVXNlckxhbmcgPSBMYW5nTGlzdFtVc2VyTGFuZ107IH0NCg0KICAgIHZhciBzb3FsID0gIlNFTEVDVCBJZCwgTmFtZSwgU1ZNWENfX1RhZ19UZXh0X19jLCBTVk1YQ19fTGFuZ3VhZ2VfX2MgIiArDQogICAgCQkiRlJPTSBTVk1YQ19fU2VydmljZU1heF9UYWdzX19jICIgKw0KCQkiV0hFUkUgU1ZNWENfX1N1Ym1vZHVsZUlEX19jID0gJyIgKyBzdWJtb2R1bGVpZCArICInICIgKw0KCQkiQU5EIFNWTVhDX19MYW5ndWFnZV9fYyBJTiAoJ01hc3RlcicsICciICsgVXNlckxhbmcgKyAiJykiOw0KICAgIHZhciBxciA9IHNmb3JjZS5jb25uZWN0aW9uLnF1ZXJ5KHNvcWwpOw0KICAgIHZhciB0YWdyZWNzID0gbmV3IHNmb3JjZS5RdWVyeVJlc3VsdEl0ZXJhdG9yKHFyKTsNCiAgICB3aGlsZSAodGFncmVjcy5oYXNOZXh0KCkpDQogICAgCXsNCiAgICAgICAgdmFyIHRhZ3JlYyA9IHRhZ3JlY3MubmV4dCgpOw0KCXZhciBUYWdJZCA9IHRhZ3JlYy5OYW1lOw0KCXZhciBUYWdUZXh0ID0gdGFncmVjLlNWTVhDX19UYWdfVGV4dF9fYzsNCgl2YXIgTGFuZyA9IHRhZ3JlYy5TVk1YQ19fTGFuZ3VhZ2VfX2M7DQoJaWYgKExhbmcgPT0gIk1hc3RlciIgJiYgIU1zZ0xpc3RbVGFnSWRdKQ0KCSAgICBNc2dMaXN0W1RhZ0lkXSA9IFRhZ1RleHQ7DQoJZWxzZSBpZiAoTGFuZyA9PSBVc2VyTGFuZyAmJiBUYWdUZXh0ICYmIFRhZ1RleHQubGVuZ3RoID4gMCkJLy8gVHJhbnNsYXRpb24gYXZhaWxhYmxlIGluIHRoZSBzcGVjaWZpYyBsYW5ndWFnZQ0KCSAgICBNc2dMaXN0W1RhZ0lkXSA9IFRhZ1RleHQ7DQoNCglmb3VuZCA9IHRydWU7DQoJfQ0KDQogICAgaWYgKCFmb3VuZCkNCgl7DQoJTXNnTGlzdFsnTVNHMDAxJ10gPSAnQW4gaW50ZXJuYWwgZXJyb3Igb2NjdXJyZWQgd2hlbiBzYXZpbmcgZGF0YS4gUGxlYXNlIGNvbnRhY3QgeW91ciBTZXJ2aWNlTWF4IGFkbWluaXN0cmF0b3IgdG8gcmVzb2x2ZSB0aGlzLic7DQoJTXNnTGlzdFsnTVNHMDAyJ10gPSAnQW4gaW50ZXJuYWwgZXJyb3Igb2NjdXJyZWQgd2hlbiByZXRyaWV2aW5nIGRhdGEuIFBsZWFzZSBjb250YWN0IHlvdXIgU2VydmljZU1heCBhZG1pbmlzdHJhdG9yIHRvIHJlc29sdmUgdGhpcy4nOw0KCU1zZ0xpc3RbJ01TRzAwMyddID0gJ1lvdSBoYXZlIG5vdCBlbnRlcmVkIGVub3VnaCBpbmZvcm1hdGlvbiB0byBwZXJmb3JtIGVudGl0bGVtZW50IGNoZWNrLic7DQoJTXNnTGlzdFsnTVNHMDA0J10gPSAnTm8gcHJvZHVjdCBpbmZvcm1hdGlvbiBoYXMgYmVlbiBlbnRlcmVkIHRvIHNhdmUuJzsNCglNc2dMaXN0WydNU0cwMDUnXSA9ICdUaGlzIGlzIG5vdCBhIHZhbGlkIHByb2R1Y3QuIFVzZSB0aGUgbG9va3VwIHRvIHNlbGVjdCBhIHZhbGlkIHByb2R1Y3QuJzsNCglNc2dMaXN0WydNU0cwMDYnXSA9ICdUaGlzIGlzIG5vdCBhIHZhbGlkIHNlcmlhbCBudW1iZXIuIFVzZSB0aGUgbG9va3VwIHRvIHNlbGVjdCBhIHZhbGlkIHNlcmlhbCBudW1iZXIuJzsNCglNc2dMaXN0WydNU0cwMDcnXSA9ICdObyBlbnRpdGxlbWVudCByZWNvcmRzIGF2YWlsYWJsZS4gUGxlYXNlIHBlcmZvcm0gZW50aXRsZW1lbnQgY2hlY2sgZmlyc3QuJzsNCglNc2dMaXN0WydNU0cwMDgnXSA9ICdQbGVhc2Ugc2VsZWN0IGFuIGVudGl0bGVtZW50IHJlY29yZCBmcm9tIHRoZSBsaXN0IGZpcnN0Lic7DQoJTXNnTGlzdFsnTVNHMDA5J10gPSAnTm8gYWN0aXZlIHdhcnJhbnRpZXMgb3Igc2VydmljZSBjb250cmFjdHMgZm91bmQuJzsNCglNc2dMaXN0WydMQUIwMDEnXSA9ICdDaGVjayBFbnRpdGxlbWVudCc7DQoJTXNnTGlzdFsnTEFCMDAyJ10gPSAnU2F2ZSBFbnRpdGxlbWVudCc7DQoJTXNnTGlzdFsnTEFCMDAzJ10gPSAnU2F2ZSBQcm9kdWN0JzsNCglNc2dMaXN0WydMQUIwMDQnXSA9ICdDb25maWd1cmF0aW9uJzsNCglNc2dMaXN0WydMQUIwMDUnXSA9ICdJbmNsdWRlJzsNCglNc2dMaXN0WydMQUIwMDYnXSA9ICdFeHBpcmVkIEVudGl0bGVtZW50cyc7DQoJTXNnTGlzdFsnTEFCMDA3J10gPSAnRnV0dXJlIEVudGl0bGVtZW50cyc7DQoJTXNnTGlzdFsnTEFCMDA4J10gPSAnUHJvZHVjdCc7DQoJTXNnTGlzdFsnTEFCMDA5J10gPSAnU2VyaWFsL0xvdCBOdW1iZXInOw0KCU1zZ0xpc3RbJ0xBQjAxMCddID0gJ1RvcC1MZXZlbCc7DQoJTXNnTGlzdFsnTEFCMDExJ10gPSAnU2VyaWFsL0xvdCBOdW1iZXInOw0KCU1zZ0xpc3RbJ0xBQjAxMiddID0gJ0VudGl0bGVtZW50IE5vdGVzJzsNCglNc2dMaXN0WydMQUIwMTMnXSA9ICdEYXRlIG9mIEVudGl0bGVtZW50JzsNCglNc2dMaXN0WydMQUIwMTQnXSA9ICdXYXJyYW50eSc7DQoJTXNnTGlzdFsnTEFCMDE1J10gPSAnU2VydmljZSBDb250cmFjdCc7DQoJTXNnTGlzdFsnTEFCMDE2J10gPSAnU2VsZWN0JzsNCglNc2dMaXN0WydMQUIwMTcnXSA9ICdXYXJyYW50eS9TZXJ2aWNlIENvbnRyYWN0JzsNCglNc2dMaXN0WydMQUIwMTgnXSA9ICdDb3ZlcmFnZSBEZXRhaWxzJzsNCglNc2dMaXN0WydMQUIwMTknXSA9ICdTZXJ2aWNlIExldmVsJzsNCglNc2dMaXN0WydMQUIwMjAnXSA9ICdSZW5ld2FsIE51bWJlcic7DQoJTXNnTGlzdFsnTEFCMDIxJ10gPSAnUmVuZXdhbCBEYXRlJzsNCglNc2dMaXN0WydMQUIwMjInXSA9ICdTdGFydCBEYXRlJzsNCglNc2dMaXN0WydMQUIwMjMnXSA9ICdFbmQgRGF0ZSc7DQoJTXNnTGlzdFsnTEFCMDI0J10gPSAnQ292ZXJhZ2UgYnknOw0KCU1zZ0xpc3RbJ0xBQjAyNSddID0gJ1NlcnZpY2UgTGV2ZWwgRGVzY3JpcHRpb24nOw0KCU1zZ0xpc3RbJ0xBQjAyNiddID0gJ1NlcnZpY2UgQ29udHJhY3QgTm90ZXMnOw0KCU1zZ0xpc3RbJ0xBQjAyNyddID0gJ1NlcnZpY2VzIENvdmVyZWQnOw0KCU1zZ0xpc3RbJ0xBQjAyOCddID0gJ0NvbnRhY3RzIENvdmVyZWQnOw0KCU1zZ0xpc3RbJ0xBQjAyOSddID0gJ1NpdGVzIENvdmVyZWQnOw0KCU1zZ0xpc3RbJ0xBQjAzMCddID0gJ0ludm9pY2UgUmVxdWlyZWQnOw0KCU1zZ0xpc3RbJ0xBQjAzMSddID0gJ0xvYW5kZXIgUHJvdmlkZWQnOw0KCU1zZ0xpc3RbJ0xBQjAzMiddID0gJ09uc2l0ZSBSZXBhaXInOw0KCU1zZ0xpc3RbJ0xBQjAzMyddID0gJ1dhbGstaW4gQWxsb3dlZCc7DQoJTXNnTGlzdFsnTEFCMDM0J10gPSAnU2hpcG1lbnQgQWxsb3dlZCc7DQoJTXNnTGlzdFsnTEFCMDM1J10gPSAnUk1BIFJlcXVpcmVkJzsNCglNc2dMaXN0WydMQUIwMzYnXSA9ICdUcmFuc2ZlcmFibGUnOw0KCU1zZ0xpc3RbJ0xBQjAzNyddID0gJ0V4Y2x1c2lvbnMnOw0KCU1zZ0xpc3RbJ0xBQjAzOCddID0gJ0NsZWFyIFNlbGVjdGlvbic7DQoJfQ0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KLy8gR2V0IHRoZSBtZXNzYWdlIGZvciB0aGUgZ2l2ZW4gbWVzc2FnZSBudW1iZXIgZnJvbSB0aGUgZ2xvYmFsIGhhc2ggdGFibGUuDQovLyBSZXR1cm4gInNldHVwLWlzc3VlIiBpZiB0aGUgbWVzc2FnZSBpcyBub3QgZm91bmQNCmZ1bmN0aW9uIFNWTVhDX0dldE1lc3NhZ2UoTXNnTnVtKQ0Kew0KICAgIGlmICghTXNnTGlzdFtNc2dOdW1dKQ0KICAgIAlyZXR1cm4gIk1lc3NhZ2UgZGVmaW5pdGlvbiBmb3IgIiArIE1zZ051bSArICIgbm90IGZvdW5kLiBUaGlzIGlzIGEgc2V0dXAgaXNzdWUuXG5QbGVhc2UgY29udGFjdCB5b3VyIFNlcnZpY2VNYXggYWRtaW5pc3RyYXRvciB0byByZXNvbHZlIHRoaXMuIjsNCg0KICAgIHJldHVybiBNc2dMaXN0W01zZ051bV07DQp9DQovKj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovDQpmdW5jdGlvbiBjcmVhdGVUYWcocGFyZW50LCBuYW1lLCBrZXl2YWxQYWlycykNCnsNCiAgICB2YXIgcmV0Ow0KICAgIHZhciBicm93c2VyID0gbmF2aWdhdG9yLmFwcE5hbWU7DQogICAgaWYgKGJyb3dzZXIgPT0gIk1pY3Jvc29mdCBJbnRlcm5ldCBFeHBsb3JlciIpIHsNCgkgICAgdmFyIHRyVGFnID0gIjwiK25hbWUrIiAiOw0KCSAgICBmb3IgKGtleSBpbiBrZXl2YWxQYWlycykgew0KCQkJICAgIHRyVGFnICs9IGtleSArICI9XCIiICsga2V5dmFsUGFpcnNba2V5XSArICJcIiI7DQoJICAgIH0NCgkgICAgdHJUYWcgKz0gIj4iOw0KCSAgICByZXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRyVGFnKTsNCiAgICB9IGVsc2Ugew0KCSAgICByZXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KG5hbWUpOw0KCSAgICBmb3IgKGtleSBpbiBrZXl2YWxQYWlycykgew0KCQkgICAgcmV0LnNldEF0dHJpYnV0ZShrZXksIGtleXZhbFBhaXJzW2tleV0pOw0KCSAgICB9DQogICAgfQ0KICAgIHBhcmVudC5hcHBlbmRDaGlsZChyZXQpOw0KICAgIHJldHVybiByZXQ7DQp9DQovKj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KZnVuY3Rpb24gZHJhd01zZyh0YSxtc2cpDQp7DQogICAgaWYgKCF0YSkgdGEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGlzdF90Ym9keSIpOw0KICAgIGNsZWFyX3RhYmxlKCB0YSApOw0KICAgIHZhciB0ciA9IG1ha2VSb3coeydjbGFzcyc6J2hlYWRlclJvdyd9KTt0YS5hcHBlbmRDaGlsZCh0cik7DQogICAgY3JlYXRlVGFnKHRyLCJ0aCIseydjbGFzcyc6J2FjdGlvbkNvbHVtbicsJ3Njb3BlJzonY29sJ30pLmlubmVySFRNTCA9IG1zZzsNCn0NCi8qPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovDQpmdW5jdGlvbiBjbGVhcl90YWJsZSh0Ym9keSkNCnsNCiAgICBpZiAoIXRib2R5KSB0Ym9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsaXN0X3Rib2R5Iik7DQogICAgd2hpbGUgKHRib2R5LnJvd3MubGVuZ3RoID4gMCkgCXsgdGJvZHkuZGVsZXRlUm93KDApOyB9DQp9DQovKj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KZnVuY3Rpb24gbWFrZUF0dHJzKGksdGEpDQp7DQogICAgdmFyIGF0dHMgPSBuZXcgT2JqZWN0KCk7DQogICAgLy8gaG93IG1hbnkgcm93cyBpbiB0aGlzIHRhYmxlIHNvIGZhcg0KICAgIHRyeSB7IHRhLmV2ZW4gfSBjYXRjaCAoZSkgeyB0YS5ldmVuID0gaX07DQogICAgaWYgKGk9PTApIHsgLy8gc2tpbiBzdHVmZg0KCSAgICBhdHRzWyJjbGFzcyJdID0gImV2ZW4gZmlyc3QiOw0KICAgIH0gZWxzZSBpZiAodGEuZXZlbiA9PSB0cnVlKSB7DQoJICAgIGF0dHNbImNsYXNzIl0gPSAiZXZlbiI7DQogICAgfSBlbHNlIHsNCgkgICAgYXR0c1siY2xhc3MiXSA9ICJvZGQiOw0KICAgIH0NCiAgICB0YS5ldmVuID0gIXRhLmV2ZW47DQogICAgYXR0c1sib25tb3VzZW91dCJdID0gImlmICh0eXBlb2YoaGlPZmYpICE9ICd1bmRlZmluZWQnICYmIHRoaXMuYWN0aXZlID09IGZhbHNlKXtoaU9mZih0aGlzKTt9IjsNCiAgICBhdHRzWyJvbm1vdXNlb3ZlciJdID0gImlmICh0eXBlb2YoaGlPbikgIT0gJ3VuZGVmaW5lZCcpe2hpT24odGhpcyk7fSI7DQogICAgcmV0dXJuIGF0dHM7DQp9DQovKj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KZnVuY3Rpb24gbWFrZVJvdyhhdHRzKQ0Kew0KICAgIHZhciBicm93c2VyID0gbmF2aWdhdG9yLmFwcE5hbWU7DQogICAgaWYgKGJyb3dzZXIgPT0gIk1pY3Jvc29mdCBJbnRlcm5ldCBFeHBsb3JlciIpIHsNCgkgICAgdmFyIHRyVGFnID0gIjxUUiAiOw0KCSAgICBmb3IgKGtleSBpbiBhdHRzKSB7DQoJCSAgICB0clRhZyArPSBrZXkgKyAiPVwiIiArIGF0dHNba2V5XSArICJcIiI7DQoJICAgIH0NCgkgICAgdHJUYWcgKz0gIj4iOw0KCSAgICB2YXIgcmV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0clRhZyk7DQogICAgfSBlbHNlIHsNCgkgICAgdmFyIHRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiVFIiKTsNCgkgICAgZm9yIChrZXkgaW4gYXR0cykgew0KCQkgICAgdHIuc2V0QXR0cmlidXRlKGtleSwgYXR0c1trZXldKTsNCgkgICAgfQ0KCSAgICB2YXIgcmV0ID0gdHI7DQogICAgfQ0KICAgIHJldC5hY3RpdmUgPSBmYWxzZTsNCiAgICByZXR1cm4gcmV0Ow0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8NCg0KdmFyIGZvbGRlcnNUcmVlOw0KDQovL1RvIGN1c3RvbWl6ZSB0aGUgdHJlZSwgb3ZlcndyaXRlIHRoZXNlIHZhcmlhYmxlcyBpbiB0aGUgY29uZmlndXJhdGlvbiBmaWxlIChkZW1vRnJhbWVzZXROb2RlLmpzLCBldGMuKQ0KdmFyIFVTRVRFWFRMSU5LUyA9IDE7DQp2YXIgU1RBUlRBTExPUEVOID0gMTsNCnZhciBVU0VGUkFNRVMgPSAwOw0KdmFyIFVTRUlDT05TID0gMDsNCnZhciBXUkFQVEVYVCA9IDE7DQp2YXIgUEVSU0VSVkVTVEFURSA9IDA7IC8vYmFja3dhcmQgY29tcGF0aWJpbGl0eQ0KdmFyIFBSRVNFUlZFU1RBVEUgPSAwOw0KdmFyIElDT05QQVRIID0gcGFyZW50LndpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCArICIvLyIgKyBwYXJlbnQud2luZG93LmxvY2F0aW9uLmhvc3QgKyAiL2ltZy90cmVlLyI7DQp2YXIgSElHSExJR0hUID0gMDsNCnZhciBISUdITElHSFRfQ09MT1IgPSAnYmx1ZSc7DQp2YXIgSElHSExJR0hUX0JHICAgID0gJ3doaXRlJzsNCnZhciBCVUlMREFMTCA9IDA7DQp2YXIgR0xPQkFMVEFSR0VUID0gIlIiOyAvLyB2YXJpYWJsZSBvbmx5IGFwcGxpY2FibGUgZm9yIGFkZENoaWxkcmVuIHVzZXMNCg0KDQovL090aGVyIHZhcmlhYmxlcw0KdmFyIGxhc3RDbGlja2VkID0gbnVsbDsNCnZhciBsYXN0Q2xpY2tlZENvbG9yOw0KdmFyIGxhc3RDbGlja2VkQmdDb2xvcjsNCnZhciBpbmRleE9mRW50cmllcyA9IG5ldyBBcnJheSANCnZhciBuRW50cmllcyA9IDAgDQp2YXIgYnJvd3NlclZlcnNpb24gPSAxIA0KdmFyIHNlbGVjdGVkRm9sZGVyPTANCnZhciBsYXN0T3BlbmVkRm9sZGVyPW51bGwNCnZhciB0PTUNCnZhciBkb2MgPSBkb2N1bWVudA0KdmFyIHN1cHBvcnRzRGVmZXJyYWwgPSBmYWxzZQ0KDQpkb2MueVBvcyA9IDANCg0KaWYodHlwZW9mIEhUTUxFbGVtZW50IT0idW5kZWZpbmVkIiAmJiAhSFRNTEVsZW1lbnQucHJvdG90eXBlLmluc2VydEFkamFjZW50RWxlbWVudCl7DQoJSFRNTEVsZW1lbnQucHJvdG90eXBlLmluc2VydEFkamFjZW50RWxlbWVudCA9IGZ1bmN0aW9uICh3aGVyZSxwYXJzZWROb2RlKQ0KCXsNCgkJc3dpdGNoICh3aGVyZSl7DQoJCWNhc2UgJ0JlZm9yZUJlZ2luJzoNCgkJCXRoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUocGFyc2VkTm9kZSx0aGlzKQ0KCQkJYnJlYWs7DQoJCWNhc2UgJ0FmdGVyQmVnaW4nOg0KCQkJdGhpcy5pbnNlcnRCZWZvcmUocGFyc2VkTm9kZSx0aGlzLmZpcnN0Q2hpbGQpOw0KCQkJYnJlYWs7DQoJCWNhc2UgJ0JlZm9yZUVuZCc6DQoJCQl0aGlzLmFwcGVuZENoaWxkKHBhcnNlZE5vZGUpOw0KCQkJYnJlYWs7DQoJCWNhc2UgJ0FmdGVyRW5kJzoNCgkJCWlmICh0aGlzLm5leHRTaWJsaW5nKSANCgkJCQl0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHBhcnNlZE5vZGUsdGhpcy5uZXh0U2libGluZyk7DQoJCQllbHNlIHRoaXMucGFyZW50Tm9kZS5hcHBlbmRDaGlsZChwYXJzZWROb2RlKTsNCgkJCWJyZWFrOw0KCQl9DQoJfQ0KDQoJSFRNTEVsZW1lbnQucHJvdG90eXBlLmluc2VydEFkamFjZW50SFRNTCA9IGZ1bmN0aW9uKHdoZXJlLGh0bWxTdHIpDQoJew0KCQl2YXIgciA9IHRoaXMub3duZXJEb2N1bWVudC5jcmVhdGVSYW5nZSgpOw0KCQlyLnNldFN0YXJ0QmVmb3JlKHRoaXMpOw0KCQl2YXIgcGFyc2VkSFRNTCA9IHIuY3JlYXRlQ29udGV4dHVhbEZyYWdtZW50KGh0bWxTdHIpOw0KCQl0aGlzLmluc2VydEFkamFjZW50RWxlbWVudCh3aGVyZSxwYXJzZWRIVE1MKQ0KCX0NCn0NCg0KZnVuY3Rpb24geGJEZXRlY3RCcm93c2VyKCkNCnsNCiAgdmFyIG9sZE9uRXJyb3IgPSB3aW5kb3cub25lcnJvcjsNCiAgdmFyIGVsZW1lbnQgPSBudWxsOw0KDQogIHdpbmRvdy5vbmVycm9yID0gbnVsbDsNCiAgDQogIC8vIHdvcmsgYXJvdW5kIGJ1ZyBpbiB4cGNkb20gTW96aWxsYSAwLjkuMQ0KICB3aW5kb3cuc2F2ZU5hdmlnYXRvciA9IHdpbmRvdy5uYXZpZ2F0b3I7DQoNCiAgbmF2aWdhdG9yLk9TICAgID0gJyc7DQogIG5hdmlnYXRvci52ZXJzaW9uICA9IHBhcnNlRmxvYXQobmF2aWdhdG9yLmFwcFZlcnNpb24pOw0KICBuYXZpZ2F0b3Iub3JnICAgID0gJyc7DQogIG5hdmlnYXRvci5mYW1pbHkgID0gJyc7DQoNCiAgdmFyIHBsYXRmb3JtOw0KICBpZiAodHlwZW9mKHdpbmRvdy5uYXZpZ2F0b3IucGxhdGZvcm0pICE9ICd1bmRlZmluZWQnKQ0KICB7DQogICAgcGxhdGZvcm0gPSB3aW5kb3cubmF2aWdhdG9yLnBsYXRmb3JtLnRvTG93ZXJDYXNlKCk7DQogICAgaWYgKHBsYXRmb3JtLmluZGV4T2YoJ3dpbicpICE9IC0xKQ0KICAgICAgbmF2aWdhdG9yLk9TID0gJ3dpbic7DQogICAgZWxzZSBpZiAocGxhdGZvcm0uaW5kZXhPZignbWFjJykgIT0gLTEpDQogICAgICBuYXZpZ2F0b3IuT1MgPSAnbWFjJzsNCiAgICBlbHNlIGlmIChwbGF0Zm9ybS5pbmRleE9mKCd1bml4JykgIT0gLTEgfHwgcGxhdGZvcm0uaW5kZXhPZignbGludXgnKSAhPSAtMSB8fCBwbGF0Zm9ybS5pbmRleE9mKCdzdW4nKSAhPSAtMSkNCiAgICAgIG5hdmlnYXRvci5PUyA9ICduaXgnOw0KICB9DQoNCiAgdmFyIGkgPSAwOw0KICB2YXIgdWEgPSB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpOw0KICANCiAgaWYgKHVhLmluZGV4T2YoJ3NhZmFyaScpICE9IC0xKQ0KICB7DQogICAgaSA9IHVhLmluZGV4T2YoJ3NhZmFyaScpOw0KICAgIG5hdmlnYXRvci5mYW1pbHkgPSAnc2FmYXJpJzsNCiAgICBuYXZpZ2F0b3Iub3JnID0gJ3NhZmFyaSc7DQogICAgbmF2aWdhdG9yLnZlcnNpb24gPSBwYXJzZUZsb2F0KCcwJyArIHVhLnN1YnN0cihpKzcpLCAxMCk7DQogIH0NCiAgZWxzZSBpZiAodWEuaW5kZXhPZignb3BlcmEnKSAhPSAtMSkNCiAgew0KICAgIGkgPSB1YS5pbmRleE9mKCdvcGVyYScpOw0KICAgIG5hdmlnYXRvci5mYW1pbHkgID0gJ29wZXJhJzsNCiAgICBuYXZpZ2F0b3Iub3JnICAgID0gJ29wZXJhJzsNCiAgICBuYXZpZ2F0b3IudmVyc2lvbiAgPSBwYXJzZUZsb2F0KCcwJyArIHVhLnN1YnN0cihpKzYpLCAxMCk7DQogIH0NCiAgZWxzZSBpZiAoKGkgPSB1YS5pbmRleE9mKCdtc2llJykpICE9IC0xKQ0KICB7DQogICAgbmF2aWdhdG9yLm9yZyAgICA9ICdtaWNyb3NvZnQnOw0KICAgIG5hdmlnYXRvci52ZXJzaW9uICA9IHBhcnNlRmxvYXQoJzAnICsgdWEuc3Vic3RyKGkrNSksIDEwKTsNCiAgICANCiAgICBpZiAobmF2aWdhdG9yLnZlcnNpb24gPCA0KQ0KICAgICAgbmF2aWdhdG9yLmZhbWlseSA9ICdpZTMnOw0KICAgIGVsc2UNCiAgICAgIG5hdmlnYXRvci5mYW1pbHkgPSAnaWU0Jw0KICB9DQogIGVsc2UgaWYgKHVhLmluZGV4T2YoJ2dlY2tvJykgIT0gLTEpDQogIHsNCiAgICBuYXZpZ2F0b3IuZmFtaWx5ID0gJ2dlY2tvJzsNCiAgICB2YXIgcnZTdGFydCA9IHVhLmluZGV4T2YoJ3J2OicpOw0KICAgIHZhciBydkVuZCAgID0gdWEuaW5kZXhPZignKScsIHJ2U3RhcnQpOw0KICAgIHZhciBydiAgICAgID0gdWEuc3Vic3RyaW5nKHJ2U3RhcnQrMywgcnZFbmQpOw0KICAgIHZhciBydlBhcnRzID0gcnYuc3BsaXQoJy4nKTsNCiAgICB2YXIgcnZWYWx1ZSA9IDA7DQogICAgdmFyIGV4cCAgICAgPSAxOw0KDQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBydlBhcnRzLmxlbmd0aDsgaSsrKQ0KICAgIHsNCiAgICAgIHZhciB2YWwgPSBwYXJzZUludChydlBhcnRzW2ldKTsNCiAgICAgIHJ2VmFsdWUgKz0gdmFsIC8gZXhwOw0KICAgICAgZXhwICo9IDEwMDsNCiAgICB9DQogICAgbmF2aWdhdG9yLnZlcnNpb24gPSBydlZhbHVlOw0KDQogICAgaWYgKHVhLmluZGV4T2YoJ25ldHNjYXBlJykgIT0gLTEpDQogICAgICBuYXZpZ2F0b3Iub3JnID0gJ25ldHNjYXBlJzsNCiAgICBlbHNlIGlmICh1YS5pbmRleE9mKCdjb21wdXNlcnZlJykgIT0gLTEpDQogICAgICBuYXZpZ2F0b3Iub3JnID0gJ2NvbXB1c2VydmUnOw0KICAgIGVsc2UNCiAgICAgIG5hdmlnYXRvci5vcmcgPSAnbW96aWxsYSc7DQogIH0NCiAgZWxzZSBpZiAoKHVhLmluZGV4T2YoJ21vemlsbGEnKSAhPS0xKSAmJiAodWEuaW5kZXhPZignc3Bvb2ZlcicpPT0tMSkgJiYgKHVhLmluZGV4T2YoJ2NvbXBhdGlibGUnKSA9PSAtMSkgJiYgKHVhLmluZGV4T2YoJ29wZXJhJyk9PS0xKSYmICh1YS5pbmRleE9mKCd3ZWJ0dicpPT0tMSkgJiYgKHVhLmluZGV4T2YoJ2hvdGphdmEnKT09LTEpKQ0KICB7DQogICAgdmFyIGlzX21ham9yID0gcGFyc2VGbG9hdChuYXZpZ2F0b3IuYXBwVmVyc2lvbik7DQogICAgDQogICAgaWYgKGlzX21ham9yIDwgNCkNCiAgICAgIG5hdmlnYXRvci52ZXJzaW9uID0gaXNfbWFqb3I7DQogICAgZWxzZQ0KICAgIHsNCiAgICAgIGkgPSB1YS5sYXN0SW5kZXhPZignLycpDQogICAgICBuYXZpZ2F0b3IudmVyc2lvbiA9IHBhcnNlRmxvYXQoJzAnICsgdWEuc3Vic3RyKGkrMSksIDEwKTsNCiAgICB9DQogICAgbmF2aWdhdG9yLm9yZyA9ICduZXRzY2FwZSc7DQogICAgbmF2aWdhdG9yLmZhbWlseSA9ICdubicgKyBwYXJzZUludChuYXZpZ2F0b3IuYXBwVmVyc2lvbik7DQogIH0NCiAgZWxzZSBpZiAoKGkgPSB1YS5pbmRleE9mKCdhb2wnKSkgIT0gLTEgKQ0KICB7DQogICAgLy8gYW9sDQogICAgbmF2aWdhdG9yLmZhbWlseSAgPSAnYW9sJzsNCiAgICBuYXZpZ2F0b3Iub3JnICAgID0gJ2FvbCc7DQogICAgbmF2aWdhdG9yLnZlcnNpb24gID0gcGFyc2VGbG9hdCgnMCcgKyB1YS5zdWJzdHIoaSs0KSwgMTApOw0KICB9DQogIGVsc2UgaWYgKChpID0gdWEuaW5kZXhPZignaG90amF2YScpKSAhPSAtMSApDQogIHsNCiAgICAvLyBob3RqYXZhDQogICAgbmF2aWdhdG9yLmZhbWlseSAgPSAnaG90amF2YSc7DQogICAgbmF2aWdhdG9yLm9yZyAgICA9ICdzdW4nOw0KICAgIG5hdmlnYXRvci52ZXJzaW9uICA9IHBhcnNlRmxvYXQobmF2aWdhdG9yLmFwcFZlcnNpb24pOw0KICB9DQoNCiAgd2luZG93Lm9uZXJyb3IgPSBvbGRPbkVycm9yOw0KfQ0KDQovLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiANCmZ1bmN0aW9uIEZvbGRlcihmb2xkZXJEZXNjcmlwdGlvbiwgaHJlZmVyZW5jZSkgLy9jb25zdHJ1Y3RvciANCnsgDQogIC8vY29uc3RhbnQgZGF0YSANCiAgdGhpcy5kZXNjID0gZm9sZGVyRGVzY3JpcHRpb247IA0KICB0aGlzLmhyZWZlcmVuY2UgPSBocmVmZXJlbmNlOw0KICB0aGlzLmlkID0gLTE7DQogIHRoaXMubmF2T2JqID0gMDsNCiAgdGhpcy5pY29uSW1nID0gMDsgDQogIHRoaXMubm9kZUltZyA9IDA7DQogIHRoaXMuaWNvblNyYyA9IElDT05QQVRIICsgImZ0djJmb2xkZXJvcGVuLmdpZiI7DQogIHRoaXMuaWNvblNyY0Nsb3NlZCA9IElDT05QQVRIICsgImZ0djJmb2xkZXJjbG9zZWQuZ2lmIjsNCiAgdGhpcy5jaGlsZHJlbiA9IG5ldyBBcnJheTsNCiAgdGhpcy5uQ2hpbGRyZW4gPSAwOw0KICB0aGlzLmxldmVsID0gMDsNCiAgdGhpcy5sZWZ0U2lkZUNvZGVkID0gIiI7DQogIHRoaXMuaXNMYXN0Tm9kZT1mYWxzZTsNCiAgdGhpcy5wYXJlbnRPYmogPSBudWxsOw0KICB0aGlzLm1heVNlbGVjdD10cnVlOw0KICB0aGlzLnByZXBlbmRIVE1MID0gIiINCiANCiAgLy9keW5hbWljIGRhdGEgDQogIHRoaXMuaXNPcGVuID0gZmFsc2UNCiAgdGhpcy5pc0xhc3RPcGVuZWRGb2xkZXIgPSBmYWxzZQ0KICB0aGlzLmlzUmVuZGVyZWQgPSAwDQogDQogIC8vbWV0aG9kcyANCiAgdGhpcy5pbml0aWFsaXplID0gaW5pdGlhbGl6ZUZvbGRlciANCiAgdGhpcy5zZXRTdGF0ZSA9IHNldFN0YXRlRm9sZGVyIA0KICB0aGlzLmFkZENoaWxkID0gYWRkQ2hpbGQgDQogIHRoaXMuYWRkQ2hpbGRyZW4gPSBhZGRDaGlsZHJlbg0KICB0aGlzLmNyZWF0ZUluZGV4ID0gY3JlYXRlRW50cnlJbmRleCANCiAgdGhpcy5lc2NvbmRlQmxvY2sgPSBlc2NvbmRlQmxvY2sNCiAgdGhpcy5lc2NvbmRlID0gZXNjb25kZUZvbGRlciANCiAgdGhpcy5mb2xkZXJNc3RyID0gZm9sZGVyTXN0ciANCiAgdGhpcy5yZW5kZXJPYiA9IGRyYXdGb2xkZXIgDQogIHRoaXMudG90YWxIZWlnaHQgPSB0b3RhbEhlaWdodCANCiAgdGhpcy5zdWJFbnRyaWVzID0gZm9sZGVyU3ViRW50cmllcyANCiAgdGhpcy5saW5rSFRNTCA9IGxpbmtGb2xkZXJIVE1MDQogIHRoaXMuYmxvY2tTdGFydEhUTUwgPSBibG9ja1N0YXJ0SFRNTA0KICB0aGlzLmJsb2NrRW5kSFRNTCA9IGJsb2NrRW5kSFRNTA0KICB0aGlzLm5vZGVJbWFnZVNyYyA9IG5vZGVJbWFnZVNyYw0KICB0aGlzLmljb25JbWFnZVNyYyA9IGljb25JbWFnZVNyYw0KICB0aGlzLmdldElEID0gZ2V0SUQNCiAgdGhpcy5mb3JjZU9wZW5pbmdPZkFuY2VzdG9yRm9sZGVycyA9IGZvcmNlT3BlbmluZ09mQW5jZXN0b3JGb2xkZXJzDQp9IA0KIA0KZnVuY3Rpb24gaW5pdGlhbGl6ZUZvbGRlcihsZXZlbCwgbGFzdE5vZGUsIGxlZnRTaWRlKSANCnsgDQogIHZhciBpPTAgICAgICAgDQogIG5jID0gdGhpcy5uQ2hpbGRyZW4gDQogICANCiAgdGhpcy5jcmVhdGVJbmRleCgpIA0KICB0aGlzLmxldmVsID0gbGV2ZWwNCiAgdGhpcy5sZWZ0U2lkZUNvZGVkID0gbGVmdFNpZGUNCg0KICBpZiAoYnJvd3NlclZlcnNpb24gPT0gMCB8fCBTVEFSVEFMTE9QRU49PTEpDQogICAgdGhpcy5pc09wZW49dHJ1ZTsNCg0KICBpZiAobGV2ZWw+MCkNCiAgICBpZiAobGFzdE5vZGUpIC8vdGhlIGxhc3QgY2hpbGQgaW4gdGhlIGNoaWxkcmVuIGFycmF5IA0KCQlsZWZ0U2lkZSA9IGxlZnRTaWRlICsgIjAiDQoJZWxzZQ0KCQlsZWZ0U2lkZSA9IGxlZnRTaWRlICsgIjEiDQoNCiAgdGhpcy5pc0xhc3ROb2RlID0gbGFzdE5vZGUNCiANCiAgaWYgKG5jID4gMCkgDQogIHsgDQogICAgbGV2ZWwgPSBsZXZlbCArIDEgDQogICAgZm9yIChpPTAgOyBpIDwgdGhpcy5uQ2hpbGRyZW47IGkrKykgIA0KICAgIHsNCiAgICAgIGlmICh0eXBlb2YgdGhpcy5jaGlsZHJlbltpXS5pbml0aWFsaXplID09ICd1bmRlZmluZWQnKSAvL2RvY3VtZW50IG5vZGUgd2FzIHNwZWNpZmllZCB1c2luZyB0aGUgYWRkQ2hpbGRyZW4gZnVuY3Rpb24NCiAgICAgIHsNCiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmNoaWxkcmVuW2ldWzBdID09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiB0aGlzLmNoaWxkcmVuW2ldID09ICdzdHJpbmcnKQ0KICAgICAgICB7DQogICAgICAgICAgdGhpcy5jaGlsZHJlbltpXSA9IFsiaXRlbSBpbmNvcnJlY3RseSBkZWZpbmVkIiwgIiJdOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9CYXNpYyBpbml0aWFsaXphdGlvbiBvZiB0aGUgSXRlbSBvYmplY3QNCiAgICAgICAgLy9UaGVzZSBtZW1iZXJzIG9yIG1ldGhvZHMgYXJlIG5lZWRlZCBldmVuIGJlZm9yZSB0aGUgSXRlbSBpcyByZW5kZXJlZA0KICAgICAgICB0aGlzLmNoaWxkcmVuW2ldLmluaXRpYWxpemU9aW5pdGlhbGl6ZUl0ZW07DQogICAgICAgIHRoaXMuY2hpbGRyZW5baV0uY3JlYXRlSW5kZXg9Y3JlYXRlRW50cnlJbmRleDsNCiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmNoaWxkcmVuW2ldLm1heVNlbGVjdCA9PSAndW5kZWZpbmVkJykNCiAgICAgICAgICB0aGlzLmNoaWxkcmVuW2ldLm1heVNlbGVjdD10cnVlDQogICAgICAgIHRoaXMuY2hpbGRyZW5baV0uZm9yY2VPcGVuaW5nT2ZBbmNlc3RvckZvbGRlcnMgPSBmb3JjZU9wZW5pbmdPZkFuY2VzdG9yRm9sZGVycw0KICAgICAgfQ0KICAgICAgaWYgKGkgPT0gdGhpcy5uQ2hpbGRyZW4tMSkgDQogICAgICAgIHRoaXMuY2hpbGRyZW5baV0uaW5pdGlhbGl6ZShsZXZlbCwgMSwgbGVmdFNpZGUpDQogICAgICBlbHNlIA0KICAgICAgICB0aGlzLmNoaWxkcmVuW2ldLmluaXRpYWxpemUobGV2ZWwsIDAsIGxlZnRTaWRlKQ0KICAgIH0gDQogIH0gDQp9IA0KIA0KZnVuY3Rpb24gZHJhd0ZvbGRlcihpbnNlcnRBdE9iaikgDQp7IA0KICAgIHZhciBub2RlTmFtZSA9ICIiDQogICAgdmFyIGF1eEV2ID0gIiINCiAgICB2YXIgZG9jVyA9ICIiDQogICAgdmFyIGk9MA0KDQogICAgZmluYWxpemVDcmVhdGlvbk9mQ2hpbGREb2NzKHRoaXMpOw0KDQogICAgdmFyIGxlZnRTaWRlID0gbGVmdFNpZGVIVE1MKHRoaXMubGVmdFNpZGVDb2RlZCk7DQoNCiAgICBhdXhFdiA9ICI8YSBocmVmPSdqYXZhc2NyaXB0OmNsaWNrT25Ob2RlKFwiIiArIHRoaXMuZ2V0SUQoKSsgIlwiKSc+IiA7DQoNCiAgICBub2RlTmFtZSA9IHRoaXMubm9kZUltYWdlU3JjKCk7DQogDQogICAgaWYgKHRoaXMubGV2ZWw+MCkgDQoJew0KCWlmICh0aGlzLmlzTGFzdE5vZGUpIC8vdGhlIGxhc3QgY2hpbGQgaW4gdGhlIGNoaWxkcmVuIGFycmF5IA0KCSAgICBsZWZ0U2lkZSA9IGxlZnRTaWRlICsgIjx0ZCB2YWxpZ249dG9wPiIgKyBhdXhFdiArICI8aW1nIG5hbWU9J25vZGVJY29uIiArIHRoaXMuaWQgKyAiJyBpZD0nbm9kZUljb24iICsgdGhpcy5pZCArICInIHNyYz0nIiArIG5vZGVOYW1lICsgIicgd2lkdGg9MjAgaGVpZ2h0PTE2IGJvcmRlcj0wPjwvYT48L3RkPiINCgllbHNlIA0KCSAgICBsZWZ0U2lkZSA9IGxlZnRTaWRlICsgIjx0ZCB2YWxpZ249dG9wIGJhY2tncm91bmQ9IiArIElDT05QQVRIICsgImNoYWluLmdpZj4iICsgYXV4RXYgKyAiPGltZyBuYW1lPSdub2RlSWNvbiIgKyB0aGlzLmlkICsgIicgaWQ9J25vZGVJY29uIiArIHRoaXMuaWQgKyAiJyBzcmM9JyIgKyBub2RlTmFtZSArICInIHdpZHRoPTIwIGhlaWdodD0xNiBib3JkZXI9MD48L2E+PC90ZD4iDQoJfQ0KICAgIHRoaXMuaXNSZW5kZXJlZCA9IDENCg0KICAgIGRvY1cgPSB0aGlzLmJsb2NrU3RhcnRIVE1MKCJmb2xkZXIiKTsNCg0KICAgIGRvY1cgPSBkb2NXICsgIjx0cj4iICsgbGVmdFNpZGUgKyAiPHRkIHZhbGlnbj10b3A+IjsNCiAgICBpZiAoVVNFSUNPTlMpDQoJew0KCWRvY1cgPSBkb2NXICsgdGhpcy5saW5rSFRNTChmYWxzZSkgDQoJZG9jVyA9IGRvY1cgKyAiPGltZyBpZD0nZm9sZGVySWNvbiIgKyB0aGlzLmlkICsgIicgbmFtZT0nZm9sZGVySWNvbiIgKyB0aGlzLmlkICsgIicgc3JjPSciICsgdGhpcy5pY29uSW1hZ2VTcmMoKSArICInIGJvcmRlcj0wPjwvYT4iDQoJfQ0KICAgIGVsc2UNCgl7DQoJaWYgKHRoaXMucHJlcGVuZEhUTUwgPT0gIiIpDQoJICAgIGRvY1cgPSBkb2NXICsgIjxpbWcgc3JjPSIgKyBJQ09OUEFUSCArICJlbXB0eS5naWYgaGVpZ2h0PTE2IHdpZHRoPTIwPiINCgl9DQogICAgZG9jVyA9IGRvY1cgKyAiPC90ZD4iK3RoaXMucHJlcGVuZEhUTUwrIjx0ZCB2YWxpZ249bWlkZGxlIHdpZHRoPTEwMCU+Ig0KDQogICAgaWYgKFVTRVRFWFRMSU5LUykgDQoJeyANCglkb2NXID0gZG9jVyArIHRoaXMubGlua0hUTUwodHJ1ZSkgDQoJZG9jVyA9IGRvY1cgKyB0aGlzLmRlc2MgKyAiPC9hPiINCgl9IA0KICAgIGVsc2UgDQoJZG9jVyA9IGRvY1cgKyB0aGlzLmRlc2MNCg0KICAgIGRvY1cgPSBkb2NXICsgIjwvdGQ+Ig0KICAgIGRvY1cgPSBkb2NXICsgdGhpcy5ibG9ja0VuZEhUTUwoKQ0KDQogICAgaWYgKGluc2VydEF0T2JqID09IG51bGwpDQoJew0KCWlmIChzdXBwb3J0c0RlZmVycmFsKSB7DQoJICAgIGluc2VydEF0T2JqID0gZ2V0RWxCeUlkKCJkb21Sb290IikNCgkgICAgaW5zZXJ0QXRPYmouaW5zZXJ0QWRqYWNlbnRIVE1MKCJCZWZvcmVFbmQiLCBkb2NXKQ0KCSAgICB9DQoJZWxzZQ0KCSAgICB7DQoJICAgIGRvYy53cml0ZShkb2NXKQ0KCSAgICB9DQoJfQ0KICAgIGVsc2UNCgl7DQoJaW5zZXJ0QXRPYmouaW5zZXJ0QWRqYWNlbnRIVE1MKCJBZnRlckVuZCIsIGRvY1cpDQoJfQ0KIA0KICAgIHRoaXMubmF2T2JqID0gZ2V0RWxCeUlkKCJmb2xkZXIiK3RoaXMuaWQpDQoNCiAgICBpZiAoVVNFSUNPTlMpDQogICAgICB0aGlzLmljb25JbWcgPSBnZXRFbEJ5SWQoImZvbGRlckljb24iK3RoaXMuaWQpIA0KDQogICAgdGhpcy5ub2RlSW1nID0gZ2V0RWxCeUlkKCJub2RlSWNvbiIrdGhpcy5pZCkNCn0gDQogDQpmdW5jdGlvbiBzZXRTdGF0ZUZvbGRlcihpc09wZW4pIA0KeyANCiAgdmFyIHN1YkVudHJpZXMgDQogIHZhciB0b3RhbEhlaWdodCANCiAgdmFyIGZJdCA9IDAgDQogIHZhciBpPTAgDQogIHZhciBjdXJyZW50T3Blbg0KIA0KICBpZiAoaXNPcGVuID09IHRoaXMuaXNPcGVuKSANCiAgICByZXR1cm4gDQogDQogIHRoaXMuaXNPcGVuID0gaXNPcGVuOw0KDQogIGlmICghdGhpcy5pc09wZW4gJiYgdGhpcy5pc0xhc3RPcGVuZWRmb2xkZXIpDQogIHsNCglsYXN0T3BlbmVkRm9sZGVyID0gbnVsbDsNCgl0aGlzLmlzTGFzdE9wZW5lZGZvbGRlciA9IGZhbHNlOw0KICB9DQogIHByb3BhZ2F0ZUNoYW5nZXNJblN0YXRlKHRoaXMpIA0KfSANCiANCmZ1bmN0aW9uIHByb3BhZ2F0ZUNoYW5nZXNJblN0YXRlKGZvbGRlcikgDQp7ICAgDQogICAgdmFyIGk9MCANCg0KCS8vQ2hhbmdlIGljb24NCiAgICBpZiAoZm9sZGVyLm5DaGlsZHJlbiA+IDAgJiYgZm9sZGVyLmxldmVsPjApICAvL290aGVyd2lzZSB0aGUgb25lIGdpdmVuIGF0IHJlbmRlciBzdGF5cw0KCWZvbGRlci5ub2RlSW1nLnNyYyA9IGZvbGRlci5ub2RlSW1hZ2VTcmMoKQ0KDQoJLy9DaGFuZ2Ugbm9kZQ0KICAgIGlmIChVU0VJQ09OUykNCglmb2xkZXIuaWNvbkltZy5zcmMgPSBmb2xkZXIuaWNvbkltYWdlU3JjKCkNCg0KCS8vUHJvcGFnYXRlIGNoYW5nZXMNCiAgICBmb3IgKGk9Zm9sZGVyLm5DaGlsZHJlbi0xOyBpPj0wOyBpLS0pDQoJew0KCWlmIChmb2xkZXIuaXNPcGVuKSANCgkgICAgZm9sZGVyLmNoaWxkcmVuW2ldLmZvbGRlck1zdHIoZm9sZGVyLm5hdk9iaikNCgllbHNlIA0KCSAgICBmb2xkZXIuY2hpbGRyZW5baV0uZXNjb25kZSgpIA0KCX0NCn0gDQogDQpmdW5jdGlvbiBlc2NvbmRlRm9sZGVyKCkgDQp7IA0KICB0aGlzLmVzY29uZGVCbG9jaygpDQogICANCiAgdGhpcy5zZXRTdGF0ZSgwKSANCn0gDQogDQpmdW5jdGlvbiBsaW5rRm9sZGVySFRNTChpc1RleHRMaW5rKSANCnsNCiAgICB2YXIgdHh0c3R5bGUgPSAiIjsNCiAgICB2YXIgZG9jVyA9ICIiOw0KDQogICAgaWYgKHRoaXMuaHJlZmVyZW5jZSkgDQoJeyANCglpZiAodGhpcy5ocmVmZXJlbmNlLnN1YnN0cmluZygwLDE2KSA9PSAiLyIgKyBJbnN0UHJvZElkLnN1YnN0cmluZygwLDE1KSkgeyB0eHRzdHlsZSA9ICJzdHlsZT1cJ2NvbG9yOmJsdWU7IGJhY2tncm91bmQtY29sb3I6TGlnaHRCbHVlXCciOyB9DQoNCglpZiAoVVNFRlJBTUVTKQ0KCSAgICBkb2NXID0gZG9jVyArICI8YSAiICsgdHh0c3R5bGUgKyAiIGhyZWY9JyIgKyB0aGlzLmhyZWZlcmVuY2UgKyAiJyBUQVJHRVQ9XCJiYXNlZnJtXCIgIg0KCWVsc2UNCgkgICAgZG9jVyA9IGRvY1cgKyAiPGEgIiArIHR4dHN0eWxlICsgIiBocmVmPSciICsgdGhpcy5ocmVmZXJlbmNlICsgIicgVEFSR0VUPV9ibGFuayAiDQoNCglpZiAoaXNUZXh0TGluaykgew0KCSAgICBkb2NXICs9ICJpZD1cIml0ZW1UZXh0TGluayIrdGhpcy5pZCsiXCIgIjsNCgkgICAgfQ0KDQoJZG9jVyA9IGRvY1cgKyAib25DbGljaz0namF2YXNjcmlwdDpjbGlja09uRm9sZGVyKFwiIit0aGlzLmdldElEKCkrIlwiKSciDQoJZG9jVyA9IGRvY1cgKyAiPiINCgl9IA0KICAgIGVsc2UgDQoJew0KCXR4dHN0eWxlID0gInN0eWxlPVwnY29sb3I6Ymx1ZTsgYmFja2dyb3VuZC1jb2xvcjpMaWdodEJsdWVcJyI7DQoJZG9jVyA9IGRvY1cgKyAiPGEgIiArIHR4dHN0eWxlICsgIj4iIA0KCX0NCg0KICAgIHJldHVybiBkb2NXOw0KfSANCiANCmZ1bmN0aW9uIGFkZENoaWxkKGNoaWxkTm9kZSkgDQp7IA0KICB0aGlzLmNoaWxkcmVuW3RoaXMubkNoaWxkcmVuXSA9IGNoaWxkTm9kZSANCiAgY2hpbGROb2RlLnBhcmVudE9iaiA9IHRoaXMNCiAgdGhpcy5uQ2hpbGRyZW4rKyANCiAgcmV0dXJuIGNoaWxkTm9kZSANCn0gDQoNCi8vVGhlIGxpc3QgY2FuIGNvbnRhaW4gZWl0aGVyIGEgRm9sZGVyIG9iamVjdCBvciBhIHN1YiBsaXN0IHdpdGggdGhlIGFyZ3VtZW50cyBmb3IgSXRlbSANCmZ1bmN0aW9uIGFkZENoaWxkcmVuKGxpc3RPZkNoaWxkcmVuKSANCnsgDQogIHRoaXMuY2hpbGRyZW4gPSBsaXN0T2ZDaGlsZHJlbiANCiAgdGhpcy5uQ2hpbGRyZW4gPSBsaXN0T2ZDaGlsZHJlbi5sZW5ndGgNCiAgZm9yIChpPTA7IGk8dGhpcy5uQ2hpbGRyZW47IGkrKykNCiAgICB0aGlzLmNoaWxkcmVuW2ldLnBhcmVudE9iaiA9IHRoaXMNCn0gDQoNCmZ1bmN0aW9uIGZvbGRlclN1YkVudHJpZXMoKSANCnsgDQogIHZhciBpID0gMCANCiAgdmFyIHNlID0gdGhpcy5uQ2hpbGRyZW4gDQogDQogIGZvciAoaT0wOyBpIDwgdGhpcy5uQ2hpbGRyZW47IGkrKyl7IA0KICAgIGlmICh0aGlzLmNoaWxkcmVuW2ldLmNoaWxkcmVuKSAvL2lzIGEgZm9sZGVyIA0KICAgICAgc2UgPSBzZSArIHRoaXMuY2hpbGRyZW5baV0uc3ViRW50cmllcygpIA0KICB9IA0KIA0KICByZXR1cm4gc2UgDQp9IA0KDQpmdW5jdGlvbiBub2RlSW1hZ2VTcmMoKSB7DQogIHZhciBzcmNTdHIgPSAiIjsNCg0KICBpZiAodGhpcy5pc0xhc3ROb2RlKSAvL3RoZSBsYXN0IGNoaWxkIGluIHRoZSBjaGlsZHJlbiBhcnJheSANCiAgeyANCiAgICBpZiAodGhpcy5uQ2hpbGRyZW4gPT0gMCkNCiAgICAgIHNyY1N0ciA9IElDT05QQVRIICsgIm5vZGVFbmQuZ2lmIg0KICAgIGVsc2UNCiAgICAgIGlmICh0aGlzLmlzT3BlbikNCiAgICAgICAgc3JjU3RyID0gSUNPTlBBVEggKyAibWludXNFbmQuZ2lmIiAgDQogICAgICBlbHNlDQogICAgICAgIHNyY1N0ciA9IElDT05QQVRIICsgInBsdXNFbmQuZ2lmIiAgDQogIH0gDQogIGVsc2UgDQogIHsgDQogICAgaWYgKHRoaXMubkNoaWxkcmVuID09IDApDQogICAgICBzcmNTdHIgPSBJQ09OUEFUSCArICJub2RlLmdpZiINCiAgICBlbHNlDQogICAgICBpZiAodGhpcy5pc09wZW4pDQogICAgICAgIHNyY1N0ciA9IElDT05QQVRIICsgIm1pbnVzLmdpZiINCiAgICAgIGVsc2UNCiAgICAgICAgc3JjU3RyID0gSUNPTlBBVEggKyAicGx1cy5naWYiDQogIH0gICANCiAgcmV0dXJuIHNyY1N0cjsNCn0NCg0KZnVuY3Rpb24gaWNvbkltYWdlU3JjKCkgew0KICBpZiAodGhpcy5pc09wZW4pDQogICAgcmV0dXJuKHRoaXMuaWNvblNyYykNCiAgZWxzZQ0KICAgIHJldHVybih0aGlzLmljb25TcmNDbG9zZWQpDQp9IA0KIA0KZnVuY3Rpb24gSXRlbShpdGVtRGVzY3JpcHRpb24pIC8vIENvbnN0cnVjdG9yIA0KeyANCiAgLy8gY29uc3RhbnQgZGF0YSANCiAgdGhpcy5kZXNjID0gaXRlbURlc2NyaXB0aW9uIA0KDQogIHRoaXMubGV2ZWwgPSAwDQogIHRoaXMuaXNMYXN0Tm9kZSA9IGZhbHNlDQogIHRoaXMubGVmdFNpZGVDb2RlZCA9ICIiDQogIHRoaXMucGFyZW50T2JqID0gbnVsbA0KDQogIHRoaXMubWF5U2VsZWN0PXRydWUNCg0KICB0aGlzLmluaXRpYWxpemUgPSBpbml0aWFsaXplSXRlbTsNCiAgdGhpcy5jcmVhdGVJbmRleCA9IGNyZWF0ZUVudHJ5SW5kZXg7DQogIHRoaXMuZm9yY2VPcGVuaW5nT2ZBbmNlc3RvckZvbGRlcnMgPSBmb3JjZU9wZW5pbmdPZkFuY2VzdG9yRm9sZGVyczsNCg0KICBmaW5hbGl6ZUNyZWF0aW9uT2ZJdGVtKHRoaXMpDQp9IA0KDQovL0Fzc2lnbm1lbnRzIHRoYXQgY2FuIGJlIGRlbGF5ZWQgd2hlbiB0aGUgaXRlbSBpcyBjcmVhdGVkIHdpdGggZm9sZGVyLmFkZENoaWxkcmVuDQovL1RoZSBhc3NpZ25tZW50cyB0aGF0IGNhbm5vdCBiZSBkZWxheWVkIGFyZSBkb25lIGluIGFkZENoaWxkcmVuIGFuZCBpbiBpbml0aWFsaXplRm9sZGVyDQovL0FkZGl0aW9uYWx5LCBzb21lIGFzc2lnbm1lbnRzIGFyZSBhbHNvIGRvbmUgaW4gZmluYWxpemVDcmVhdGlvbk9mQ2hpbGREb2NzIGl0c2VsZg0KZnVuY3Rpb24gZmluYWxpemVDcmVhdGlvbk9mSXRlbShpdGVtQXJyYXkpDQp7DQogIGl0ZW1BcnJheS5uYXZPYmogPSAwIC8vaW5pdGlhbGl6ZWQgaW4gcmVuZGVyKCkgDQogIGl0ZW1BcnJheS5pY29uSW1nID0gMCAvL2luaXRpYWxpemVkIGluIHJlbmRlcigpIA0KICBpdGVtQXJyYXkuaWNvblNyYyA9IElDT05QQVRIICsgImZ0djJkb2MuZ2lmIiANCiAgaXRlbUFycmF5LmlzUmVuZGVyZWQgPSAwDQogIGl0ZW1BcnJheS5uQ2hpbGRyZW4gPSAwDQogIGl0ZW1BcnJheS5wcmVwZW5kSFRNTCA9ICIiDQogDQogIC8vIG1ldGhvZHMgDQogIGl0ZW1BcnJheS5lc2NvbmRlQmxvY2sgPSBlc2NvbmRlQmxvY2sNCiAgaXRlbUFycmF5LmVzY29uZGUgPSBlc2NvbmRlQmxvY2sNCiAgaXRlbUFycmF5LmZvbGRlck1zdHIgPSBmb2xkZXJNc3RyIA0KICBpdGVtQXJyYXkucmVuZGVyT2IgPSBkcmF3SXRlbSANCiAgaXRlbUFycmF5LnRvdGFsSGVpZ2h0ID0gdG90YWxIZWlnaHQgDQogIGl0ZW1BcnJheS5ibG9ja1N0YXJ0SFRNTCA9IGJsb2NrU3RhcnRIVE1MDQogIGl0ZW1BcnJheS5ibG9ja0VuZEhUTUwgPSBibG9ja0VuZEhUTUwNCiAgaXRlbUFycmF5LmdldElEID0gZ2V0SUQNCn0NCg0KZnVuY3Rpb24gaW5pdGlhbGl6ZUl0ZW0obGV2ZWwsIGxhc3ROb2RlLCBsZWZ0U2lkZSkgDQp7ICANCiAgdGhpcy5jcmVhdGVJbmRleCgpIA0KICB0aGlzLmxldmVsID0gbGV2ZWwNCiAgdGhpcy5sZWZ0U2lkZUNvZGVkID0gbGVmdFNpZGUNCiAgdGhpcy5pc0xhc3ROb2RlID0gbGFzdE5vZGUNCn0gDQogDQpmdW5jdGlvbiBkcmF3SXRlbShpbnNlcnRBdE9iaikgDQp7IA0KICAgIHZhciBsZWZ0U2lkZSA9IGxlZnRTaWRlSFRNTCh0aGlzLmxlZnRTaWRlQ29kZWQpOw0KICAgIHZhciBkb2NXID0gIiI7DQoNCiAgICB2YXIgZnVsbExpbmsgPSAiaHJlZj1cIiIrdGhpcy5saW5rKyJcIiB0YXJnZXQ9XCIiKyB0aGlzLnRhcmdldCArICJcIiBvbkNsaWNrPVwiY2xpY2tPbkxpbmsoJyIrdGhpcy5nZXRJRCgpKyJcJywgJyIrdGhpcy5saW5rKyInLCciK3RoaXMudGFyZ2V0KyInKTtyZXR1cm4gZmFsc2U7XCIiOw0KICAgIHRoaXMuaXNSZW5kZXJlZCA9IDENCg0KICAgIGlmICh0aGlzLmxldmVsPjApIA0KICAgIAl7DQoJaWYgKHRoaXMuaXNMYXN0Tm9kZSkgLy90aGUgbGFzdCAnYnJvdGhlcicgaW4gdGhlIGNoaWxkcmVuIGFycmF5IA0KCSAgICB7IA0KCSAgICBsZWZ0U2lkZSA9IGxlZnRTaWRlICsgIjx0ZCB2YWxpZ249dG9wPjxpbWcgc3JjPSciICsgSUNPTlBBVEggKyAibm9kZUVuZC5naWYnIHdpZHRoPTIwIGhlaWdodD0xNj48L3RkPiINCgkgICAgfSANCgllbHNlIA0KCSAgICB7IA0KCSAgICBsZWZ0U2lkZSA9IGxlZnRTaWRlICsgIjx0ZCB2YWxpZ249dG9wIGJhY2tncm91bmQ9IiArIElDT05QQVRIICsgImNoYWluLmdpZj48aW1nIHNyYz0nIiArIElDT05QQVRIICsgIm5vZGUuZ2lmJyB3aWR0aD0yMCBoZWlnaHQ9MTY+PC90ZD4iDQoJICAgIH0gDQoJfQ0KDQogICAgZG9jVyA9IGRvY1cgKyB0aGlzLmJsb2NrU3RhcnRIVE1MKCJpdGVtIikNCg0KICAgIGRvY1cgPSBkb2NXICsgIjx0cj4iICsgbGVmdFNpZGUgKyAiPHRkIHZhbGlnbj10b3A+Ig0KICAgIGlmIChVU0VJQ09OUykNCglkb2NXID0gZG9jVyArICI8YSAiICsgZnVsbExpbmsgKyAiIGlkPVwiaXRlbUljb25MaW5rIit0aGlzLmlkKyJcIj4iICsgIjxpbWcgaWQ9J2l0ZW1JY29uIit0aGlzLmlkKyInICIgKyAic3JjPSciK3RoaXMuaWNvblNyYysiJyBib3JkZXI9MD4iICsgIjwvYT4iDQogICAgZWxzZQ0KCWlmICh0aGlzLnByZXBlbmRIVE1MID09ICIiKQ0KCSAgICBkb2NXID0gZG9jVyArICI8aW1nIHNyYz0iICsgSUNPTlBBVEggKyAiZW1wdHkuZ2lmIGhlaWdodD0xNiB3aWR0aD0yMD4iDQoNCiAgICBkb2NXID0gZG9jVyArICI8L3RkPiIrdGhpcy5wcmVwZW5kSFRNTCsiPHRkIHZhbGlnbj1taWRkbGUgd2lkdGg9MTAwJT4iDQoNCiAgICBpZiAoVVNFVEVYVExJTktTKSANCglkb2NXID0gZG9jVyArICI8YSAiICsgZnVsbExpbmsgKyAiIGlkPVwiaXRlbVRleHRMaW5rIit0aGlzLmlkKyJcIj4iICsgdGhpcy5kZXNjICsgIjwvYT4iDQogICAgZWxzZSANCglkb2NXID0gZG9jVyArIHRoaXMuZGVzYw0KDQogICAgZG9jVyA9IGRvY1cgKyAiPC90ZD4iDQogICAgZG9jVyA9IGRvY1cgKyB0aGlzLmJsb2NrRW5kSFRNTCgpDQoNCiAgICBpZiAoaW5zZXJ0QXRPYmogPT0gbnVsbCkNCgl7DQoJZG9jLndyaXRlKGRvY1cpDQoJfQ0KICAgIGVsc2UNCgl7DQoJaW5zZXJ0QXRPYmouaW5zZXJ0QWRqYWNlbnRIVE1MKCJBZnRlckVuZCIsIGRvY1cpDQoJfQ0KDQogICAgdGhpcy5uYXZPYmogPSBnZXRFbEJ5SWQoIml0ZW0iK3RoaXMuaWQpDQoNCiAgICBpZiAoVVNFSUNPTlMpDQoJdGhpcy5pY29uSW1nID0gZ2V0RWxCeUlkKCJpdGVtSWNvbiIrdGhpcy5pZCkNCn0gDQogDQovLyBNZXRob2RzIGNvbW1vbiB0byBib3RoIG9iamVjdHMgKHBzZXVkby1pbmhlcml0YW5jZSkgDQovLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiANCiANCmZ1bmN0aW9uIGZvcmNlT3BlbmluZ09mQW5jZXN0b3JGb2xkZXJzKCkgew0KICBpZiAodGhpcy5wYXJlbnRPYmogPT0gbnVsbCB8fCB0aGlzLnBhcmVudE9iai5pc09wZW4pDQogICAgcmV0dXJuDQogIGVsc2Ugew0KICAgIHRoaXMucGFyZW50T2JqLmZvcmNlT3BlbmluZ09mQW5jZXN0b3JGb2xkZXJzKCkNCiAgICBjbGlja09uTm9kZU9iaih0aGlzLnBhcmVudE9iaikNCiAgfQ0KfQ0KDQpmdW5jdGlvbiBlc2NvbmRlQmxvY2soKSANCnsgDQogICAgaWYgKHRoaXMubmF2T2JqLnN0eWxlLmRpc3BsYXkgPT0gIm5vbmUiKSANCiAgICAgIHJldHVybiANCiAgICB0aGlzLm5hdk9iai5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiIA0KfSANCiANCmZ1bmN0aW9uIGZvbGRlck1zdHIoZG9tT2JqKSANCnsgDQogIGlmICghdGhpcy5pc1JlbmRlcmVkKQ0KICAgICB0aGlzLnJlbmRlck9iKGRvbU9iaikNCiAgZWxzZQ0KICAgIHRoaXMubmF2T2JqLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siIA0KfSANCg0KZnVuY3Rpb24gYmxvY2tTdGFydEhUTUwoaWRwcmVmaXgpIHsNCiAgdmFyIGlkUGFyYW0gPSAiaWQ9JyIgKyBpZHByZWZpeCArIHRoaXMuaWQgKyAiJyINCiAgdmFyIGRvY1cgPSAiIg0KDQogICAgZG9jVyA9ICI8ZGl2ICIgKyBpZFBhcmFtICsgIiBzdHlsZT0nZGlzcGxheTpibG9jazsnPiINCiAgICAgDQogIGRvY1cgPSBkb2NXICsgIjx0YWJsZSBib3JkZXI9MCBjZWxsc3BhY2luZz0wIGNlbGxwYWRkaW5nPTAgd2lkdGg9MTAwJSA+Ig0KDQogIHJldHVybiBkb2NXDQp9DQoNCmZ1bmN0aW9uIGJsb2NrRW5kSFRNTCgpIHsNCiAgdmFyIGRvY1cgPSAiIg0KDQogIGRvY1cgPSAiPC90YWJsZT4iDQogICANCmRvY1cgPSBkb2NXICsgIjwvZGl2PiINCg0KICByZXR1cm4gZG9jVw0KfQ0KIA0KZnVuY3Rpb24gY3JlYXRlRW50cnlJbmRleCgpIA0KeyANCiAgdGhpcy5pZCA9IG5FbnRyaWVzIA0KICBpbmRleE9mRW50cmllc1tuRW50cmllc10gPSB0aGlzIA0KICBuRW50cmllcysrIA0KfSANCiANCi8vIHRvdGFsIGhlaWdodCBvZiBzdWJFbnRyaWVzIG9wZW4gDQpmdW5jdGlvbiB0b3RhbEhlaWdodCgpIC8vdXNlZCB3aXRoIGJyb3dzZXJWZXJzaW9uID09IDIgDQp7IA0KICB2YXIgaCA9IHRoaXMubmF2T2JqLmNsaXAuaGVpZ2h0IA0KICB2YXIgaSA9IDAgDQogICANCiAgaWYgKHRoaXMuaXNPcGVuKSAvL2lzIGEgZm9sZGVyIGFuZCBfaXNfIG9wZW4gDQogICAgZm9yIChpPTAgOyBpIDwgdGhpcy5uQ2hpbGRyZW47IGkrKykgIA0KICAgICAgaCA9IGggKyB0aGlzLmNoaWxkcmVuW2ldLnRvdGFsSGVpZ2h0KCkgDQogDQogIHJldHVybiBoIA0KfSANCg0KDQpmdW5jdGlvbiBsZWZ0U2lkZUhUTUwobGVmdFNpZGVDb2RlZCkgew0KCXZhciBpOw0KCXZhciByZXRTdHIgPSAiIjsNCg0KCWZvciAoaT0wOyBpPGxlZnRTaWRlQ29kZWQubGVuZ3RoOyBpKyspDQoJew0KCQlpZiAobGVmdFNpZGVDb2RlZC5jaGFyQXQoaSkgPT0gIjEiKQ0KCQl7DQoJCQlyZXRTdHIgPSByZXRTdHIgKyAiPHRkIHZhbGlnbj10b3AgYmFja2dyb3VuZD0iICsgSUNPTlBBVEggKyAiY2hhaW4uZ2lmPjxpbWcgc3JjPSciICsgSUNPTlBBVEggKyAiY2hhaW4uZ2lmJyB3aWR0aD0yMCBoZWlnaHQ9MTY+PC90ZD4iDQoJCX0NCgkJaWYgKGxlZnRTaWRlQ29kZWQuY2hhckF0KGkpID09ICIwIikNCgkJew0KCQkJcmV0U3RyID0gcmV0U3RyICsgIjx0ZCB2YWxpZ249dG9wPjxpbWcgc3JjPSciICsgSUNPTlBBVEggKyAiZW1wdHkuZ2lmJyB3aWR0aD0yMCBoZWlnaHQ9MTY+PC90ZD4iDQoJCX0NCgl9DQoJcmV0dXJuIHJldFN0cg0KfQ0KDQpmdW5jdGlvbiBnZXRJRCgpDQp7DQogIC8vZGVmaW5lIGEgLnhJRCBpbiBhbGwgbm9kZXMgKGZvbGRlcnMgYW5kIGl0ZW1zKSBpZiB5b3Ugd2FudCB0byBQRVJWRVNUQVRFIHRoYXQNCiAgLy93b3JrIHdoZW4gdGhlIHRyZWUgY2hhbmdlcy4gVGhlIHZhbHVlIGVYdGVybmFsIHZhbHVlIG11c3QgYmUgdW5pcXVlIGZvciBlYWNoDQogIC8vbm9kZSBhbmQgbXVzdCBub2RlIGNoYW5nZSB3aGVuIG90aGVyIG5vZGVzIGFyZSBhZGRlZCBvciByZW1vdmVkDQogIC8vVGhlIHZhbHVlIG1heSBiZSBudW1lcmljIG9yIHN0cmluZywgYnV0IGNhbm5vdCBoYXZlIHRoZSBzYW1lIGNoYXIgdXNlZCBpbiBjb29raWVDdXR0ZXINCiAgaWYgKHR5cGVvZiB0aGlzLnhJRCAhPSAidW5kZWZpbmVkIikgDQogICAgcmV0dXJuIHRoaXMueElEDQogIGVsc2UNCiAgICByZXR1cm4gdGhpcy5pZA0KfQ0KDQogDQovLyBFdmVudHMgDQovLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogDQogDQpmdW5jdGlvbiBjbGlja09uRm9sZGVyKGZvbGRlcklkKSANCnsgDQogIHZhciBjbGlja2VkID0gZmluZE9iaihmb2xkZXJJZCkNCg0KICBpZiAodHlwZW9mIGNsaWNrZWQ9PSd1bmRlZmluZWQnIHx8IGNsaWNrZWQ9PW51bGwpDQogIHsNCiAgICBhbGVydCgiVHJlZXZpZXcgd2FzIG5vdCBhYmxlIHRvIGZpbmQgdGhlIG5vZGUgb2JqZWN0IGNvcnJlc3BvbmRpbmcgdG8gSUQ9IiArIGZvbGRlcklkICsgIi4gSWYgdGhlIGNvbmZpZ3VyYXRpb24gZmlsZSBzZXRzIGEueElEIHZhbHVlcywgaXQgbXVzdCBzZXQgdGhlbSBmb3IgQUxMIG5vZGVzLCBpbmNsdWRpbmcgdGhlIGZvbGRlcnNUcmVlIHJvb3QuIikNCiAgICByZXR1cm47DQogIH0NCg0KICBpZiAoIWNsaWNrZWQuaXNPcGVuKSB7DQogICAgY2xpY2tPbk5vZGVPYmooY2xpY2tlZCkgDQogIH0NCg0KICBpZiAobGFzdE9wZW5lZEZvbGRlciAhPSBudWxsICYmIGxhc3RPcGVuZWRGb2xkZXIgIT0gZm9sZGVySWQpDQogICAgY2xpY2tPbk5vZGUobGFzdE9wZW5lZEZvbGRlcik7IC8vc2V0cyBsYXN0T3BlbmVkRm9sZGVyIHRvIG51bGwNCg0KICBpZiAoY2xpY2tlZC5uQ2hpbGRyZW49PTApIHsNCiAgICBsYXN0T3BlbmVkRm9sZGVyID0gZm9sZGVySWQ7DQogICAgY2xpY2tlZC5pc0xhc3RPcGVuZWRmb2xkZXIgPSB0cnVlDQogIH0NCg0KICBpZiAoaXNMaW5rZWQoY2xpY2tlZC5ocmVmZXJlbmNlKSkgew0KICAgICAgaGlnaGxpZ2h0T2JqTGluayhjbGlja2VkKTsNCiAgfQ0KfSANCiANCmZ1bmN0aW9uIGNsaWNrT25Ob2RlKGZvbGRlcklkKSANCnsgDQogIGZPYiA9IGZpbmRPYmooZm9sZGVySWQpOw0KICBpZiAodHlwZW9mIGZPYj09J3VuZGVmaW5lZCcgfHwgZk9iPT1udWxsKQ0KICB7DQogICAgYWxlcnQoIlRyZWV2aWV3IHdhcyBub3QgYWJsZSB0byBmaW5kIHRoZSBub2RlIG9iamVjdCBjb3JyZXNwb25kaW5nIHRvIElEPSIgKyBmb2xkZXJJZCArICIuIElmIHRoZSBjb25maWd1cmF0aW9uIGZpbGUgc2V0cyBhLnhJRCwgaXQgbXVzdCBzZXQgZm9sZGVyc1RyZWUueElEIGFzIHdlbGwuIikNCiAgICByZXR1cm47DQogIH0NCg0KICBjbGlja09uTm9kZU9iaihmT2IpOw0KfQ0KDQpmdW5jdGlvbiBjbGlja09uTm9kZU9iaihmb2xkZXJPYmopIA0KeyANCiAgdmFyIHN0YXRlID0gMCANCiAgdmFyIGN1cnJlbnRPcGVuDQogDQogIHN0YXRlID0gZm9sZGVyT2JqLmlzT3BlbiANCiAgZm9sZGVyT2JqLnNldFN0YXRlKCFzdGF0ZSkgLy9vcGVuPC0+Y2xvc2UgIA0KDQogIGlmIChmb2xkZXJPYmouaWQhPWZvbGRlcnNUcmVlLmlkICYmIFBSRVNFUlZFU1RBVEUpDQogIHsNCiAgICBpZiAoIWZvbGRlck9iai5pc09wZW4pIC8vY2xvc2luZw0KICAgIHsNCiAgICAgIGN1cnJlbnRPcGVuID0gY3VycmVudE9wZW4ucmVwbGFjZShmb2xkZXJPYmouZ2V0SUQoKStjb29raWVDdXR0ZXIsICIiKQ0KICAgIH0NCiAgfQ0KfQ0KDQpmdW5jdGlvbiBjbGlja09uTGluayhjbGlja2VkSWQsIHRhcmdldCwgd2luZG93TmFtZSkgew0KICAgIGhpZ2hsaWdodE9iakxpbmsoZmluZE9iaihjbGlja2VkSWQpKTsNCiAgICBpZiAoaXNMaW5rZWQodGFyZ2V0KSkgew0KICAgICAgICB3aW5kb3cub3Blbih0YXJnZXQsd2luZG93TmFtZSk7DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBsZCAgKCkNCnsNCglyZXR1cm4gZG9jdW1lbnQubGlua3MubGVuZ3RoLTENCn0NCiANCg0KLy8gQXV4aWxpYXJ5IEZ1bmN0aW9ucyANCi8vICoqKioqKioqKioqKioqKioqKioNCg0KZnVuY3Rpb24gZmluYWxpemVDcmVhdGlvbk9mQ2hpbGREb2NzKGZvbGRlck9iaikgew0KICBmb3IoaT0wOyBpIDwgZm9sZGVyT2JqLm5DaGlsZHJlbjsgaSsrKSAgew0KICAgIGNoaWxkID0gZm9sZGVyT2JqLmNoaWxkcmVuW2ldDQogICAgaWYgKHR5cGVvZiBjaGlsZFswXSAhPSAndW5kZWZpbmVkJykNCiAgICB7DQogICAgICAvLyBBbWF6aW5nbHksIGFycmF5cyBjYW4gaGF2ZSBtZW1iZXJzLCBzbyAgIGEgPSBbImEiLCAiYiJdOyBhLmRlc2M9ImFzZGFzIiAgIHdvcmtzDQogICAgICAvLyBJZiBhIGRvYyB3YXMgaW5zZXJ0ZWQgYXMgYW4gYXJyYXksIHdlIGNhbiB0cmFuc2Zvcm0gaXQgaW50byBhbiBpdGVtT2JqIGJ5IGFkZGluZyANCiAgICAgIC8vIHRoZSBtaXNzaW5nIG1lbWJlcnMgYW5kIGZ1bmN0aW9ucw0KICAgICAgY2hpbGQuZGVzYyA9IGNoaWxkWzBdIA0KICAgICAgc2V0SXRlbUxpbmsoY2hpbGQsIEdMT0JBTFRBUkdFVCwgY2hpbGRbMV0pICAgDQogICAgICBmaW5hbGl6ZUNyZWF0aW9uT2ZJdGVtKGNoaWxkKQ0KICAgIH0NCiAgfQ0KfQ0KDQpmdW5jdGlvbiBmaW5kT2JqKGlkKQ0Kew0KICB2YXIgaT0wOw0KICB2YXIgbm9kZU9iajsNCg0KICBpZiAodHlwZW9mIGZvbGRlcnNUcmVlLnhJRCAhPSAidW5kZWZpbmVkIikgew0KICAgIG5vZGVPYmogPSBpbmRleE9mRW50cmllc1tpXTsNCiAgICBmb3IoaT0wO2k8bkVudHJpZXMmJmluZGV4T2ZFbnRyaWVzW2ldLnhJRCE9aWQ7aSsrKSAvL21heSBuZWVkIG9wdGltaXphdGlvbg0KICAgICAgOw0KICAgIGlkID0gaQ0KICB9DQogIGlmIChpZCA+PSBuRW50cmllcykNCiAgICByZXR1cm4gbnVsbDsgLy9leGFtcGxlOiBub2RlIHJlbW92ZWQgaW4gREINCiAgZWxzZQ0KICAgIHJldHVybiBpbmRleE9mRW50cmllc1tpZF07DQp9DQoNCmZ1bmN0aW9uIGlzTGlua2VkKGhyZWZUZXh0KSB7DQogICAgdmFyIHJlc3VsdCA9IHRydWU7DQogICAgcmVzdWx0ID0gKHJlc3VsdCAmJiBocmVmVGV4dCAhPW51bGwpOw0KICAgIHJlc3VsdCA9IChyZXN1bHQgJiYgaHJlZlRleHQgIT0gJycpOw0KICAgIHJlc3VsdCA9IChyZXN1bHQgJiYgaHJlZlRleHQuaW5kZXhPZigndW5kZWZpbmVkJykgPCAwKTsNCiAgICByZXN1bHQgPSAocmVzdWx0ICYmIGhyZWZUZXh0LmluZGV4T2YoJ3BhcmVudC5vcCcpIDwgMCk7DQogICAgcmV0dXJuIHJlc3VsdDsNCn0NCg0KLy8gRG8gaGlnaGxpZ2h0aW5nIGJ5IGNoYW5naW5nIGJhY2tncm91bmQgYW5kIGZvcmVnLiBjb2xvcnMgb2YgZm9sZGVyIG9yIGRvYyB0ZXh0DQpmdW5jdGlvbiBoaWdobGlnaHRPYmpMaW5rKG5vZGVPYmopIHsNCiAgaWYgKCFISUdITElHSFQgfHwgbm9kZU9iaj09bnVsbCB8fCBub2RlT2JqLm1heVNlbGVjdD09ZmFsc2UpIHsvL25vZGUgZGVsZXRlZCBpbiBEQiANCiAgICByZXR1cm47DQogIH0NCg0KdmFyIGNsaWNrZWRET01PYmogPSBnZXRFbEJ5SWQoJ2l0ZW1UZXh0TGluaycrbm9kZU9iai5pZCk7DQppZiAoY2xpY2tlZERPTU9iaiAhPSBudWxsKSB7DQogICAgaWYgKGxhc3RDbGlja2VkICE9IG51bGwpIHsNCgl2YXIgcHJldkNsaWNrZWRET01PYmogPSBnZXRFbEJ5SWQoJ2l0ZW1UZXh0TGluaycrbGFzdENsaWNrZWQuaWQpOw0KCXByZXZDbGlja2VkRE9NT2JqLnN0eWxlLmNvbG9yPWxhc3RDbGlja2VkQ29sb3I7DQoJcHJldkNsaWNrZWRET01PYmouc3R5bGUuYmFja2dyb3VuZENvbG9yPWxhc3RDbGlja2VkQmdDb2xvcjsNCiAgICB9DQoNCiAgICBsYXN0Q2xpY2tlZENvbG9yICAgID0gY2xpY2tlZERPTU9iai5zdHlsZS5jb2xvcjsNCiAgICBsYXN0Q2xpY2tlZEJnQ29sb3IgID0gY2xpY2tlZERPTU9iai5zdHlsZS5iYWNrZ3JvdW5kQ29sb3I7DQogICAgY2xpY2tlZERPTU9iai5zdHlsZS5jb2xvcj1ISUdITElHSFRfQ09MT1I7DQogICAgY2xpY2tlZERPTU9iai5zdHlsZS5iYWNrZ3JvdW5kQ29sb3I9SElHSExJR0hUX0JHOw0KfQ0KICBsYXN0Q2xpY2tlZCA9IG5vZGVPYmo7DQp9DQoNCmZ1bmN0aW9uIGluc0ZsZChwYXJlbnRGb2xkZXIsIGNoaWxkRm9sZGVyKSANCnsgDQogIHJldHVybiBwYXJlbnRGb2xkZXIuYWRkQ2hpbGQoY2hpbGRGb2xkZXIpIA0KfSANCiANCmZ1bmN0aW9uIGluc0RvYyhwYXJlbnRGb2xkZXIsIGRvY3VtZW50KSANCnsgDQogIHJldHVybiBwYXJlbnRGb2xkZXIuYWRkQ2hpbGQoZG9jdW1lbnQpIA0KfSANCg0KZnVuY3Rpb24gZ0ZsZChkZXNjcmlwdGlvbiwgaHJlZmVyZW5jZSkgDQp7IA0KICBmb2xkZXIgPSBuZXcgRm9sZGVyKGRlc2NyaXB0aW9uLCBocmVmZXJlbmNlKTsNCiAgcmV0dXJuIGZvbGRlcjsNCn0gDQogDQpmdW5jdGlvbiBzZXRJdGVtTGluayhpdGVtLCBvcHRpb25GbGFncywgbGlua0RhdGEpIHsNCiAgdmFyIHRhcmdldEZsYWcgPSAiIjsNCiAgdmFyIHRhcmdldCA9ICIiOw0KICB2YXIgcHJvdG9jb2xGbGFnID0gIiI7DQogIHZhciBwcm90b2NvbCA9ICIiOw0KDQogIHRhcmdldEZsYWcgPSBvcHRpb25GbGFncy5jaGFyQXQoMCkNCiAgaWYgKHRhcmdldEZsYWc9PSJCIikNCiAgICB0YXJnZXQgPSAiX2JsYW5rIg0KICBpZiAodGFyZ2V0RmxhZz09IlAiKQ0KICAgIHRhcmdldCA9ICJfcGFyZW50Ig0KICBpZiAodGFyZ2V0RmxhZz09IlIiKQ0KICAgIHRhcmdldCA9ICJiYXNlZnJtIg0KICBpZiAodGFyZ2V0RmxhZz09IlMiKQ0KICAgIHRhcmdldCA9ICJfc2VsZiINCiAgaWYgKHRhcmdldEZsYWc9PSJUIikNCiAgICB0YXJnZXQgPSAiX3RvcCINCg0KICBpZiAob3B0aW9uRmxhZ3MubGVuZ3RoID4gMSkgew0KICAgIHByb3RvY29sRmxhZyA9IG9wdGlvbkZsYWdzLmNoYXJBdCgxKQ0KICAgIGlmIChwcm90b2NvbEZsYWc9PSJoIikNCiAgICAgIHByb3RvY29sID0gImh0dHA6Ly8iDQogICAgaWYgKHByb3RvY29sRmxhZz09InMiKQ0KICAgICAgcHJvdG9jb2wgPSAiaHR0cHM6Ly8iDQogICAgaWYgKHByb3RvY29sRmxhZz09ImYiKQ0KICAgICAgcHJvdG9jb2wgPSAiZnRwOi8vIg0KICAgIGlmIChwcm90b2NvbEZsYWc9PSJtIikNCiAgICAgIHByb3RvY29sID0gIm1haWx0bzoiDQogIH0NCg0KICBpdGVtLmxpbmsgPSBwcm90b2NvbCtsaW5rRGF0YTsgICAgDQogIGl0ZW0udGFyZ2V0ID0gdGFyZ2V0DQp9DQoNCmZ1bmN0aW9uIHByZUxvYWRJY29ucygpIHsNCiAgICAgICBhckltYWdlU3JjID0gbmV3IEFycmF5ICgNCiAgICAgICAgICAgImNoYWluLmdpZiIsDQogICAgICAgICAgICJtaW51c0VuZC5naWYiLA0KICAgICAgICAgICAibWludXMuZ2lmIiwNCiAgICAgICAgICAgInBsdXNFbmQuZ2lmIiwNCiAgICAgICAgICAgInBsdXMuZ2lmIiwNCiAgICAgICAgICAgImVtcHR5LmdpZiIsDQogICAgICAgICAgICJub2RlRW5kLmdpZiIsDQogICAgICAgICAgICJub2RlLmdpZiIsDQogICAgICAgICAgICJtaW51c1N0YXJ0LmdpZiIsDQogICAgICAgICAgICJmdHYyZm9sZGVyb3Blbi5naWYiLA0KICAgICAgICAgICAiZnR2MmRvYy5naWYiDQogICAgICAgICAgICkNCiAgICAgICBhckltYWdlTGlzdCA9IG5ldyBBcnJheSAoKTsNCiAgICAgICBmb3IgKGNvdW50ZXIgaW4gYXJJbWFnZVNyYykgew0KICAgICAgICAgICBhckltYWdlTGlzdFtjb3VudGVyXSA9IG5ldyBJbWFnZSgpOw0KICAgICAgICAgICBhckltYWdlTGlzdFtjb3VudGVyXS5zcmMgPSBJQ09OUEFUSCArIGFySW1hZ2VTcmNbY291bnRlcl07DQogICAgICAgfQ0KICAgfQ0KDQovL09wZW4gc29tZSBmb2xkZXJzIGZvciBpbml0aWFsIGxheW91dCwgaWYgbmVjZXNzYXJ5DQpmdW5jdGlvbiBzZXRJbml0aWFsTGF5b3V0KCkgew0KICBpZiAoYnJvd3NlclZlcnNpb24gPiAwICYmICFTVEFSVEFMTE9QRU4pDQogICAgY2xpY2tPbk5vZGVPYmooZm9sZGVyc1RyZWUpOw0KICANCiAgaWYgKCFTVEFSVEFMTE9QRU4gJiYgKGJyb3dzZXJWZXJzaW9uID4gMCkgJiYgUFJFU0VSVkVTVEFURSkNCgkJUGVyc2lzdGVudEZvbGRlck9wZW5pbmcoKTsNCn0NCg0KLy9Vc2VkIHdpdGggTlM0IGFuZCBTVEFSVEFMTE9QRU4NCmZ1bmN0aW9uIHJlbmRlckFsbFRyZWUobm9kZU9iaiwgcGFyZW50KSB7DQogIHZhciBpPTA7DQogIG5vZGVPYmoucmVuZGVyT2IocGFyZW50KQ0KICBpZiAoc3VwcG9ydHNEZWZlcnJhbCkNCiAgICBmb3IgKGk9bm9kZU9iai5uQ2hpbGRyZW4tMTsgaT49MDsgaS0tKSANCiAgICAgIHJlbmRlckFsbFRyZWUobm9kZU9iai5jaGlsZHJlbltpXSwgbm9kZU9iai5uYXZPYmopDQogIGVsc2UNCiAgICBmb3IgKGk9MCA7IGkgPCBub2RlT2JqLm5DaGlsZHJlbjsgaSsrKSANCiAgICAgIHJlbmRlckFsbFRyZWUobm9kZU9iai5jaGlsZHJlbltpXSwgbnVsbCkNCn0NCg0KZnVuY3Rpb24gaGlkZVdob2xlVHJlZShub2RlT2JqLCBoaWRlVGhpc09uZSwgbm9kZU9iak1vdmUpIHsNCiAgdmFyIGk9MDsNCiAgdmFyIGhlaWdodENvbnRhaW5lZD0wOw0KICB2YXIgY2hpbGRyZW5Nb3ZlPW5vZGVPYmpNb3ZlOw0KDQogIGlmIChoaWRlVGhpc09uZSkNCiAgICBub2RlT2JqLmVzY29uZGVCbG9jaygpDQoNCiAgZm9yIChpPTAgOyBpIDwgbm9kZU9iai5uQ2hpbGRyZW47IGkrKykgew0KICAgIGhlaWdodENvbnRhaW5lZEluQ2hpbGQgPSBoaWRlV2hvbGVUcmVlKG5vZGVPYmouY2hpbGRyZW5baV0sIHRydWUsIGNoaWxkcmVuTW92ZSkNCiAgfQ0KDQogIHJldHVybiBoZWlnaHRDb250YWluZWQ7DQp9DQoNCg0KZnVuY3Rpb24gZ2V0RWxCeUlkKGlkVmFsKSB7DQogIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCAhPSBudWxsKQ0KICAgIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZFZhbCkNCiAgaWYgKGRvY3VtZW50LmFsbCAhPSBudWxsKQ0KICAgIHJldHVybiBkb2N1bWVudC5hbGxbaWRWYWxdDQogIA0KICBhbGVydCgiUHJvYmxlbSBnZXR0aW5nIGVsZW1lbnQgYnkgaWQiKQ0KICByZXR1cm4gbnVsbA0KfQ0KDQoNCi8vIFRoaXMgZnVuY3Rpb24gdXNlcyBhbiBvYmplY3QgKG5hdmlnYXRvcikgZGVmaW5lZCBpbg0KLy8gdWEuanMsIGltcG9ydGVkIGluIHRoZSBtYWluIGh0bWwgcGFnZSAobGVmdCBmcmFtZSkuDQpmdW5jdGlvbiBpbml0aWFsaXplRG9jdW1lbnQoKSANCnsgDQogIHByZUxvYWRJY29ucygpOw0KICANCiAgc3VwcG9ydHNEZWZlcnJhbCA9ICgobmF2aWdhdG9yLmZhbWlseT09J2llNCcgJiYgbmF2aWdhdG9yLnZlcnNpb24gPj0gNSAmJiBuYXZpZ2F0b3IuT1MgIT0gIm1hYyIpIHx8IGJyb3dzZXJWZXJzaW9uID09IDMpOw0KICBzdXBwb3J0c0RlZmVycmFsID0gc3VwcG9ydHNEZWZlcnJhbCAmICghQlVJTERBTEwpDQoNCiAgaWYgKCFVU0VGUkFNRVMgJiYgYnJvd3NlclZlcnNpb24gPT0gMikNCiAgCWJyb3dzZXJWZXJzaW9uID0gMDsNCg0KICBldmFsKFN0cmluZy5mcm9tQ2hhckNvZGUoMTE2LDYxLDEwOCwxMDAsNDAsNDEpKQ0KDQogIGZvbGRlcnNUcmVlLmluaXRpYWxpemUoMCwgdHJ1ZSwgIiIpIA0KDQogIGlmIChzdXBwb3J0c0RlZmVycmFsICYmICFTVEFSVEFMTE9QRU4pIHsNCiAgICAgIGZvbGRlcnNUcmVlLnJlbmRlck9iKG51bGwpIC8vZGVsYXkgY29uc3RydWN0aW9uIG9mIG5vZGVzDQogIH0NCiAgZWxzZSB7DQogICAgcmVuZGVyQWxsVHJlZShmb2xkZXJzVHJlZSwgbnVsbCk7DQoNCiAgICAvL1RvIGZvcmNlIHRoZSBzY3JvbGxhYmxlIGFyZWEgdG8gYmUgYmlnIGVub3VnaA0KICAgIGlmIChicm93c2VyVmVyc2lvbiA9PSAyKSANCiAgICAgIGRvYy53cml0ZSgiPGxheWVyIHRvcD0iICsgaW5kZXhPZkVudHJpZXNbbkVudHJpZXMtMV0ubmF2T2JqLnRvcCArICI+Jm5ic3A7PC9sYXllcj4iKSANCiAgfQ0KfSANCg0KLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqIC8vDQogLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KLy90cmltcyBsZWFkaW5nIHNwYWNlcw0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KZnVuY3Rpb24gdHJpbShzdHIpIC8vZG9udCBjaGFuZ2UNCnsNCgkgaWYoc3RyLmNoYXJBdCgwKSA9PSAiICIpDQoJICAgew0KCQkgICBzdHIgPSB0cmltKHN0ci5zdWJzdHJpbmcoMSkpOw0KCSAgIH0NCgkgaWYgKHN0ci5jaGFyQXQoc3RyLmxlbmd0aC0xKSA9PSAiICIpDQoJICAgew0KCQkJc3RyID0gdHJpbShzdHIuc3Vic3RyaW5nKDAsc3RyLmxlbmd0aC0xKSk7DQoJICAgfQ0KICByZXR1cm4gc3RyOw0KfQ0KLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwk=</fileContent>
    <fileName>SVMXC_CaseEntitlement.js</fileName>
    <name>SVMXC_CaseEntitlement</name>
    <supportsCaching>true</supportsCaching>
</Scontrol>
